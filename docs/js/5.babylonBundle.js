(window.webpackJsonp=window.webpackJsonp||[]).push([[5,8],{153:function(e,t,n){"use strict";t.a=n.p+"09099a357bd30f8395900a6a912b39dd.glb"},206:function(e,t,n){"use strict";t.a=n.p+"a31875b76d39f6458a6e5bc68acee61a.jpg"},208:function(e,t,n){"use strict";var i=n(0),r=n(37),o=n(69),a=n(143),s=n(4),l=n(176);function f(e,t,n,i){var r={externalResourceFunction:function(e){return i(e).then((function(e){return new Uint8Array(e)}))}};return n&&(r.uri="file:"===t?n:t+n),e instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(e),r):GLTFValidator.validateString(e,r)}function u(){var e=[];onmessage=function(t){var n=t.data;switch(n.id){case"init":importScripts(n.url);break;case"validate":f(n.data,n.rootUrl,n.fileName,(function(t){return new Promise((function(n,i){var r=e.length;e.push({resolve:n,reject:i}),postMessage({id:"getExternalResource",index:r,uri:t})}))})).then((function(e){postMessage({id:"validate.resolve",value:e})}),(function(e){postMessage({id:"validate.reject",reason:e})}));break;case"getExternalResource.resolve":e[n.index].resolve(n.value);break;case"getExternalResource.reject":e[n.index].reject(n.reason)}}}var c,d,h,p=function(){function e(){}return e.ValidateAsync=function(e,t,n,i){var o=this;return"function"==typeof Worker?new Promise((function(a,s){var l=f+"("+u+")()",c=URL.createObjectURL(new Blob([l],{type:"application/javascript"})),d=new Worker(c),h=function(e){d.removeEventListener("error",h),d.removeEventListener("message",p),s(e)},p=function(e){var t=e.data;switch(t.id){case"getExternalResource":i(t.uri).then((function(e){d.postMessage({id:"getExternalResource.resolve",index:t.index,value:e},[e])}),(function(e){d.postMessage({id:"getExternalResource.reject",index:t.index,reason:e})}));break;case"validate.resolve":d.removeEventListener("error",h),d.removeEventListener("message",p),a(t.value);break;case"validate.reject":d.removeEventListener("error",h),d.removeEventListener("message",p),s(t.reason)}};d.addEventListener("error",h),d.addEventListener("message",p),d.postMessage({id:"init",url:r.b.GetAbsoluteUrl(o.Configuration.url)}),d.postMessage({id:"validate",data:e,rootUrl:t,fileName:n})})):(this._LoadScriptPromise||(this._LoadScriptPromise=r.b.LoadScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((function(){return f(e,t,n,i)})))},e.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"},e}();!function(e){e[e.AUTO=0]="AUTO",e[e.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(c||(c={})),function(e){e[e.NONE=0]="NONE",e[e.FIRST=1]="FIRST",e[e.ALL=2]="ALL"}(d||(d={})),function(e){e[e.LOADING=0]="LOADING",e[e.READY=1]="READY",e[e.COMPLETE=2]="COMPLETE"}(h||(h={}));var m=function(){function e(){this.onParsedObservable=new i.a,this.coordinateSystemMode=c.AUTO,this.animationStartMode=d.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.onMeshLoadedObservable=new i.a,this.onTextureLoadedObservable=new i.a,this.onMaterialLoadedObservable=new i.a,this.onCameraLoadedObservable=new i.a,this.onCompleteObservable=new i.a,this.onErrorObservable=new i.a,this.onDisposeObservable=new i.a,this.onExtensionLoadedObservable=new i.a,this.validate=!1,this.onValidatedObservable=new i.a,this._loader=null,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(e.prototype,"onParsed",{set:function(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onMeshLoaded",{set:function(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onTextureLoaded",{set:function(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onMaterialLoaded",{set:function(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onCameraLoaded",{set:function(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{set:function(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onError",{set:function(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onExtensionLoaded",{set:function(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onValidated",{set:function(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null),this._clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},e.prototype._clear=function(){this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.onMeshLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear()},e.prototype.requestFile=function(e,t,n,o,a,f){var u=this;if(a){if(this.useRangeRequests){this.validate&&s.a.Warn("glTF validation is not supported when range requests are enabled");var c=new Array,d={abort:function(){return c.forEach((function(e){return e.abort()}))},onCompleteObservable:new i.a},h={readAsync:function(n,i){return new Promise((function(r,a){c.push(e._requestFile(t,(function(e,t){var n=t.getResponseHeader("Content-Range");n&&(h.byteLength=Number(n.split("/")[1])),r(new Uint8Array(e))}),o,!0,!0,(function(e){a(e)}),(function(e){e.setRequestHeader("Range","bytes="+n+"-"+(n+i-1))})))}))},byteLength:0};return this._unpackBinaryAsync(new l.a(h)).then((function(e){d.onCompleteObservable.notifyObservers(d),n(e)}),f),d}return e._requestFile(t,(function(e,t){var i=e;u._unpackBinaryAsync(new l.a({readAsync:function(e,t){return Promise.resolve(new Uint8Array(i,e,t))},byteLength:i.byteLength})).then((function(e){n(e,t)}),f)}),o,!0,!0,f)}return e._requestFile(t,(function(i,o){u._validate(e,i,r.b.GetFolderPath(t),r.b.GetFilename(t)),n({json:u._parseJson(i)},o)}),o,!0,!1,f)},e.prototype.readFile=function(e,t,n,i,r,o){var a=this;return e._readFile(t,(function(i){if(a._validate(e,i,"file:",t.name),r){var s=i;a._unpackBinaryAsync(new l.a({readAsync:function(e,t){return Promise.resolve(new Uint8Array(s,e,t))},byteLength:s.byteLength})).then(n,o)}else n({json:a._parseJson(i)})}),i,r,o)},e.prototype.importMeshAsync=function(e,t,n,i,r,o){var a=this;return Promise.resolve().then((function(){return a.onParsedObservable.notifyObservers(n),a.onParsedObservable.clear(),a._log("Loading "+(o||"")),a._loader=a._getLoader(n),a._loader.importMeshAsync(e,t,!1,n,i,r,o)}))},e.prototype.loadAsync=function(e,t,n,i,r){var o=this;return Promise.resolve().then((function(){return o.onParsedObservable.notifyObservers(t),o.onParsedObservable.clear(),o._log("Loading "+(r||"")),o._loader=o._getLoader(t),o._loader.loadAsync(e,t,n,i,r)}))},e.prototype.loadAssetContainerAsync=function(e,t,n,i,r){var o=this;return Promise.resolve().then((function(){o.onParsedObservable.notifyObservers(t),o.onParsedObservable.clear(),o._log("Loading "+(r||"")),o._loader=o._getLoader(t);var s=[];o.onMaterialLoadedObservable.add((function(e){s.push(e)}));var l=[];return o.onTextureLoadedObservable.add((function(e){l.push(e)})),o._loader.importMeshAsync(null,e,!0,t,n,i,r).then((function(t){var n=new a.a(e);return Array.prototype.push.apply(n.meshes,t.meshes),Array.prototype.push.apply(n.particleSystems,t.particleSystems),Array.prototype.push.apply(n.skeletons,t.skeletons),Array.prototype.push.apply(n.animationGroups,t.animationGroups),Array.prototype.push.apply(n.materials,s),Array.prototype.push.apply(n.textures,l),Array.prototype.push.apply(n.lights,t.lights),Array.prototype.push.apply(n.transformNodes,t.transformNodes),n}))}))},e.prototype.canDirectLoad=function(e){return-1!==e.indexOf("asset")&&-1!==e.indexOf("version")},e.prototype.directLoad=function(e,t){return this._validate(e,t),{json:this._parseJson(t)}},e.prototype.createPlugin=function(){return new e},Object.defineProperty(e.prototype,"loaderState",{get:function(){return this._loader?this._loader.state:null},enumerable:!0,configurable:!0}),e.prototype.whenCompleteAsync=function(){var e=this;return new Promise((function(t,n){e.onCompleteObservable.addOnce((function(){t()})),e.onErrorObservable.addOnce((function(e){n(e)}))}))},e.prototype._validate=function(e,t,n,i){var o=this;void 0===n&&(n=""),void 0===i&&(i=""),this.validate&&(this._startPerformanceCounter("Validate JSON"),p.ValidateAsync(t,n,i,(function(t){return o.preprocessUrlAsync(n+t).then((function(t){return e._loadFileAsync(t,void 0,!0,!0)}))})).then((function(e){o._endPerformanceCounter("Validate JSON"),o.onValidatedObservable.notifyObservers(e),o.onValidatedObservable.clear()}),(function(e){o._endPerformanceCounter("Validate JSON"),r.b.Warn("Failed to validate: "+e.message),o.onValidatedObservable.clear()})))},e.prototype._getLoader=function(t){var n=t.json.asset||{};this._log("Asset version: "+n.version),n.minVersion&&this._log("Asset minimum version: "+n.minVersion),n.generator&&this._log("Asset generator: "+n.generator);var i=e._parseVersion(n.version);if(!i)throw new Error("Invalid version: "+n.version);if(void 0!==n.minVersion){var r=e._parseVersion(n.minVersion);if(!r)throw new Error("Invalid minimum version: "+n.minVersion);if(e._compareVersion(r,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+n.minVersion)}var o={1:e._CreateGLTF1Loader,2:e._CreateGLTF2Loader}[i.major];if(!o)throw new Error("Unsupported version: "+n.version);return o(this)},e.prototype._parseJson=function(e){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: "+e.length);var t=JSON.parse(e);return this._endPerformanceCounter("Parse JSON"),t},e.prototype._unpackBinaryAsync=function(e){var t=this;return this._startPerformanceCounter("Unpack Binary"),e.loadAsync(20).then((function(){var n=e.readUint32();if(1179937895!==n)throw new Error("Unexpected magic: "+n);var i=e.readUint32();t.loggingEnabled&&t._log("Binary version: "+i);var r,o=e.readUint32();if(0!=e.buffer.byteLength&&o!==e.buffer.byteLength)throw new Error("Length in header does not match actual data length: "+o+" != "+e.buffer.byteLength);switch(i){case 1:r=t._unpackBinaryV1Async(e,o);break;case 2:r=t._unpackBinaryV2Async(e,o);break;default:throw new Error("Unsupported version: "+i)}return t._endPerformanceCounter("Unpack Binary"),r}))},e.prototype._unpackBinaryV1Async=function(e,t){var n=e.readUint32(),i=e.readUint32();if(0!==i)throw new Error("Unexpected content format: "+i);var r=t-e.byteOffset,o={json:this._parseJson(e.readString(n)),bin:null};if(0!==r){var a=e.byteOffset;o.bin={readAsync:function(t,n){return e.buffer.readAsync(a+t,n)},byteLength:r}}return Promise.resolve(o)},e.prototype._unpackBinaryV2Async=function(e,t){var n=this,i=1313821514,r=5130562,o=e.readUint32();if(e.readUint32()!==i)throw new Error("First chunk format is not JSON");return e.byteOffset+o===t?e.loadAsync(o).then((function(){return{json:n._parseJson(e.readString(o)),bin:null}})):e.loadAsync(o+8).then((function(){var a={json:n._parseJson(e.readString(o)),bin:null},s=function(){var n=e.readUint32();switch(e.readUint32()){case i:throw new Error("Unexpected JSON chunk");case r:var o=e.byteOffset;a.bin={readAsync:function(t,n){return e.buffer.readAsync(o+t,n)},byteLength:n},e.skipBytes(n);break;default:e.skipBytes(n)}return e.byteOffset!==t?e.loadAsync(8).then(s):Promise.resolve(a)};return s()}))},e._parseVersion=function(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};var t=(e+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null},e._compareVersion=function(e,t){return e.major>t.major?1:e.major<t.major?-1:e.minor>t.minor?1:e.minor<t.minor?-1:0},e.prototype._logOpen=function(e){this._log(e),this._logIndentLevel++},e.prototype._logClose=function(){--this._logIndentLevel},e.prototype._logEnabled=function(t){var n=e._logSpaces.substr(0,2*this._logIndentLevel);s.a.Log(""+n+t)},e.prototype._logDisabled=function(e){},e.prototype._startPerformanceCounterEnabled=function(e){r.b.StartPerformanceCounter(e)},e.prototype._startPerformanceCounterDisabled=function(e){},e.prototype._endPerformanceCounterEnabled=function(e){r.b.EndPerformanceCounter(e)},e.prototype._endPerformanceCounterDisabled=function(e){},e.IncrementalLoading=!0,e.HomogeneousCoordinates=!1,e._logSpaces="                                ",e}();o.a&&o.a.RegisterPlugin(new m);var v,_,g,b,y,x,T,E,A=n(1);!function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.FLOAT=5126]="FLOAT"}(v||(v={})),function(e){e[e.FRAGMENT=35632]="FRAGMENT",e[e.VERTEX=35633]="VERTEX"}(_||(_={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D"}(g||(g={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.REPEAT=10497]="REPEAT"}(b||(b={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9728]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(y||(y={})),function(e){e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"}(x||(x={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(T||(T={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(E||(E={}));var S,P=n(30),O=n(32),C=n(41),L=n(80),M=n(75),R=n(114),F=n(123),N=n(7),D=n(49),I=n(108),w=n(45),V=n(97),U=n(35),B=n(43),j=n(34),G=n(95),k=n(94),H=n(50),z=n(36),W=n(82),X=n(103),K=n(105),Z=n(104),Y=function(){function e(){}return e.SetMatrix=function(e,t,n,i,r){var o=null;if("MODEL"===n.semantic?o=t.getWorldMatrix():"PROJECTION"===n.semantic?o=e.getProjectionMatrix():"VIEW"===n.semantic?o=e.getViewMatrix():"MODELVIEWINVERSETRANSPOSE"===n.semantic?o=P.a.Transpose(t.getWorldMatrix().multiply(e.getViewMatrix()).invert()):"MODELVIEW"===n.semantic?o=t.getWorldMatrix().multiply(e.getViewMatrix()):"MODELVIEWPROJECTION"===n.semantic?o=t.getWorldMatrix().multiply(e.getTransformMatrix()):"MODELINVERSE"===n.semantic?o=t.getWorldMatrix().invert():"VIEWINVERSE"===n.semantic?o=e.getViewMatrix().invert():"PROJECTIONINVERSE"===n.semantic?o=e.getProjectionMatrix().invert():"MODELVIEWINVERSE"===n.semantic?o=t.getWorldMatrix().multiply(e.getViewMatrix()).invert():"MODELVIEWPROJECTIONINVERSE"===n.semantic?o=t.getWorldMatrix().multiply(e.getTransformMatrix()).invert():"MODELINVERSETRANSPOSE"===n.semantic&&(o=P.a.Transpose(t.getWorldMatrix().invert())),o)switch(n.type){case g.FLOAT_MAT2:r.setMatrix2x2(i,P.a.GetAsMatrix2x2(o));break;case g.FLOAT_MAT3:r.setMatrix3x3(i,P.a.GetAsMatrix3x3(o));break;case g.FLOAT_MAT4:r.setMatrix(i,o)}},e.SetUniform=function(e,t,n,i){switch(i){case g.FLOAT:return e.setFloat(t,n),!0;case g.FLOAT_VEC2:return e.setVector2(t,P.d.FromArray(n)),!0;case g.FLOAT_VEC3:return e.setVector3(t,P.e.FromArray(n)),!0;case g.FLOAT_VEC4:return e.setVector4(t,P.f.FromArray(n)),!0;default:return!1}},e.GetWrapMode=function(e){switch(e){case b.CLAMP_TO_EDGE:return U.a.CLAMP_ADDRESSMODE;case b.MIRRORED_REPEAT:return U.a.MIRROR_ADDRESSMODE;case b.REPEAT:default:return U.a.WRAP_ADDRESSMODE}},e.GetByteStrideFromType=function(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}},e.GetTextureFilterMode=function(e){switch(e){case y.LINEAR:case y.LINEAR_MIPMAP_NEAREST:case y.LINEAR_MIPMAP_LINEAR:return U.a.TRILINEAR_SAMPLINGMODE;case y.NEAREST:case y.NEAREST_MIPMAP_NEAREST:return U.a.NEAREST_SAMPLINGMODE;default:return U.a.BILINEAR_SAMPLINGMODE}},e.GetBufferFromBufferView=function(e,t,n,i,r){n=t.byteOffset+n;var o=e.loadedBufferViews[t.buffer];if(n+i>o.byteLength)throw new Error("Buffer access is out of range");var a=o.buffer;switch(n+=o.byteOffset,r){case v.BYTE:return new Int8Array(a,n,i);case v.UNSIGNED_BYTE:return new Uint8Array(a,n,i);case v.SHORT:return new Int16Array(a,n,i);case v.UNSIGNED_SHORT:return new Uint16Array(a,n,i);default:return new Float32Array(a,n,i)}},e.GetBufferFromAccessor=function(t,n){var i=t.bufferViews[n.bufferView],r=n.count*e.GetByteStrideFromType(n);return e.GetBufferFromBufferView(t,i,n.byteOffset,r,n.componentType)},e.DecodeBufferToText=function(e){for(var t="",n=e.byteLength,i=0;i<n;++i)t+=String.fromCharCode(e[i]);return t},e.GetDefaultMaterial=function(t){if(!e._DefaultMaterial){N.a.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n"),N.a.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join("\n");var n={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array,needAlphaBlending:!1};e._DefaultMaterial=new V.a("GLTFDefaultMaterial",t,{vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},n),e._DefaultMaterial.setColor4("u_emission",new O.b(.5,.5,.5,1))}return e._DefaultMaterial},e._DefaultMaterial=null,e}(),q=n(146);!function(e){e[e.IDENTIFIER=1]="IDENTIFIER",e[e.UNKNOWN=2]="UNKNOWN",e[e.END_OF_INPUT=3]="END_OF_INPUT"}(S||(S={}));var J=function(){function e(e){this._pos=0,this.currentToken=S.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=e,this._maxPos=e.length}return e.prototype.getNextToken=function(){if(this.isEnd())return S.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=S.UNKNOWN,"_"===this.currentString||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=S.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||"_"===this.currentString);)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken},e.prototype.peek=function(){return this._toParse[this._pos]},e.prototype.read=function(){return this._toParse[this._pos++]},e.prototype.forward=function(){this._pos++},e.prototype.isEnd=function(){return this._pos>=this._maxPos},e}(),Q=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],$=["world","view","projection","worldView","worldViewProjection","mBones"],ee=["translation","rotation","scale"],te=["position","rotationQuaternion","scaling"],ne=function(e,t,n){for(var i in e){var r=e[i];n[t][i]=r}},ie=function(e){if(e)for(var t=0;t<e.length/2;t++)e[2*t+1]=1-e[2*t+1]},re=function(e){if("NORMAL"===e.semantic)return"normal";if("POSITION"===e.semantic)return"position";if("JOINT"===e.semantic)return"matricesIndices";if("WEIGHT"===e.semantic)return"matricesWeights";if("COLOR"===e.semantic)return"color";if(e.semantic&&-1!==e.semantic.indexOf("TEXCOORD_")){var t=Number(e.semantic.split("_")[1]);return"uv"+(0===t?"":t+1)}return null},oe=function(e){var t=null;if(e.translation||e.rotation||e.scale){var n=P.e.FromArray(e.scale||[1,1,1]),i=P.b.FromArray(e.rotation||[0,0,0,1]),r=P.e.FromArray(e.translation||[0,0,0]);t=P.a.Compose(n,i,r)}else t=P.a.FromArray(e.matrix);return t},ae=function(e,t,n,i){for(var r=0;r<i.bones.length;r++)if(i.bones[r].name===n)return i.bones[r];var o=e.nodes;for(var a in o){var s=o[a];if(s.jointName){var l=s.children;for(r=0;r<l.length;r++){var f=e.nodes[l[r]];if(f.jointName&&f.jointName===n){var u=oe(s),c=new R.a(s.name||"",i,ae(e,t,s.jointName,i),u);return c.id=a,c}}}}return null},se=function(e,t){for(var n=0;n<e.length;n++)for(var i=e[n],r=0;r<i.node.children.length;r++){if(i.node.children[r]===t)return i.bone}return null},le=function(e,t){var n=e.nodes,i=n[t];if(i)return{node:i,id:t};for(var r in n)if((i=n[r]).jointName===t)return{node:i,id:r};return null},fe=function(e,t){for(var n=0;n<e.jointNames.length;n++)if(e.jointNames[n]===t)return!0;return!1},ue=function(e,t,n,i,o){if(i||(i=new F.a(t.name||"","",e.scene)),!t.babylonSkeleton)return i;var a=[],s=[];!function(e,t,n,i){for(var r in e.nodes){var o=e.nodes[r],a=r;if(o.jointName&&!fe(n,o.jointName)){var s=oe(o),l=new R.a(o.name||"",t,null,s);l.id=a,i.push({bone:l,node:o,id:a})}}for(var f=0;f<i.length;f++)for(var u=i[f],c=u.node.children,d=0;d<c.length;d++){for(var h=null,p=0;p<i.length;p++)if(i[p].id===c[d]){h=i[p];break}h&&(h.bone._parent=u.bone,u.bone.children.push(h.bone))}}(e,i,t,a),i.bones=[];for(var l=0;l<t.jointNames.length;l++){if(y=le(e,t.jointNames[l])){var f=y.node;if(f){o=y.id;var u=e.scene.getBoneByID(o);if(u)i.bones.push(u);else{for(var c=!1,d=null,h=0;h<l;h++){var p=le(e,t.jointNames[h]);if(p){var m=p.node;if(m){var v=m.children;if(v){c=!1;for(var _=0;_<v.length;_++)if(v[_]===o){d=ae(e,t,t.jointNames[h],i),c=!0;break}if(c)break}}else r.b.Warn("Joint named "+t.jointNames[h]+" does not exist when looking for parent")}}var g=oe(f);!d&&a.length>0&&(d=se(a,o))&&-1===s.indexOf(d)&&s.push(d),new R.a(f.jointName||"",i,d,g).id=o}}else r.b.Warn("Joint named "+t.jointNames[l]+" does not exist")}}var b=i.bones;i.bones=[];for(l=0;l<t.jointNames.length;l++){var y;if(y=le(e,t.jointNames[l]))for(h=0;h<b.length;h++)if(b[h].id===y.id){i.bones.push(b[h]);break}}i.prepare();for(l=0;l<s.length;l++)i.bones.push(s[l]);return i},ce=function(e,t,n,i,r){if(r||(e.scene._blockEntityCollection=e.forAssetContainer,r=new z.a(t.name||"",e.scene),e.scene._blockEntityCollection=!1,r.id=i),!t.babylonNode)return r;for(var o,a=[],s=null,l=new Array,f=new Array,u=new Array,c=new Array,d=0;d<n.length;d++){var h=n[d];if(L=e.meshes[h])for(var p=0;p<L.primitives.length;p++){var v=new B.a,_=L.primitives[p];_.mode;var g=_.attributes,b=null,y=null;for(var x in g)if(b=e.accessors[g[x]],y=Y.GetBufferFromAccessor(e,b),"NORMAL"===x)v.normals=new Float32Array(y.length),v.normals.set(y);else if("POSITION"===x){if(m.HomogeneousCoordinates){v.positions=new Float32Array(y.length-y.length/4);for(var T=0;T<y.length;T+=4)v.positions[T]=y[T],v.positions[T+1]=y[T+1],v.positions[T+2]=y[T+2]}else v.positions=new Float32Array(y.length),v.positions.set(y);f.push(v.positions.length)}else if(-1!==x.indexOf("TEXCOORD_")){var E=Number(x.split("_")[1]),A=j.b.UVKind+(0===E?"":E+1),S=new Float32Array(y.length);S.set(y),ie(S),v.set(S,A)}else"JOINT"===x?(v.matricesIndices=new Float32Array(y.length),v.matricesIndices.set(y)):"WEIGHT"===x?(v.matricesWeights=new Float32Array(y.length),v.matricesWeights.set(y)):"COLOR"===x&&(v.colors=new Float32Array(y.length),v.colors.set(y));if(b=e.accessors[_.indices])y=Y.GetBufferFromAccessor(e,b),v.indices=new Int32Array(y.length),v.indices.set(y),c.push(v.indices.length);else{var P=[];for(T=0;T<v.positions.length/3;T++)P.push(T);v.indices=new Int32Array(P),c.push(v.indices.length)}s?s.merge(v):s=v;var O=e.scene.getMaterialByID(_.material);a.push(null===O?Y.GetDefaultMaterial(e.scene):O),l.push(0===l.length?0:l[l.length-1]+f[f.length-2]),u.push(0===u.length?0:u[u.length-1]+c[c.length-2])}}e.scene._blockEntityCollection=e.forAssetContainer,a.length>1?(o=new I.a("multimat"+i,e.scene)).subMaterials=a:o=new w.a("multimat"+i,e.scene),1===a.length&&(o=a[0]),r.material||(r.material=o),new G.a(i,e.scene,s,!1,r),r.computeWorldMatrix(!0),e.scene._blockEntityCollection=!1,r.subMeshes=[];var C=0;for(d=0;d<n.length;d++){var L;h=n[d];if(L=e.meshes[h])for(p=0;p<L.primitives.length;p++)L.primitives[p].mode,k.b.AddToMesh(C,l[C],f[C],u[C],c[C],r,r,!0),C++}return r},de=function(e,t,n,i){e.position&&(e.position=t),(e.rotationQuaternion||e.rotation)&&(e.rotationQuaternion=n),e.scaling&&(e.scaling=i)},he=function(e,t,n,i){var r=null;if(e.importOnlyMeshes&&(t.skin||t.meshes)&&e.importMeshesNames&&e.importMeshesNames.length>0&&-1===e.importMeshesNames.indexOf(t.name||""))return null;if(t.skin){if(t.meshes){var o=e.skins[t.skin];(a=ce(e,t,t.meshes,n,t.babylonNode)).skeleton=e.scene.getLastSkeletonByID(t.skin),null===a.skeleton&&(a.skeleton=ue(e,o,0,o.babylonSkeleton,t.skin),o.babylonSkeleton||(o.babylonSkeleton=a.skeleton)),r=a}}else if(t.meshes){var a;r=a=ce(e,t,t.mesh?[t.mesh]:t.meshes,n,t.babylonNode)}else if(!t.light||t.babylonNode||e.importOnlyMeshes){if(t.camera&&!t.babylonNode&&!e.importOnlyMeshes){var s=e.cameras[t.camera];if(s){if(e.scene._blockEntityCollection=e.forAssetContainer,"orthographic"===s.type){var l=new L.a(t.camera,P.e.Zero(),e.scene,!1);l.name=t.name||"",l.mode=C.a.ORTHOGRAPHIC_CAMERA,l.attachControl(e.scene.getEngine().getInputElement()),r=l}else if("perspective"===s.type){var f=s[s.type],u=new L.a(t.camera,P.e.Zero(),e.scene,!1);u.name=t.name||"",u.attachControl(e.scene.getEngine().getInputElement()),f.aspectRatio||(f.aspectRatio=e.scene.getEngine().getRenderWidth()/e.scene.getEngine().getRenderHeight()),f.znear&&f.zfar&&(u.maxZ=f.zfar,u.minZ=f.znear),r=u}e.scene._blockEntityCollection=!1}}}else{var c=e.lights[t.light];if(c)if("ambient"===c.type){var d=c[c.type],h=new W.a(t.light,P.e.Zero(),e.scene);h.name=t.name||"",d.color&&(h.diffuse=O.a.FromArray(d.color)),r=h}else if("directional"===c.type){var p=c[c.type],m=new X.a(t.light,P.e.Zero(),e.scene);m.name=t.name||"",p.color&&(m.diffuse=O.a.FromArray(p.color)),r=m}else if("point"===c.type){var v=c[c.type],_=new K.a(t.light,P.e.Zero(),e.scene);_.name=t.name||"",v.color&&(_.diffuse=O.a.FromArray(v.color)),r=_}else if("spot"===c.type){var g=c[c.type],b=new Z.a(t.light,P.e.Zero(),P.e.Zero(),0,0,e.scene);b.name=t.name||"",g.color&&(b.diffuse=O.a.FromArray(g.color)),g.fallOfAngle&&(b.angle=g.fallOfAngle),g.fallOffExponent&&(b.exponent=g.fallOffExponent),r=b}}if(!t.jointName){if(t.babylonNode)return t.babylonNode;if(null===r){e.scene._blockEntityCollection=e.forAssetContainer;var y=new z.a(t.name||"",e.scene);e.scene._blockEntityCollection=!1,t.babylonNode=y,r=y}}if(null!==r){if(t.matrix&&r instanceof z.a)!function(e,t,n){if(t.matrix){var i=new P.e(0,0,0),r=new P.b,o=new P.e(0,0,0);P.a.FromArray(t.matrix).decompose(o,r,i),de(e,i,r,o)}else t.translation&&t.rotation&&t.scale&&de(e,P.e.FromArray(t.translation),P.b.FromArray(t.rotation),P.e.FromArray(t.scale));e.computeWorldMatrix(!0)}(r,t);else{var x=t.translation||[0,0,0],T=t.rotation||[0,0,0,1],E=t.scale||[1,1,1];de(r,P.e.FromArray(x),P.b.FromArray(T),P.e.FromArray(E))}r.updateCache(!0),t.babylonNode=r}return r},pe=function(e,t,n,i){void 0===i&&(i=!1);var r=e.nodes[t],o=null;if(i=!(e.importOnlyMeshes&&!i&&e.importMeshesNames)||(-1!==e.importMeshesNames.indexOf(r.name||"")||0===e.importMeshesNames.length),!r.jointName&&i&&null!==(o=he(e,r,t))&&(o.id=t,o.parent=n),r.children)for(var a=0;a<r.children.length;a++)pe(e,r.children[a],o,i)},me=function(e){var t=e.currentScene;if(t)for(var n=0;n<t.nodes.length;n++)pe(e,t.nodes[n],null);else for(var i in e.scenes){t=e.scenes[i];for(n=0;n<t.nodes.length;n++)pe(e,t.nodes[n],null)}!function(e){for(var t in e.animations){var n=e.animations[t];if(n.channels&&n.samplers)for(var i=null,o=0;o<n.channels.length;o++){var a=n.channels[o],s=n.samplers[a.sampler];if(s){var l=null,f=null;n.parameters?(l=n.parameters[s.input],f=n.parameters[s.output]):(l=s.input,f=s.output);var u=Y.GetBufferFromAccessor(e,e.accessors[l]),c=Y.GetBufferFromAccessor(e,e.accessors[f]),d=a.target.id,h=e.scene.getNodeByID(d);if(null===h&&(h=e.scene.getNodeByName(d)),null!==h){var p=h instanceof R.a,m=a.target.path,v=ee.indexOf(m);-1!==v&&(m=te[v]);var _=M.a.ANIMATIONTYPE_MATRIX;p||("rotationQuaternion"===m?(_=M.a.ANIMATIONTYPE_QUATERNION,h.rotationQuaternion=new P.b):_=M.a.ANIMATIONTYPE_VECTOR3);var g=null,b=[],y=0,x=!1;p&&i&&i.getKeys().length===u.length&&(g=i,x=!0),x||(e.scene._blockEntityCollection=e.forAssetContainer,g=new M.a(t,p?"_matrix":m,1,_,M.a.ANIMATIONLOOPMODE_CYCLE),e.scene._blockEntityCollection=!1);for(var T=0;T<u.length;T++){var E=null;if("rotationQuaternion"===m?(E=P.b.FromArray([c[y],c[y+1],c[y+2],c[y+3]]),y+=4):(E=P.e.FromArray([c[y],c[y+1],c[y+2]]),y+=3),p){var A=h,S=P.e.Zero(),O=new P.b,C=P.e.Zero(),L=A.getBaseMatrix();x&&i&&(L=i.getKeys()[T].value),L.decompose(C,O,S),"position"===m?S=E:"rotationQuaternion"===m?O=E:C=E,E=P.a.Compose(C,O,S)}x?i&&(i.getKeys()[T].value=E):b.push({frame:u[T],value:E})}!x&&g&&(g.setKeys(b),h.animations.push(g)),i=g,e.scene.stopAnimation(h),e.scene.beginAnimation(h,0,u[u.length-1],!0,1)}else r.b.Warn("Creating animation named "+t+". But cannot find node named "+d+" to attach to")}}}}(e);for(n=0;n<e.scene.skeletons.length;n++){var o=e.scene.skeletons[n];e.scene.beginAnimation(o,0,Number.MAX_VALUE,!0,1)}},ve=function(e,t,n,i,r,o){return function(a){!function(e,t,n,i,r){var o=i.values||n.parameters,a=n.uniforms;for(var s in r){var l=r[s],f=l.type,u=o[a[s]];if(void 0===u&&(u=l.value),u){var c=function(e){return function(n){l.value&&e&&(t.setTexture(e,n),delete r[e])}};f===g.SAMPLER_2D?xe.LoadTextureAsync(e,i.values?u:l.value,c(s),(function(){return c(null)})):l.value&&Y.SetUniform(t,s,i.values?u:l.value,f)&&delete r[s]}}}(e,t,n,i,r),t.onBind=function(a){!function(e,t,n,i,r,o,a){var s=o.values||r.parameters;for(var l in n){var f=n[l],u=f.type;if(u===g.FLOAT_MAT2||u===g.FLOAT_MAT3||u===g.FLOAT_MAT4)if(!f.semantic||f.source||f.node){if(f.semantic&&(f.source||f.node)){var c=t.scene.getNodeByName(f.source||f.node||"");if(null===c&&(c=t.scene.getNodeByID(f.source||f.node||"")),null===c)continue;Y.SetMatrix(t.scene,c,f,l,i.getEffect())}}else Y.SetMatrix(t.scene,e,f,l,i.getEffect());else{var d=s[r.uniforms[l]];if(!d)continue;if(u===g.SAMPLER_2D){var h=t.textures[o.values?d:f.value].babylonTexture;if(null==h)continue;i.getEffect().setTexture(l,h)}else Y.SetUniform(i.getEffect(),l,d,u)}}a(i)}(a,e,r,t,n,i,o)}}},_e=function(e,t,n){for(var i in t.uniforms){var r=t.uniforms[i],o=t.parameters[r];if(e.currentIdentifier===i&&o.semantic&&!o.source&&!o.node){var a=Q.indexOf(o.semantic);if(-1!==a)return delete n[i],$[a]}}return e.currentIdentifier},ge=function(e){for(var t in e.materials)xe.LoadMaterialAsync(e,t,(function(e){}),(function(){}))},be=function(){function e(){}return e.CreateRuntime=function(e,t,n){var i={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:t,rootUrl:n,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],forAssetContainer:!1};return e.extensions&&ne(e.extensions,"extensions",i),e.extensionsUsed&&ne(e.extensionsUsed,"extensionsUsed",i),e.buffers&&function(e,t){for(var n in e){var i=e[n];t.buffers[n]=i,t.buffersCount++}}(e.buffers,i),e.bufferViews&&ne(e.bufferViews,"bufferViews",i),e.accessors&&ne(e.accessors,"accessors",i),e.meshes&&ne(e.meshes,"meshes",i),e.lights&&ne(e.lights,"lights",i),e.cameras&&ne(e.cameras,"cameras",i),e.nodes&&ne(e.nodes,"nodes",i),e.images&&ne(e.images,"images",i),e.textures&&ne(e.textures,"textures",i),e.shaders&&function(e,t){for(var n in e){var i=e[n];t.shaders[n]=i,t.shaderscount++}}(e.shaders,i),e.programs&&ne(e.programs,"programs",i),e.samplers&&ne(e.samplers,"samplers",i),e.techniques&&ne(e.techniques,"techniques",i),e.materials&&ne(e.materials,"materials",i),e.animations&&ne(e.animations,"animations",i),e.skins&&ne(e.skins,"skins",i),e.scenes&&(i.scenes=e.scenes),e.scene&&e.scenes&&(i.currentScene=e.scenes[e.scene]),i},e.LoadBufferAsync=function(e,t,n,i,o){var a=e.buffers[t];r.b.IsBase64(a.uri)?setTimeout((function(){return n(new Uint8Array(r.b.DecodeBase64(a.uri)))})):r.b.LoadFile(e.rootUrl+a.uri,(function(e){return n(new Uint8Array(e))}),o,void 0,!0,(function(e){e&&i(e.status+" "+e.statusText)}))},e.LoadTextureBufferAsync=function(e,t,n,i){var o=e.textures[t];if(o&&o.source)if(o.babylonTexture)n(null);else{var a=e.images[o.source];r.b.IsBase64(a.uri)?setTimeout((function(){return n(new Uint8Array(r.b.DecodeBase64(a.uri)))})):r.b.LoadFile(e.rootUrl+a.uri,(function(e){return n(new Uint8Array(e))}),void 0,void 0,!0,(function(e){e&&i(e.status+" "+e.statusText)}))}else i("")},e.CreateTextureAsync=function(e,t,n,i,r){var o=e.textures[t];if(o.babylonTexture)i(o.babylonTexture);else{var a=e.samplers[o.sampler],s=a.minFilter===y.NEAREST_MIPMAP_NEAREST||a.minFilter===y.NEAREST_MIPMAP_LINEAR||a.minFilter===y.LINEAR_MIPMAP_NEAREST||a.minFilter===y.LINEAR_MIPMAP_LINEAR,l=U.a.BILINEAR_SAMPLINGMODE,f=null==n?new Blob:new Blob([n]),u=URL.createObjectURL(f),c=function(){return URL.revokeObjectURL(u)},d=new U.a(u,e.scene,!s,!0,l,c,c);void 0!==a.wrapS&&(d.wrapU=Y.GetWrapMode(a.wrapS)),void 0!==a.wrapT&&(d.wrapV=Y.GetWrapMode(a.wrapT)),d.name=t,o.babylonTexture=d,i(d)}},e.LoadShaderStringAsync=function(e,t,n,i){var o=e.shaders[t];if(r.b.IsBase64(o.uri)){var a=atob(o.uri.split(",")[1]);n&&n(a)}else r.b.LoadFile(e.rootUrl+o.uri,n,void 0,void 0,!1,(function(e){e&&i&&i(e.status+" "+e.statusText)}))},e.LoadMaterialAsync=function(e,t,n,i){var r=e.materials[t];if(r.technique){var o=e.techniques[r.technique];if(!o){e.scene._blockEntityCollection=e.forAssetContainer;var a=new w.a(t,e.scene);return e.scene._blockEntityCollection=!1,a.diffuseColor=new O.a(.5,.5,.5),a.sideOrientation=D.a.CounterClockWiseSideOrientation,void n(a)}var s=e.programs[o.program],l=o.states,f=N.a.ShadersStore[s.vertexShader+"VertexShader"],u=N.a.ShadersStore[s.fragmentShader+"PixelShader"],c="",d="",h=new J(f),p=new J(u),m={},v=[],_=[],b=[];for(var y in o.uniforms){var x=o.uniforms[y],A=o.parameters[x];if(m[y]=A,!A.semantic||A.node||A.source)A.type===g.SAMPLER_2D?b.push(y):v.push(y);else{var P=Q.indexOf(A.semantic);-1!==P?(v.push($[P]),delete m[y]):v.push(y)}}for(var C in o.attributes){var L=o.attributes[C];if((F=o.parameters[L]).semantic){var M=re(F);M&&_.push(M)}}for(;!h.isEnd()&&h.getNextToken();){if(h.currentToken===S.IDENTIFIER){var R=!1;for(var C in o.attributes){L=o.attributes[C];var F=o.parameters[L];if(h.currentIdentifier===C&&F.semantic){c+=re(F),R=!0;break}}R||(c+=_e(h,o,m))}else c+=h.currentString}for(;!p.isEnd()&&p.getNextToken();){p.currentToken===S.IDENTIFIER?d+=_e(p,o,m):d+=p.currentString}var I={vertex:s.vertexShader+t,fragment:s.fragmentShader+t},U={attributes:_,uniforms:v,samplers:b,needAlphaBlending:l&&l.enable&&-1!==l.enable.indexOf(3042)};N.a.ShadersStore[s.vertexShader+t+"VertexShader"]=c,N.a.ShadersStore[s.fragmentShader+t+"PixelShader"]=d;var B=new V.a(t,e.scene,I,U);if(B.onError=function(e,t,n){return function(i,r){t.dispose(!0),n("Cannot compile program named "+e.name+". Error: "+r+". Default material will be applied")}}(s,B,i),B.onCompiled=ve(e,B,o,r,m,n),B.sideOrientation=D.a.CounterClockWiseSideOrientation,l&&l.functions){var j=l.functions;j.cullFace&&j.cullFace[0]!==T.BACK&&(B.backFaceCulling=!1);var G=j.blendFuncSeparate;G&&(G[0]===E.SRC_ALPHA&&G[1]===E.ONE_MINUS_SRC_ALPHA&&G[2]===E.ONE&&G[3]===E.ONE?B.alphaMode=q.a.ALPHA_COMBINE:G[0]===E.ONE&&G[1]===E.ONE&&G[2]===E.ZERO&&G[3]===E.ONE?B.alphaMode=q.a.ALPHA_ONEONE:G[0]===E.SRC_ALPHA&&G[1]===E.ONE&&G[2]===E.ZERO&&G[3]===E.ONE?B.alphaMode=q.a.ALPHA_ADD:G[0]===E.ZERO&&G[1]===E.ONE_MINUS_SRC_COLOR&&G[2]===E.ONE&&G[3]===E.ONE?B.alphaMode=q.a.ALPHA_SUBTRACT:G[0]===E.DST_COLOR&&G[1]===E.ZERO&&G[2]===E.ONE&&G[3]===E.ONE?B.alphaMode=q.a.ALPHA_MULTIPLY:G[0]===E.SRC_ALPHA&&G[1]===E.ONE_MINUS_SRC_COLOR&&G[2]===E.ONE&&G[3]===E.ONE&&(B.alphaMode=q.a.ALPHA_MAXIMIZED))}}else i&&i("No technique found.")},e}(),ye=function(){function e(){this.state=null}return e.RegisterExtension=function(t){e.Extensions[t.name]?r.b.Error('Tool with the same name "'+t.name+'" already exists'):e.Extensions[t.name]=t},e.prototype.dispose=function(){},e.prototype._importMeshAsync=function(e,t,n,i,o,a,s,l){var f=this;return t.useRightHandedSystem=!0,xe.LoadRuntimeAsync(t,n,i,(function(t){t.forAssetContainer=o,t.importOnlyMeshes=!0,""===e?t.importMeshesNames=[]:"string"==typeof e?t.importMeshesNames=[e]:!e||e instanceof Array?(t.importMeshesNames=[],r.b.Warn("Argument meshesNames must be of type string or string[]")):t.importMeshesNames=[e],f._createNodes(t);var n=new Array,i=new Array;for(var l in t.nodes){var u=t.nodes[l];u.babylonNode instanceof H.a&&n.push(u.babylonNode)}for(var c in t.skins){var d=t.skins[c];d.babylonSkeleton instanceof F.a&&i.push(d.babylonSkeleton)}f._loadBuffersAsync(t,(function(){f._loadShadersAsync(t,(function(){ge(t),me(t),!m.IncrementalLoading&&a&&a(n,i)}))}),s),m.IncrementalLoading&&a&&a(n,i)}),l),!0},e.prototype.importMeshAsync=function(e,t,n,i,r,o){var a=this;return new Promise((function(s,l){a._importMeshAsync(e,t,i,r,n,(function(e,t){s({meshes:e,particleSystems:[],skeletons:t,animationGroups:[],lights:[],transformNodes:[]})}),o,(function(e){l(new Error(e))}))}))},e.prototype._loadAsync=function(e,t,n,i,r,o,a){var s=this;e.useRightHandedSystem=!0,xe.LoadRuntimeAsync(e,t,n,(function(e){xe.LoadRuntimeExtensionsAsync(e,(function(){s._createNodes(e),s._loadBuffersAsync(e,(function(){s._loadShadersAsync(e,(function(){ge(e),me(e),m.IncrementalLoading||r()}))})),m.IncrementalLoading&&r()}),a)}),a)},e.prototype.loadAsync=function(e,t,n,i){var r=this;return new Promise((function(o,a){r._loadAsync(e,t,n,!1,(function(){o()}),i,(function(e){a(new Error(e))}))}))},e.prototype._loadShadersAsync=function(e,t){var n=!1,i=function(n,i){xe.LoadShaderStringAsync(e,n,(function(r){r instanceof ArrayBuffer||(e.loadedShaderCount++,r&&(N.a.ShadersStore[n+(i.type===_.VERTEX?"VertexShader":"PixelShader")]=r),e.loadedShaderCount===e.shaderscount&&t())}),(function(){r.b.Error("Error when loading shader program named "+n+" located at "+i.uri)}))};for(var o in e.shaders){n=!0;var a=e.shaders[o];a?i.bind(this,o,a)():r.b.Error("No shader named: "+o)}n||t()},e.prototype._loadBuffersAsync=function(e,t,n){var i=!1,o=function(n,i){xe.LoadBufferAsync(e,n,(function(o){e.loadedBufferCount++,o&&(o.byteLength!=e.buffers[n].byteLength&&r.b.Error("Buffer named "+n+" is length "+o.byteLength+". Expected: "+i.byteLength),e.loadedBufferViews[n]=o),e.loadedBufferCount===e.buffersCount&&t()}),(function(){r.b.Error("Error when loading buffer named "+n+" located at "+i.uri)}))};for(var a in e.buffers){i=!0;var s=e.buffers[a];s?o.bind(this,a,s)():r.b.Error("No buffer named: "+a)}i||t()},e.prototype._createNodes=function(e){var t=e.currentScene;if(t)for(var n=0;n<t.nodes.length;n++)pe(e,t.nodes[n],null);else for(var i in e.scenes){t=e.scenes[i];for(n=0;n<t.nodes.length;n++)pe(e,t.nodes[n],null)}},e.Extensions={},e}(),xe=function(){function e(e){this._name=e}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.loadRuntimeAsync=function(e,t,n,i,r){return!1},e.prototype.loadRuntimeExtensionsAsync=function(e,t,n){return!1},e.prototype.loadBufferAsync=function(e,t,n,i,r){return!1},e.prototype.loadTextureBufferAsync=function(e,t,n,i){return!1},e.prototype.createTextureAsync=function(e,t,n,i,r){return!1},e.prototype.loadShaderStringAsync=function(e,t,n,i){return!1},e.prototype.loadMaterialAsync=function(e,t,n,i){return!1},e.LoadRuntimeAsync=function(t,n,i,r,o){e.ApplyExtensions((function(e){return e.loadRuntimeAsync(t,n,i,r,o)}),(function(){setTimeout((function(){r&&r(be.CreateRuntime(n.json,t,i))}))}))},e.LoadRuntimeExtensionsAsync=function(t,n,i){e.ApplyExtensions((function(e){return e.loadRuntimeExtensionsAsync(t,n,i)}),(function(){setTimeout((function(){n()}))}))},e.LoadBufferAsync=function(t,n,i,r,o){e.ApplyExtensions((function(e){return e.loadBufferAsync(t,n,i,r,o)}),(function(){be.LoadBufferAsync(t,n,i,r,o)}))},e.LoadTextureAsync=function(t,n,i,r){e.LoadTextureBufferAsync(t,n,(function(o){o&&e.CreateTextureAsync(t,n,o,i,r)}),r)},e.LoadShaderStringAsync=function(t,n,i,r){e.ApplyExtensions((function(e){return e.loadShaderStringAsync(t,n,i,r)}),(function(){be.LoadShaderStringAsync(t,n,i,r)}))},e.LoadMaterialAsync=function(t,n,i,r){e.ApplyExtensions((function(e){return e.loadMaterialAsync(t,n,i,r)}),(function(){be.LoadMaterialAsync(t,n,i,r)}))},e.LoadTextureBufferAsync=function(t,n,i,r){e.ApplyExtensions((function(e){return e.loadTextureBufferAsync(t,n,i,r)}),(function(){be.LoadTextureBufferAsync(t,n,i,r)}))},e.CreateTextureAsync=function(t,n,i,r,o){e.ApplyExtensions((function(e){return e.createTextureAsync(t,n,i,r,o)}),(function(){be.CreateTextureAsync(t,n,i,r,o)}))},e.ApplyExtensions=function(e,t){for(var n in ye.Extensions){if(e(ye.Extensions[n]))return}t()},e}();m._CreateGLTF1Loader=function(){return new ye};var Te=function(e){function t(){return e.call(this,"KHR_binary_glTF")||this}return Object(A.d)(t,e),t.prototype.loadRuntimeAsync=function(e,t,n,i,r){var o=t.json.extensionsUsed;return!(!o||-1===o.indexOf(this.name)||!t.bin)&&(this._bin=t.bin,i(be.CreateRuntime(t.json,e,n)),!0)},t.prototype.loadBufferAsync=function(e,t,n,i){return-1!==e.extensionsUsed.indexOf(this.name)&&("binary_glTF"===t&&(this._bin.readAsync(0,this._bin.byteLength).then(n,(function(e){return i(e.message)})),!0))},t.prototype.loadTextureBufferAsync=function(e,t,n,i){var r=e.textures[t],o=e.images[r.source];if(!o.extensions||!(this.name in o.extensions))return!1;var a=o.extensions[this.name],s=e.bufferViews[a.bufferView];return n(Y.GetBufferFromBufferView(e,s,0,s.byteLength,v.UNSIGNED_BYTE)),!0},t.prototype.loadShaderStringAsync=function(e,t,n,i){var r=e.shaders[t];if(!r.extensions||!(this.name in r.extensions))return!1;var o=r.extensions[this.name],a=e.bufferViews[o.bufferView],s=Y.GetBufferFromBufferView(e,a,0,a.byteLength,v.UNSIGNED_BYTE);return setTimeout((function(){var e=Y.DecodeBufferToText(s);n(e)})),!0},t}(xe);ye.RegisterExtension(new Te);var Ee=function(e){function t(){return e.call(this,"KHR_materials_common")||this}return Object(A.d)(t,e),t.prototype.loadRuntimeExtensionsAsync=function(e,t,n){if(!e.extensions)return!1;var i=e.extensions[this.name];if(!i)return!1;var o=i.lights;if(o)for(var a in o){var s=o[a];switch(s.type){case"ambient":var l=new W.a(s.name,new P.e(0,1,0),e.scene),f=s.ambient;f&&(l.diffuse=O.a.FromArray(f.color||[1,1,1]));break;case"point":var u=new K.a(s.name,new P.e(10,10,10),e.scene),c=s.point;c&&(u.diffuse=O.a.FromArray(c.color||[1,1,1]));break;case"directional":var d=new X.a(s.name,new P.e(0,-1,0),e.scene),h=s.directional;h&&(d.diffuse=O.a.FromArray(h.color||[1,1,1]));break;case"spot":var p=s.spot;if(p)new Z.a(s.name,new P.e(0,10,0),new P.e(0,-1,0),p.fallOffAngle||Math.PI,p.fallOffExponent||0,e.scene).diffuse=O.a.FromArray(p.color||[1,1,1]);break;default:r.b.Warn('GLTF Material Common extension: light type "'+s.type+"â€ not supported")}}return!1},t.prototype.loadMaterialAsync=function(e,t,n,i){var r=e.materials[t];if(!r||!r.extensions)return!1;var o=r.extensions[this.name];if(!o)return!1;var a=new w.a(t,e.scene);return a.sideOrientation=D.a.CounterClockWiseSideOrientation,"CONSTANT"===o.technique&&(a.disableLighting=!0),a.backFaceCulling=void 0!==o.doubleSided&&!o.doubleSided,a.alpha=void 0===o.values.transparency?1:o.values.transparency,a.specularPower=void 0===o.values.shininess?0:o.values.shininess,"string"==typeof o.values.ambient?this._loadTexture(e,o.values.ambient,a,"ambientTexture",i):a.ambientColor=O.a.FromArray(o.values.ambient||[0,0,0]),"string"==typeof o.values.diffuse?this._loadTexture(e,o.values.diffuse,a,"diffuseTexture",i):a.diffuseColor=O.a.FromArray(o.values.diffuse||[0,0,0]),"string"==typeof o.values.emission?this._loadTexture(e,o.values.emission,a,"emissiveTexture",i):a.emissiveColor=O.a.FromArray(o.values.emission||[0,0,0]),"string"==typeof o.values.specular?this._loadTexture(e,o.values.specular,a,"specularTexture",i):a.specularColor=O.a.FromArray(o.values.specular||[0,0,0]),!0},t.prototype._loadTexture=function(e,t,n,i,r){be.LoadTextureBufferAsync(e,t,(function(o){be.CreateTextureAsync(e,t,o,(function(e){return n[i]=e}),r)}),r)},t}(xe);ye.RegisterExtension(new Ee);var Ae=n(132),Se=n(122),Pe=n(59),Oe=n(85),Ce=n(151),Le=n(150),Me=n(140),Re=n(118),Fe=function(){function e(){}return e.Get=function(e,t,n){if(!t||null==n||!t[n])throw new Error(e+": Failed to find index ("+n+")");return t[n]},e.Assign=function(e){if(e)for(var t=0;t<e.length;t++)e[t].index=t},e}(),Ne=function(){function e(e){this._completePromises=new Array,this._forAssetContainer=!1,this._babylonLights=[],this._disposed=!1,this._state=null,this._extensions=new Array,this._defaultBabylonMaterialData={},this._requests=new Array,this._parent=e}return e.RegisterExtension=function(t,n){e.UnregisterExtension(t)&&s.a.Warn("Extension with the name '"+t+"' already exists"),e._RegisteredExtensions[t]={factory:n}},e.UnregisterExtension=function(t){return!!e._RegisteredExtensions[t]&&(delete e._RegisteredExtensions[t],!0)},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gltf",{get:function(){return this._gltf},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bin",{get:function(){return this._bin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"babylonScene",{get:function(){return this._babylonScene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(!this._disposed){this._disposed=!0;for(var e=0,t=this._requests;e<t.length;e++){t[e].abort()}for(var n in this._requests.length=0,this._completePromises.length=0,this._extensions){var i=this._extensions[n];i.dispose&&i.dispose(),delete this._extensions[n]}delete this._gltf,delete this._babylonScene,delete this._rootBabylonMesh,delete this._progressCallback,this._parent._clear()}},e.prototype.importMeshAsync=function(e,t,n,i,r,o,a){var s=this;return Promise.resolve().then((function(){s._babylonScene=t,s._rootUrl=r,s._fileName=a||"scene",s._progressCallback=o,s._forAssetContainer=n,s._loadData(i);var l=null;if(e){var f={};if(s._gltf.nodes)for(var u=0,c=s._gltf.nodes;u<c.length;u++){var d=c[u];d.name&&(f[d.name]=d.index)}l=(e instanceof Array?e:[e]).map((function(e){var t=f[e];if(void 0===t)throw new Error("Failed to find node '"+e+"'");return t}))}return s._loadAsync(l,(function(){return{meshes:s._getMeshes(),particleSystems:[],skeletons:s._getSkeletons(),animationGroups:s._getAnimationGroups(),lights:s._babylonLights,transformNodes:s._getTransformNodes()}}))}))},e.prototype.loadAsync=function(e,t,n,i,r){var o=this;return Promise.resolve().then((function(){return o._babylonScene=e,o._rootUrl=n,o._fileName=r||"scene",o._progressCallback=i,o._loadData(t),o._loadAsync(null,(function(){}))}))},e.prototype._loadAsync=function(e,t){var n=this;return Promise.resolve().then((function(){n._uniqueRootUrl=-1===n._rootUrl.indexOf("file:")&&n._fileName?n._rootUrl:""+n._rootUrl+Date.now()+"/",n._loadExtensions(),n._checkExtensions();var i=h[h.LOADING]+" => "+h[h.READY],o=h[h.LOADING]+" => "+h[h.COMPLETE];n._parent._startPerformanceCounter(i),n._parent._startPerformanceCounter(o),n._setState(h.LOADING),n._extensionsOnLoading();var a=new Array,s=n._babylonScene.blockMaterialDirtyMechanism;if(n._babylonScene.blockMaterialDirtyMechanism=!0,e)a.push(n.loadSceneAsync("/nodes",{nodes:e,index:-1}));else if(null!=n._gltf.scene||n._gltf.scenes&&n._gltf.scenes[0]){var l=Fe.Get("/scene",n._gltf.scenes,n._gltf.scene||0);a.push(n.loadSceneAsync("/scenes/"+l.index,l))}n._babylonScene.blockMaterialDirtyMechanism=s,n._parent.compileMaterials&&a.push(n._compileMaterialsAsync()),n._parent.compileShadowGenerators&&a.push(n._compileShadowGeneratorsAsync());var f=Promise.all(a).then((function(){return n._rootBabylonMesh&&n._rootBabylonMesh.setEnabled(!0),n._setState(h.READY),n._extensionsOnReady(),n._startAnimations(),t()}));return f.then((function(){n._parent._endPerformanceCounter(i),r.b.SetImmediate((function(){n._disposed||Promise.all(n._completePromises).then((function(){n._parent._endPerformanceCounter(o),n._setState(h.COMPLETE),n._parent.onCompleteObservable.notifyObservers(void 0),n._parent.onCompleteObservable.clear(),n.dispose()}),(function(e){n._parent.onErrorObservable.notifyObservers(e),n._parent.onErrorObservable.clear(),n.dispose()}))}))})),f}),(function(e){throw n._disposed||(n._parent.onErrorObservable.notifyObservers(e),n._parent.onErrorObservable.clear(),n.dispose()),e}))},e.prototype._loadData=function(e){if(this._gltf=e.json,this._setupData(),e.bin){var t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){var n=t[0];(n.byteLength<e.bin.byteLength-3||n.byteLength>e.bin.byteLength)&&s.a.Warn("Binary buffer length ("+n.byteLength+") from JSON does not match chunk length ("+e.bin.byteLength+")"),this._bin=e.bin}else s.a.Warn("Unexpected BIN chunk")}},e.prototype._setupData=function(){if(Fe.Assign(this._gltf.accessors),Fe.Assign(this._gltf.animations),Fe.Assign(this._gltf.buffers),Fe.Assign(this._gltf.bufferViews),Fe.Assign(this._gltf.cameras),Fe.Assign(this._gltf.images),Fe.Assign(this._gltf.materials),Fe.Assign(this._gltf.meshes),Fe.Assign(this._gltf.nodes),Fe.Assign(this._gltf.samplers),Fe.Assign(this._gltf.scenes),Fe.Assign(this._gltf.skins),Fe.Assign(this._gltf.textures),this._gltf.nodes){for(var e={},t=0,n=this._gltf.nodes;t<n.length;t++){if((l=n[t]).children)for(var i=0,r=l.children;i<r.length;i++){e[r[i]]=l.index}}for(var o=this._createRootNode(),a=0,s=this._gltf.nodes;a<s.length;a++){var l,f=e[(l=s[a]).index];l.parent=void 0===f?o:this._gltf.nodes[f]}}},e.prototype._loadExtensions=function(){for(var t in e._RegisteredExtensions){var n=e._RegisteredExtensions[t].factory(this);n.name!==t&&s.a.Warn("The name of the glTF loader extension instance does not match the registered name: "+n.name+" !== "+t),this._extensions.push(n),this._parent.onExtensionLoadedObservable.notifyObservers(n)}this._extensions.sort((function(e,t){return(e.order||Number.MAX_VALUE)-(t.order||Number.MAX_VALUE)})),this._parent.onExtensionLoadedObservable.clear()},e.prototype._checkExtensions=function(){if(this._gltf.extensionsRequired)for(var e=function(e){if(!t._extensions.some((function(t){return t.name===e&&t.enabled})))throw new Error("Require extension "+e+" is not available")},t=this,n=0,i=this._gltf.extensionsRequired;n<i.length;n++){e(i[n])}},e.prototype._setState=function(e){this._state=e,this.log(h[this._state])},e.prototype._createRootNode=function(){this._babylonScene._blockEntityCollection=this._forAssetContainer,this._rootBabylonMesh=new z.a("__root__",this._babylonScene),this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);var t={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case c.AUTO:this._babylonScene.useRightHandedSystem||(t.rotation=[0,1,0,0],t.scale=[1,1,-1],e._LoadTransform(t,this._rootBabylonMesh));break;case c.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode ("+this._parent.coordinateSystemMode+")")}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),t},e.prototype.loadSceneAsync=function(e,t){var n=this,i=this._extensionsLoadSceneAsync(e,t);if(i)return i;var r=new Array;if(this.logOpen(e+" "+(t.name||"")),t.nodes)for(var o=0,a=t.nodes;o<a.length;o++){var s=a[o],l=Fe.Get(e+"/nodes/"+s,this._gltf.nodes,s);r.push(this.loadNodeAsync("/nodes/"+l.index,l,(function(e){e.parent=n._rootBabylonMesh})))}if(this._gltf.nodes)for(var f=0,u=this._gltf.nodes;f<u.length;f++){if((l=u[f])._babylonTransformNode&&l._babylonBones)for(var c=0,d=l._babylonBones;c<d.length;c++){d[c].linkTransformNode(l._babylonTransformNode)}}return r.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(r).then((function(){}))},e.prototype._forEachPrimitive=function(e,t){if(e._primitiveBabylonMeshes)for(var n=0,i=e._primitiveBabylonMeshes;n<i.length;n++){t(i[n])}},e.prototype._getMeshes=function(){var e=new Array;e.push(this._rootBabylonMesh);var t=this._gltf.nodes;if(t)for(var n=0,i=t;n<i.length;n++){var r=i[n];this._forEachPrimitive(r,(function(t){e.push(t)}))}return e},e.prototype._getTransformNodes=function(){var e=new Array,t=this._gltf.nodes;if(t)for(var n=0,i=t;n<i.length;n++){var r=i[n];r._babylonTransformNode&&"TransformNode"===r._babylonTransformNode.getClassName()&&e.push(r._babylonTransformNode)}return e},e.prototype._getSkeletons=function(){var e=new Array,t=this._gltf.skins;if(t)for(var n=0,i=t;n<i.length;n++){var r=i[n];r._data&&e.push(r._data.babylonSkeleton)}return e},e.prototype._getAnimationGroups=function(){var e=new Array,t=this._gltf.animations;if(t)for(var n=0,i=t;n<i.length;n++){var r=i[n];r._babylonAnimationGroup&&e.push(r._babylonAnimationGroup)}return e},e.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case d.NONE:break;case d.FIRST:0!==(e=this._getAnimationGroups()).length&&e[0].start(!0);break;case d.ALL:for(var e,t=0,n=e=this._getAnimationGroups();t<n.length;t++){n[t].start(!0)}break;default:return void s.a.Error("Invalid animation start mode ("+this._parent.animationStartMode+")")}},e.prototype.loadNodeAsync=function(t,n,i){var r=this;void 0===i&&(i=function(){});var o=this._extensionsLoadNodeAsync(t,n,i);if(o)return o;if(n._babylonTransformNode)throw new Error(t+": Invalid recursive node hierarchy");var a=new Array;this.logOpen(t+" "+(n.name||""));var s=function(o){if(e.AddPointerMetadata(o,t),e._LoadTransform(n,o),null!=n.camera){var s=Fe.Get(t+"/camera",r._gltf.cameras,n.camera);a.push(r.loadCameraAsync("/cameras/"+s.index,s,(function(e){e.parent=o})))}if(n.children)for(var l=0,f=n.children;l<f.length;l++){var u=f[l],c=Fe.Get(t+"/children/"+u,r._gltf.nodes,u);a.push(r.loadNodeAsync("/nodes/"+c.index,c,(function(e){e.parent=o})))}i(o)};if(null==n.mesh){var l=n.name||"node"+n.index;this._babylonScene._blockEntityCollection=this._forAssetContainer,n._babylonTransformNode=new Oe.a(l,this._babylonScene),this._babylonScene._blockEntityCollection=!1,s(n._babylonTransformNode)}else{var f=Fe.Get(t+"/mesh",this._gltf.meshes,n.mesh);a.push(this._loadMeshAsync("/meshes/"+f.index,n,f,s))}return this.logClose(),Promise.all(a).then((function(){return r._forEachPrimitive(n,(function(e){e.refreshBoundingInfo(!0)})),n._babylonTransformNode}))},e.prototype._loadMeshAsync=function(e,t,n,i){var r=n.primitives;if(!r||!r.length)throw new Error(e+": Primitives are missing");null==r[0].index&&Fe.Assign(r);var o=new Array;this.logOpen(e+" "+(n.name||""));var a=t.name||"node"+t.index;if(1===r.length){var s=n.primitives[0];o.push(this._loadMeshPrimitiveAsync(e+"/primitives/"+s.index,a,t,n,s,(function(e){t._babylonTransformNode=e,t._primitiveBabylonMeshes=[e]})))}else{t._babylonTransformNode=new Oe.a(a,this._babylonScene),t._primitiveBabylonMeshes=[];for(var l=0,f=r;l<f.length;l++){s=f[l];o.push(this._loadMeshPrimitiveAsync(e+"/primitives/"+s.index,a+"_primitive"+s.index,t,n,s,(function(e){e.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(e)})))}}if(null!=t.skin){var u=Fe.Get(e+"/skin",this._gltf.skins,t.skin);o.push(this._loadSkinAsync("/skins/"+u.index,t,u))}return i(t._babylonTransformNode),this.logClose(),Promise.all(o).then((function(){return t._babylonTransformNode}))},e.prototype._loadMeshPrimitiveAsync=function(t,n,i,r,o,a){var s=this,l=this._extensionsLoadMeshPrimitiveAsync(t,n,i,r,o,a);if(l)return l;this.logOpen(""+t);var f,u,c=this._parent.createInstances&&null==i.skin&&!r.primitives[0].targets;if(c&&o._instanceData)f=o._instanceData.babylonSourceMesh.createInstance(n),u=o._instanceData.promise;else{var d=new Array;this._babylonScene._blockEntityCollection=this._forAssetContainer;var h=new z.a(n,this._babylonScene);this._babylonScene._blockEntityCollection=!1,h.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?D.a.CounterClockWiseSideOrientation:D.a.ClockWiseSideOrientation,this._createMorphTargets(t,i,r,o,h),d.push(this._loadVertexDataAsync(t,o,h).then((function(e){return s._loadMorphTargetsAsync(t,o,h,e).then((function(){e.applyToMesh(h)}))})));var p=e._GetDrawMode(t,o.mode);if(null==o.material){var m=this._defaultBabylonMaterialData[p];m||(m=this._createDefaultMaterial("__GLTFLoader._default",p),this._parent.onMaterialLoadedObservable.notifyObservers(m),this._defaultBabylonMaterialData[p]=m),h.material=m}else{var v=Fe.Get(t+"/material",this._gltf.materials,o.material);d.push(this._loadMaterialAsync("/materials/"+v.index,v,h,p,(function(e){h.material=e})))}u=Promise.all(d),c&&(o._instanceData={babylonSourceMesh:h,promise:u}),f=h}return e.AddPointerMetadata(f,t),this._parent.onMeshLoadedObservable.notifyObservers(f),a(f),this.logClose(),u.then((function(){return f}))},e.prototype._loadVertexDataAsync=function(e,t,n){var i=this,r=this._extensionsLoadVertexDataAsync(e,t,n);if(r)return r;var o=t.attributes;if(!o)throw new Error(e+": Attributes are missing");var a=new Array,s=new G.a(n.name,this._babylonScene);if(null==t.indices)n.isUnIndexed=!0;else{var l=Fe.Get(e+"/indices",this._gltf.accessors,t.indices);a.push(this._loadIndicesAccessorAsync("/accessors/"+l.index,l).then((function(e){s.setIndices(e)})))}var f=function(t,r,l){if(null!=o[t]){n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(r)&&n._delayInfo.push(r);var f=Fe.Get(e+"/attributes/"+t,i._gltf.accessors,o[t]);a.push(i._loadVertexAccessorAsync("/accessors/"+f.index,f,r).then((function(e){s.setVerticesBuffer(e,f.count)}))),r==j.b.MatricesIndicesExtraKind&&(n.numBoneInfluencers=8),l&&l(f)}};return f("POSITION",j.b.PositionKind),f("NORMAL",j.b.NormalKind),f("TANGENT",j.b.TangentKind),f("TEXCOORD_0",j.b.UVKind),f("TEXCOORD_1",j.b.UV2Kind),f("JOINTS_0",j.b.MatricesIndicesKind),f("WEIGHTS_0",j.b.MatricesWeightsKind),f("JOINTS_1",j.b.MatricesIndicesExtraKind),f("WEIGHTS_1",j.b.MatricesWeightsExtraKind),f("COLOR_0",j.b.ColorKind,(function(e){"VEC4"===e.type&&(n.hasVertexAlpha=!0)})),Promise.all(a).then((function(){return s}))},e.prototype._createMorphTargets=function(e,t,n,i,r){if(i.targets){if(null==t._numMorphTargets)t._numMorphTargets=i.targets.length;else if(i.targets.length!==t._numMorphTargets)throw new Error(e+": Primitives do not have the same number of targets");var o=n.extras?n.extras.targetNames:null;r.morphTargetManager=new Le.a(r.getScene());for(var a=0;a<i.targets.length;a++){var s=t.weights?t.weights[a]:n.weights?n.weights[a]:0,l=o?o[a]:"morphTarget"+a;r.morphTargetManager.addTarget(new Ce.a(l,s,r.getScene()))}}},e.prototype._loadMorphTargetsAsync=function(e,t,n,i){if(!t.targets)return Promise.resolve();for(var r=new Array,o=n.morphTargetManager,a=0;a<o.numTargets;a++){var s=o.getTarget(a);r.push(this._loadMorphTargetVertexDataAsync(e+"/targets/"+a,i,t.targets[a],s))}return Promise.all(r).then((function(){}))},e.prototype._loadMorphTargetVertexDataAsync=function(e,t,n,i){var r=this,o=new Array,a=function(i,a,s){if(null!=n[i]){var l=t.getVertexBuffer(a);if(l){var f=Fe.Get(e+"/"+i,r._gltf.accessors,n[i]);o.push(r._loadFloatAccessorAsync("/accessors/"+f.index,f).then((function(e){s(l,e)})))}}};return a("POSITION",j.b.PositionKind,(function(e,t){var n=new Float32Array(t.length);e.forEach(t.length,(function(e,i){n[i]=t[i]+e})),i.setPositions(n)})),a("NORMAL",j.b.NormalKind,(function(e,t){var n=new Float32Array(t.length);e.forEach(n.length,(function(e,i){n[i]=t[i]+e})),i.setNormals(n)})),a("TANGENT",j.b.TangentKind,(function(e,t){var n=new Float32Array(t.length/3*4),r=0;e.forEach(t.length/3*4,(function(e,i){(i+1)%4!=0&&(n[r]=t[r]+e,r++)})),i.setTangents(n)})),Promise.all(o).then((function(){}))},e._LoadTransform=function(e,t){if(null==e.skin){var n=P.e.Zero(),i=P.b.Identity(),r=P.e.One();if(e.matrix)P.a.FromArray(e.matrix).decompose(r,i,n);else e.translation&&(n=P.e.FromArray(e.translation)),e.rotation&&(i=P.b.FromArray(e.rotation)),e.scale&&(r=P.e.FromArray(e.scale));t.position=n,t.rotationQuaternion=i,t.scaling=r}},e.prototype._loadSkinAsync=function(e,t,n){var i=this,r=this._extensionsLoadSkinAsync(e,t,n);if(r)return r;var o=function(e){i._forEachPrimitive(t,(function(t){t.skeleton=e}))};if(n._data)return o(n._data.babylonSkeleton),n._data.promise;var a="skeleton"+n.index;this._babylonScene._blockEntityCollection=this._forAssetContainer;var s=new F.a(n.name||a,a,this._babylonScene);this._babylonScene._blockEntityCollection=!1,s.overrideMesh=this._rootBabylonMesh,this._loadBones(e,n,s),o(s);var l=this._loadSkinInverseBindMatricesDataAsync(e,n).then((function(e){i._updateBoneMatrices(s,e)}));return n._data={babylonSkeleton:s,promise:l},l},e.prototype._loadBones=function(e,t,n){for(var i={},r=0,o=t.joints;r<o.length;r++){var a=o[r],s=Fe.Get(e+"/joints/"+a,this._gltf.nodes,a);this._loadBone(s,t,n,i)}},e.prototype._loadBone=function(e,t,n,i){var r=i[e.index];if(r)return r;var o=null;e.parent&&e.parent._babylonTransformNode!==this._rootBabylonMesh&&(o=this._loadBone(e.parent,t,n,i));var a=t.joints.indexOf(e.index);return r=new R.a(e.name||"joint"+e.index,n,o,this._getNodeMatrix(e),null,null,a),i[e.index]=r,e._babylonBones=e._babylonBones||[],e._babylonBones.push(r),r},e.prototype._loadSkinInverseBindMatricesDataAsync=function(e,t){if(null==t.inverseBindMatrices)return Promise.resolve(null);var n=Fe.Get(e+"/inverseBindMatrices",this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/"+n.index,n)},e.prototype._updateBoneMatrices=function(e,t){for(var n=0,i=e.bones;n<i.length;n++){var r=i[n],o=P.a.Identity(),a=r._index;t&&-1!==a&&(P.a.FromArrayToRef(t,16*a,o),o.invertToRef(o));var s=r.getParent();s&&o.multiplyToRef(s.getInvertedAbsoluteTransform(),o),r.updateMatrix(o,!1,!1),r._updateDifferenceMatrix(void 0,!1)}},e.prototype._getNodeMatrix=function(e){return e.matrix?P.a.FromArray(e.matrix):P.a.Compose(e.scale?P.e.FromArray(e.scale):P.e.One(),e.rotation?P.b.FromArray(e.rotation):P.b.Identity(),e.translation?P.e.FromArray(e.translation):P.e.Zero())},e.prototype.loadCameraAsync=function(t,n,i){void 0===i&&(i=function(){});var r=this._extensionsLoadCameraAsync(t,n,i);if(r)return r;var o=new Array;this.logOpen(t+" "+(n.name||"")),this._babylonScene._blockEntityCollection=this._forAssetContainer;var a=new L.a(n.name||"camera"+n.index,P.e.Zero(),this._babylonScene,!1);switch(this._babylonScene._blockEntityCollection=!1,a.rotation=new P.e(0,Math.PI,0),n.type){case"perspective":var s=n.perspective;if(!s)throw new Error(t+": Camera perspective properties are missing");a.fov=s.yfov,a.minZ=s.znear,a.maxZ=s.zfar||Number.MAX_VALUE;break;case"orthographic":if(!n.orthographic)throw new Error(t+": Camera orthographic properties are missing");a.mode=C.a.ORTHOGRAPHIC_CAMERA,a.orthoLeft=-n.orthographic.xmag,a.orthoRight=n.orthographic.xmag,a.orthoBottom=-n.orthographic.ymag,a.orthoTop=n.orthographic.ymag,a.minZ=n.orthographic.znear,a.maxZ=n.orthographic.zfar;break;default:throw new Error(t+": Invalid camera type ("+n.type+")")}return e.AddPointerMetadata(a,t),this._parent.onCameraLoadedObservable.notifyObservers(a),i(a),Promise.all(o).then((function(){return a}))},e.prototype._loadAnimationsAsync=function(){var e=this._gltf.animations;if(!e)return Promise.resolve();for(var t=new Array,n=0;n<e.length;n++){var i=e[n];t.push(this.loadAnimationAsync("/animations/"+i.index,i))}return Promise.all(t).then((function(){}))},e.prototype.loadAnimationAsync=function(e,t){var n=this._extensionsLoadAnimationAsync(e,t);if(n)return n;this._babylonScene._blockEntityCollection=this._forAssetContainer;var i=new Se.a(t.name||"animation"+t.index,this._babylonScene);this._babylonScene._blockEntityCollection=!1,t._babylonAnimationGroup=i;var r=new Array;Fe.Assign(t.channels),Fe.Assign(t.samplers);for(var o=0,a=t.channels;o<a.length;o++){var s=a[o];r.push(this._loadAnimationChannelAsync(e+"/channels/"+s.index,e,t,s,i))}return Promise.all(r).then((function(){return i.normalize(0),i}))},e.prototype._loadAnimationChannelAsync=function(e,t,n,i,r,o){var a=this;if(void 0===o&&(o=null),null==i.target.node)return Promise.resolve();var s=Fe.Get(e+"/target/node",this._gltf.nodes,i.target.node);if("weights"===i.target.path&&!s._numMorphTargets||"weights"!==i.target.path&&!s._babylonTransformNode)return Promise.resolve();var l=Fe.Get(e+"/sampler",n.samplers,i.sampler);return this._loadAnimationSamplerAsync(t+"/samplers/"+i.sampler,l).then((function(t){var n,l;switch(i.target.path){case"translation":n="position",l=M.a.ANIMATIONTYPE_VECTOR3;break;case"rotation":n="rotationQuaternion",l=M.a.ANIMATIONTYPE_QUATERNION;break;case"scale":n="scaling",l=M.a.ANIMATIONTYPE_VECTOR3;break;case"weights":n="influence",l=M.a.ANIMATIONTYPE_FLOAT;break;default:throw new Error(e+"/target/path: Invalid value ("+i.target.path+")")}var f,u,c=0;switch(n){case"position":f=function(){var e=P.e.FromArray(t.output,c);return c+=3,e};break;case"rotationQuaternion":f=function(){var e=P.b.FromArray(t.output,c);return c+=4,e};break;case"scaling":f=function(){var e=P.e.FromArray(t.output,c);return c+=3,e};break;case"influence":f=function(){for(var e=new Array(s._numMorphTargets),n=0;n<s._numMorphTargets;n++)e[n]=t.output[c++];return e}}switch(t.interpolation){case"STEP":u=function(e){return{frame:t.input[e],value:f(),interpolation:Me.a.STEP}};break;case"LINEAR":u=function(e){return{frame:t.input[e],value:f()}};break;case"CUBICSPLINE":u=function(e){return{frame:t.input[e],inTangent:f(),value:f(),outTangent:f()}}}for(var d=new Array(t.input.length),h=0;h<t.input.length;h++)d[h]=u(h);if("influence"===n)for(var p=function(e){var t=r.name+"_channel"+r.targetedAnimations.length,i=new M.a(t,n,1,l);i.setKeys(d.map((function(t){return{frame:t.frame,inTangent:t.inTangent?t.inTangent[e]:void 0,value:t.value[e],outTangent:t.outTangent?t.outTangent[e]:void 0}}))),a._forEachPrimitive(s,(function(t){var n=t.morphTargetManager.getTarget(e),o=i.clone();n.animations.push(o),r.addTargetedAnimation(o,n)}))},m=0;m<s._numMorphTargets;m++)p(m);else{var v=r.name+"_channel"+r.targetedAnimations.length,_=new M.a(v,n,1,l);_.setKeys(d),null!=o&&null!=o.animations?(o.animations.push(_),r.addTargetedAnimation(_,o)):(s._babylonTransformNode.animations.push(_),r.addTargetedAnimation(_,s._babylonTransformNode))}}))},e.prototype._loadAnimationSamplerAsync=function(e,t){if(t._data)return t._data;var n=t.interpolation||"LINEAR";switch(n){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(e+"/interpolation: Invalid value ("+t.interpolation+")")}var i=Fe.Get(e+"/input",this._gltf.accessors,t.input),r=Fe.Get(e+"/output",this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync("/accessors/"+i.index,i),this._loadFloatAccessorAsync("/accessors/"+r.index,r)]).then((function(e){var t=e[0],i=e[1];return{input:t,interpolation:n,output:i}})),t._data},e.prototype._loadBufferAsync=function(e,t,n,i){var r=this._extensionsLoadBufferAsync(e,t,n,i);if(r)return r;if(!t._data)if(t.uri)t._data=this.loadUriAsync(e+"/uri",t,t.uri);else{if(!this._bin)throw new Error(e+": Uri is missing or the binary glTF is missing its binary chunk");t._data=this._bin.readAsync(0,t.byteLength)}return t._data.then((function(t){try{return new Uint8Array(t.buffer,t.byteOffset+n,i)}catch(t){throw new Error(e+": "+t.message)}}))},e.prototype.loadBufferViewAsync=function(e,t){var n=this._extensionsLoadBufferViewAsync(e,t);if(n)return n;if(t._data)return t._data;var i=Fe.Get(e+"/buffer",this._gltf.buffers,t.buffer);return t._data=this._loadBufferAsync("/buffers/"+i.index,i,t.byteOffset||0,t.byteLength),t._data},e.prototype._loadAccessorAsync=function(t,n,i){var r=this;if(n._data)return n._data;var o=e._GetNumComponents(t,n.type),a=o*j.b.GetTypeByteLength(n.componentType),s=o*n.count;if(null==n.bufferView)n._data=Promise.resolve(new i(s));else{var l=Fe.Get(t+"/bufferView",this._gltf.bufferViews,n.bufferView);n._data=this.loadBufferViewAsync("/bufferViews/"+l.index,l).then((function(r){if(5126!==n.componentType||n.normalized){var f=new i(s);return j.b.ForEach(r,n.byteOffset||0,l.byteStride||a,o,n.componentType,f.length,n.normalized||!1,(function(e,t){f[t]=e})),f}return e._GetTypedArray(t,n.componentType,r,n.byteOffset,s)}))}if(n.sparse){var f=n.sparse;n._data=n._data.then((function(s){var l=s,u=Fe.Get(t+"/sparse/indices/bufferView",r._gltf.bufferViews,f.indices.bufferView),c=Fe.Get(t+"/sparse/values/bufferView",r._gltf.bufferViews,f.values.bufferView);return Promise.all([r.loadBufferViewAsync("/bufferViews/"+u.index,u),r.loadBufferViewAsync("/bufferViews/"+c.index,c)]).then((function(r){var s,u=r[0],c=r[1],d=e._GetTypedArray(t+"/sparse/indices",f.indices.componentType,u,f.indices.byteOffset,f.count),h=o*f.count;if(5126!==n.componentType||n.normalized){var p=e._GetTypedArray(t+"/sparse/values",n.componentType,c,f.values.byteOffset,h);s=new i(h),j.b.ForEach(p,0,a,o,n.componentType,s.length,n.normalized||!1,(function(e,t){s[t]=e}))}else s=e._GetTypedArray(t+"/sparse/values",n.componentType,c,f.values.byteOffset,h);for(var m=0,v=0;v<d.length;v++)for(var _=d[v]*o,g=0;g<o;g++)l[_++]=s[m++];return l}))}))}return n._data},e.prototype._loadFloatAccessorAsync=function(e,t){return this._loadAccessorAsync(e,t,Float32Array)},e.prototype._loadIndicesAccessorAsync=function(t,n){if("SCALAR"!==n.type)throw new Error(t+"/type: Invalid value "+n.type);if(5121!==n.componentType&&5123!==n.componentType&&5125!==n.componentType)throw new Error(t+"/componentType: Invalid value "+n.componentType);if(n._data)return n._data;if(n.sparse){var i=e._GetTypedArrayConstructor(t+"/componentType",n.componentType);n._data=this._loadAccessorAsync(t,n,i)}else{var r=Fe.Get(t+"/bufferView",this._gltf.bufferViews,n.bufferView);n._data=this.loadBufferViewAsync("/bufferViews/"+r.index,r).then((function(i){return e._GetTypedArray(t,n.componentType,i,n.byteOffset,n.count)}))}return n._data},e.prototype._loadVertexBufferViewAsync=function(e,t){var n=this;return e._babylonBuffer||(e._babylonBuffer=this.loadBufferViewAsync("/bufferViews/"+e.index,e).then((function(e){return new j.a(n._babylonScene.getEngine(),e,!1)}))),e._babylonBuffer},e.prototype._loadVertexAccessorAsync=function(t,n,i){var r=this;if(n._babylonVertexBuffer)return n._babylonVertexBuffer;if(n.sparse)n._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+n.index,n).then((function(e){return new j.b(r._babylonScene.getEngine(),e,i,!1)}));else if(n.byteOffset&&n.byteOffset%j.b.GetTypeByteLength(n.componentType)!=0)s.a.Warn("Accessor byte offset is not a multiple of component type byte length"),n._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+n.index,n).then((function(e){return new j.b(r._babylonScene.getEngine(),e,i,!1)}));else if(i===j.b.MatricesIndicesKind||i===j.b.MatricesIndicesExtraKind)n._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+n.index,n).then((function(e){return new j.b(r._babylonScene.getEngine(),e,i,!1)}));else{var o=Fe.Get(t+"/bufferView",this._gltf.bufferViews,n.bufferView);n._babylonVertexBuffer=this._loadVertexBufferViewAsync(o,i).then((function(a){var s=e._GetNumComponents(t,n.type);return new j.b(r._babylonScene.getEngine(),a,i,!1,!1,o.byteStride,!1,n.byteOffset,s,n.componentType,n.normalized,!0)}))}return n._babylonVertexBuffer},e.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(e,t,n){if(!(n instanceof Pe.a))throw new Error(e+": Material type not supported");var i=new Array;return t&&(t.baseColorFactor?(n.albedoColor=O.a.FromArray(t.baseColorFactor),n.alpha=t.baseColorFactor[3]):n.albedoColor=O.a.White(),n.metallic=null==t.metallicFactor?1:t.metallicFactor,n.roughness=null==t.roughnessFactor?1:t.roughnessFactor,t.baseColorTexture&&i.push(this.loadTextureInfoAsync(e+"/baseColorTexture",t.baseColorTexture,(function(e){e.name=n.name+" (Base Color)",n.albedoTexture=e}))),t.metallicRoughnessTexture&&(i.push(this.loadTextureInfoAsync(e+"/metallicRoughnessTexture",t.metallicRoughnessTexture,(function(e){e.name=n.name+" (Metallic Roughness)",n.metallicTexture=e}))),n.useMetallnessFromMetallicTextureBlue=!0,n.useRoughnessFromMetallicTextureGreen=!0,n.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(i).then((function(){}))},e.prototype._loadMaterialAsync=function(t,n,i,r,o){void 0===o&&(o=function(){});var a=this._extensionsLoadMaterialAsync(t,n,i,r,o);if(a)return a;n._data=n._data||{};var s=n._data[r];if(!s){this.logOpen(t+" "+(n.name||""));var l=this.createMaterial(t,n,r);s={babylonMaterial:l,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,n,l)},n._data[r]=s,e.AddPointerMetadata(l,t),this._parent.onMaterialLoadedObservable.notifyObservers(l),this.logClose()}return s.babylonMeshes.push(i),i.onDisposeObservable.addOnce((function(){var e=s.babylonMeshes.indexOf(i);-1!==e&&s.babylonMeshes.splice(e,1)})),o(s.babylonMaterial),s.promise.then((function(){return s.babylonMaterial}))},e.prototype._createDefaultMaterial=function(e,t){this._babylonScene._blockEntityCollection=this._forAssetContainer;var n=new Pe.a(e,this._babylonScene);return this._babylonScene._blockEntityCollection=!1,n.fillMode=t,n.enableSpecularAntiAliasing=!0,n.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,n.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,n.transparencyMode=Pe.a.PBRMATERIAL_OPAQUE,n.metallic=1,n.roughness=1,n},e.prototype.createMaterial=function(e,t,n){var i=this._extensionsCreateMaterial(e,t,n);if(i)return i;var r=t.name||"material"+t.index;return this._createDefaultMaterial(r,n)},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var i=this._extensionsLoadMaterialPropertiesAsync(e,t,n);if(i)return i;var r=new Array;return r.push(this.loadMaterialBasePropertiesAsync(e,t,n)),t.pbrMetallicRoughness&&r.push(this._loadMaterialMetallicRoughnessPropertiesAsync(e+"/pbrMetallicRoughness",t.pbrMetallicRoughness,n)),this.loadMaterialAlphaProperties(e,t,n),Promise.all(r).then((function(){}))},e.prototype.loadMaterialBasePropertiesAsync=function(e,t,n){if(!(n instanceof Pe.a))throw new Error(e+": Material type not supported");var i=new Array;return n.emissiveColor=t.emissiveFactor?O.a.FromArray(t.emissiveFactor):new O.a(0,0,0),t.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),t.normalTexture&&(i.push(this.loadTextureInfoAsync(e+"/normalTexture",t.normalTexture,(function(e){e.name=n.name+" (Normal)",n.bumpTexture=e}))),n.invertNormalMapX=!this._babylonScene.useRightHandedSystem,n.invertNormalMapY=this._babylonScene.useRightHandedSystem,null!=t.normalTexture.scale&&(n.bumpTexture.level=t.normalTexture.scale),n.forceIrradianceInFragment=!0),t.occlusionTexture&&(i.push(this.loadTextureInfoAsync(e+"/occlusionTexture",t.occlusionTexture,(function(e){e.name=n.name+" (Occlusion)",n.ambientTexture=e}))),n.useAmbientInGrayScale=!0,null!=t.occlusionTexture.strength&&(n.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&i.push(this.loadTextureInfoAsync(e+"/emissiveTexture",t.emissiveTexture,(function(e){e.name=n.name+" (Emissive)",n.emissiveTexture=e}))),Promise.all(i).then((function(){}))},e.prototype.loadMaterialAlphaProperties=function(e,t,n){if(!(n instanceof Pe.a))throw new Error(e+": Material type not supported");switch(t.alphaMode||"OPAQUE"){case"OPAQUE":n.transparencyMode=Pe.a.PBRMATERIAL_OPAQUE;break;case"MASK":n.transparencyMode=Pe.a.PBRMATERIAL_ALPHATEST,n.alphaCutOff=null==t.alphaCutoff?.5:t.alphaCutoff,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0);break;case"BLEND":n.transparencyMode=Pe.a.PBRMATERIAL_ALPHABLEND,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0,n.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(e+"/alphaMode: Invalid value ("+t.alphaMode+")")}},e.prototype.loadTextureInfoAsync=function(t,n,i){var r=this;void 0===i&&(i=function(){});var o=this._extensionsLoadTextureInfoAsync(t,n,i);if(o)return o;if(this.logOpen(""+t),n.texCoord>=2)throw new Error(t+"/texCoord: Invalid value ("+n.texCoord+")");var a=Fe.Get(t+"/index",this._gltf.textures,n.index),s=this._loadTextureAsync("/textures/"+n.index,a,(function(o){o.coordinatesIndex=n.texCoord||0,e.AddPointerMetadata(o,t),r._parent.onTextureLoadedObservable.notifyObservers(o),i(o)}));return this.logClose(),s},e.prototype._loadTextureAsync=function(t,n,i){void 0===i&&(i=function(){});var r=this._extensionsLoadTextureAsync(t,n,i);if(r)return r;this.logOpen(t+" "+(n.name||""));var o=null==n.sampler?e.DefaultSampler:Fe.Get(t+"/sampler",this._gltf.samplers,n.sampler),a=Fe.Get(t+"/source",this._gltf.images,n.source),s=this._createTextureAsync(t,o,a,i);return this.logClose(),s},e.prototype._createTextureAsync=function(e,t,n,i){var r=this;void 0===i&&(i=function(){});var o=this._loadSampler("/samplers/"+t.index,t),a=new Array,s=new Ae.a;this._babylonScene._blockEntityCollection=this._forAssetContainer;var l=new U.a(null,this._babylonScene,o.noMipMaps,!1,o.samplingMode,(function(){r._disposed||s.resolve()}),(function(t,n){r._disposed||s.reject(new Error(e+": "+(n&&n.message?n.message:t||"Failed to load texture")))}),void 0,void 0,void 0,n.mimeType);return this._babylonScene._blockEntityCollection=!1,a.push(s.promise),a.push(this.loadImageAsync("/images/"+n.index,n).then((function(e){var t=n.uri||r._fileName+"#image"+n.index,i="data:"+r._uniqueRootUrl+t;l.updateURL(i,e)}))),l.wrapU=o.wrapU,l.wrapV=o.wrapV,i(l),Promise.all(a).then((function(){return l}))},e.prototype._loadSampler=function(t,n){return n._data||(n._data={noMipMaps:9728===n.minFilter||9729===n.minFilter,samplingMode:e._GetTextureSamplingMode(t,n),wrapU:e._GetTextureWrapMode(t+"/wrapS",n.wrapS),wrapV:e._GetTextureWrapMode(t+"/wrapT",n.wrapT)}),n._data},e.prototype.loadImageAsync=function(e,t){if(!t._data){if(this.logOpen(e+" "+(t.name||"")),t.uri)t._data=this.loadUriAsync(e+"/uri",t,t.uri);else{var n=Fe.Get(e+"/bufferView",this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync("/bufferViews/"+n.index,n)}this.logClose()}return t._data},e.prototype.loadUriAsync=function(t,n,i){var o=this,a=this._extensionsLoadUriAsync(t,n,i);if(a)return a;if(!e._ValidateUri(i))throw new Error(t+": '"+i+"' is invalid");if(r.b.IsBase64(i)){var s=new Uint8Array(r.b.DecodeBase64(i));return this.log("Decoded "+i.substr(0,64)+"... ("+s.length+" bytes)"),Promise.resolve(s)}return this.log("Loading "+i),this._parent.preprocessUrlAsync(this._rootUrl+i).then((function(e){return new Promise((function(n,a){if(!o._disposed){var s=r.b.LoadFile(e,(function(e){if(!o._disposed){var t=new Uint8Array(e);o.log("Loaded "+i+" ("+t.length+" bytes)"),n(t)}}),(function(e){if(!o._disposed&&(s&&(s._lengthComputable=e.lengthComputable,s._loaded=e.loaded,s._total=e.total),o._state===h.LOADING))try{o._onProgress()}catch(e){a(e)}}),o._babylonScene.offlineProvider,!0,(function(e,n){o._disposed||a(new Re.b(t+": Failed to load '"+i+"'"+(e?": "+e.status+" "+e.statusText:""),e))}));o._requests.push(s)}}))}))},e.prototype._onProgress=function(){if(this._progressCallback){for(var e=!0,t=0,n=0,i=0,r=this._requests;i<r.length;i++){var a=r[i];if(void 0===a._lengthComputable||void 0===a._loaded||void 0===a._total)return;e=e&&a._lengthComputable,t+=a._loaded,n+=a._total}this._progressCallback(new o.b(e,t,e?n:0))}},e.AddPointerMetadata=function(e,t){var n=e.metadata=e.metadata||{},i=n.gltf=n.gltf||{};(i.pointers=i.pointers||[]).push(t)},e._GetTextureWrapMode=function(e,t){switch(t=null==t?10497:t){case 33071:return U.a.CLAMP_ADDRESSMODE;case 33648:return U.a.MIRROR_ADDRESSMODE;case 10497:return U.a.WRAP_ADDRESSMODE;default:return s.a.Warn(e+": Invalid value ("+t+")"),U.a.WRAP_ADDRESSMODE}},e._GetTextureSamplingMode=function(e,t){var n=null==t.magFilter?9729:t.magFilter,i=null==t.minFilter?9987:t.minFilter;if(9729===n)switch(i){case 9728:return U.a.LINEAR_NEAREST;case 9729:return U.a.LINEAR_LINEAR;case 9984:return U.a.LINEAR_NEAREST_MIPNEAREST;case 9985:return U.a.LINEAR_LINEAR_MIPNEAREST;case 9986:return U.a.LINEAR_NEAREST_MIPLINEAR;case 9987:return U.a.LINEAR_LINEAR_MIPLINEAR;default:return s.a.Warn(e+"/minFilter: Invalid value ("+i+")"),U.a.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==n&&s.a.Warn(e+"/magFilter: Invalid value ("+n+")"),i){case 9728:return U.a.NEAREST_NEAREST;case 9729:return U.a.NEAREST_LINEAR;case 9984:return U.a.NEAREST_NEAREST_MIPNEAREST;case 9985:return U.a.NEAREST_LINEAR_MIPNEAREST;case 9986:return U.a.NEAREST_NEAREST_MIPLINEAR;case 9987:return U.a.NEAREST_LINEAR_MIPLINEAR;default:return s.a.Warn(e+"/minFilter: Invalid value ("+i+")"),U.a.NEAREST_NEAREST_MIPNEAREST}},e._GetTypedArrayConstructor=function(e,t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(e+": Invalid component type "+t)}},e._GetTypedArray=function(t,n,i,r,o){var a=i.buffer;r=i.byteOffset+(r||0);var s=e._GetTypedArrayConstructor(t+"/componentType",n);try{return new s(a,r,o)}catch(e){throw new Error(t+": "+e)}},e._GetNumComponents=function(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(e+": Invalid type ("+t+")")},e._ValidateUri=function(e){return r.b.IsBase64(e)||-1===e.indexOf("..")},e._GetDrawMode=function(e,t){switch(null==t&&(t=4),t){case 0:return D.a.PointListDrawMode;case 1:return D.a.LineListDrawMode;case 2:return D.a.LineLoopDrawMode;case 3:return D.a.LineStripDrawMode;case 4:return D.a.TriangleFillMode;case 5:return D.a.TriangleStripDrawMode;case 6:return D.a.TriangleFanDrawMode}throw new Error(e+": Invalid mesh primitive mode ("+t+")")},e.prototype._compileMaterialsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile materials");var t=new Array;if(this._gltf.materials)for(var n=0,i=this._gltf.materials;n<i.length;n++){var r=i[n];if(r._data)for(var o in r._data)for(var a=r._data[o],s=0,l=a.babylonMeshes;s<l.length;s++){var f=l[s];f.computeWorldMatrix(!0);var u=a.babylonMaterial;t.push(u.forceCompilationAsync(f)),t.push(u.forceCompilationAsync(f,{useInstances:!0})),this._parent.useClipPlane&&(t.push(u.forceCompilationAsync(f,{clipPlane:!0})),t.push(u.forceCompilationAsync(f,{clipPlane:!0,useInstances:!0})))}}return Promise.all(t).then((function(){e._parent._endPerformanceCounter("Compile materials")}))},e.prototype._compileShadowGeneratorsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var t=new Array,n=0,i=this._babylonScene.lights;n<i.length;n++){var r=i[n].getShadowGenerator();r&&t.push(r.forceCompilationAsync())}return Promise.all(t).then((function(){e._parent._endPerformanceCounter("Compile shadow generators")}))},e.prototype._forEachExtensions=function(e){for(var t=0,n=this._extensions;t<n.length;t++){var i=n[t];i.enabled&&e(i)}},e.prototype._applyExtensions=function(e,t,n){for(var i=0,r=this._extensions;i<r.length;i++){var o=r[i];if(o.enabled){var a=o.name+"."+t,s=e;s._activeLoaderExtensionFunctions=s._activeLoaderExtensionFunctions||{};var l=s._activeLoaderExtensionFunctions;if(!l[a]){l[a]=!0;try{var f=n(o);if(f)return f}finally{delete l[a]}}}}return null},e.prototype._extensionsOnLoading=function(){this._forEachExtensions((function(e){return e.onLoading&&e.onLoading()}))},e.prototype._extensionsOnReady=function(){this._forEachExtensions((function(e){return e.onReady&&e.onReady()}))},e.prototype._extensionsLoadSceneAsync=function(e,t){return this._applyExtensions(t,"loadScene",(function(n){return n.loadSceneAsync&&n.loadSceneAsync(e,t)}))},e.prototype._extensionsLoadNodeAsync=function(e,t,n){return this._applyExtensions(t,"loadNode",(function(i){return i.loadNodeAsync&&i.loadNodeAsync(e,t,n)}))},e.prototype._extensionsLoadCameraAsync=function(e,t,n){return this._applyExtensions(t,"loadCamera",(function(i){return i.loadCameraAsync&&i.loadCameraAsync(e,t,n)}))},e.prototype._extensionsLoadVertexDataAsync=function(e,t,n){return this._applyExtensions(t,"loadVertexData",(function(i){return i._loadVertexDataAsync&&i._loadVertexDataAsync(e,t,n)}))},e.prototype._extensionsLoadMeshPrimitiveAsync=function(e,t,n,i,r,o){return this._applyExtensions(r,"loadMeshPrimitive",(function(a){return a._loadMeshPrimitiveAsync&&a._loadMeshPrimitiveAsync(e,t,n,i,r,o)}))},e.prototype._extensionsLoadMaterialAsync=function(e,t,n,i,r){return this._applyExtensions(t,"loadMaterial",(function(o){return o._loadMaterialAsync&&o._loadMaterialAsync(e,t,n,i,r)}))},e.prototype._extensionsCreateMaterial=function(e,t,n){return this._applyExtensions(t,"createMaterial",(function(i){return i.createMaterial&&i.createMaterial(e,t,n)}))},e.prototype._extensionsLoadMaterialPropertiesAsync=function(e,t,n){return this._applyExtensions(t,"loadMaterialProperties",(function(i){return i.loadMaterialPropertiesAsync&&i.loadMaterialPropertiesAsync(e,t,n)}))},e.prototype._extensionsLoadTextureInfoAsync=function(e,t,n){return this._applyExtensions(t,"loadTextureInfo",(function(i){return i.loadTextureInfoAsync&&i.loadTextureInfoAsync(e,t,n)}))},e.prototype._extensionsLoadTextureAsync=function(e,t,n){return this._applyExtensions(t,"loadTexture",(function(i){return i._loadTextureAsync&&i._loadTextureAsync(e,t,n)}))},e.prototype._extensionsLoadAnimationAsync=function(e,t){return this._applyExtensions(t,"loadAnimation",(function(n){return n.loadAnimationAsync&&n.loadAnimationAsync(e,t)}))},e.prototype._extensionsLoadSkinAsync=function(e,t,n){return this._applyExtensions(n,"loadSkin",(function(i){return i._loadSkinAsync&&i._loadSkinAsync(e,t,n)}))},e.prototype._extensionsLoadUriAsync=function(e,t,n){return this._applyExtensions(t,"loadUri",(function(i){return i._loadUriAsync&&i._loadUriAsync(e,t,n)}))},e.prototype._extensionsLoadBufferViewAsync=function(e,t){return this._applyExtensions(t,"loadBufferView",(function(n){return n.loadBufferViewAsync&&n.loadBufferViewAsync(e,t)}))},e.prototype._extensionsLoadBufferAsync=function(e,t,n,i){return this._applyExtensions(t,"loadBuffer",(function(r){return r.loadBufferAsync&&r.loadBufferAsync(e,t,n,i)}))},e.LoadExtensionAsync=function(e,t,n,i){if(!t.extensions)return null;var r=t.extensions[n];return r?i(e+"/extensions/"+n,r):null},e.LoadExtraAsync=function(e,t,n,i){if(!t.extras)return null;var r=t.extras[n];return r?i(e+"/extras/"+n,r):null},e.prototype.isExtensionUsed=function(e){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(e)},e.prototype.logOpen=function(e){this._parent._logOpen(e)},e.prototype.logClose=function(){this._parent._logClose()},e.prototype.log=function(e){this._parent._log(e)},e.prototype.startPerformanceCounter=function(e){this._parent._startPerformanceCounter(e)},e.prototype.endPerformanceCounter=function(e){this._parent._endPerformanceCounter(e)},e._RegisteredExtensions={},e.DefaultSampler={index:-1},e}();m._CreateGLTF2Loader=function(e){return new Ne(e)};var De=n(48),Ie=n(116),we=n(174),Ve="EXT_lights_image_based",Ue=function(){function e(e){this.name=Ve,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ve)}return e.prototype.dispose=function(){delete this._loader,delete this._lights},e.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._lights=t.lights}},e.prototype.loadSceneAsync=function(e,t){var n=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(i,r){var o=new Array;o.push(n._loader.loadSceneAsync(e,t)),n._loader.logOpen(""+i);var a=Fe.Get(i+"/light",n._lights,r.light);return o.push(n._loadLightAsync("#/extensions/"+n.name+"/lights/"+r.light,a).then((function(e){n._loader.babylonScene.environmentTexture=e}))),n._loader.logClose(),Promise.all(o).then((function(){}))}))},e.prototype._loadLightAsync=function(e,t){var n=this;if(!t._loaded){var i=new Array;this._loader.logOpen(""+e);for(var r=new Array(t.specularImages.length),o=function(n){var o=t.specularImages[n];r[n]=new Array(o.length);for(var s=function(t){var s=e+"/specularImages/"+n+"/"+t;a._loader.logOpen(""+s);var l=o[t],f=Fe.Get(s,a._loader.gltf.images,l);i.push(a._loader.loadImageAsync("#/images/"+l,f).then((function(e){r[n][t]=e}))),a._loader.logClose()},l=0;l<o.length;l++)s(l)},a=this,s=0;s<t.specularImages.length;s++)o(s);this._loader.logClose(),t._loaded=Promise.all(i).then((function(){var e=new we.a(n._loader.babylonScene,null,t.specularImageSize);if(t._babylonTexture=e,null!=t.intensity&&(e.level=t.intensity),t.rotation){var i=P.b.FromArray(t.rotation);n._loader.babylonScene.useRightHandedSystem||(i=P.b.Inverse(i)),P.a.FromQuaternionToRef(i,e.getReflectionTextureMatrix())}var o=Ie.a.FromArray(t.irradianceCoefficients);o.scaleInPlace(t.intensity),o.convertIrradianceToLambertianRadiance();var a=Ie.b.FromHarmonics(o),s=(r.length-1)/De.a.Log2(t.specularImageSize);return e.updateRGBDAsync(r,a,s)}))}return t._loaded.then((function(){return t._babylonTexture}))},e}();Ne.RegisterExtension(Ve,(function(e){return new Ue(e)}));var Be=n(175),je=function(){function e(e){this.name="KHR_draco_mesh_compression",this._loader=e,this.enabled=Be.a.DecoderAvailable&&this._loader.isExtensionUsed("KHR_draco_mesh_compression")}return e.prototype.dispose=function(){delete this.dracoCompression,delete this._loader},e.prototype._loadVertexDataAsync=function(e,t,n){var i=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(r,o){if(null!=t.mode){if(5!==t.mode&&4!==t.mode)throw new Error(e+": Unsupported mode "+t.mode);if(5===t.mode)throw new Error(e+": Mode "+t.mode+" is not currently supported")}var a={},s=function(e,t){var i=o.attributes[e];null!=i&&(n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(t)&&n._delayInfo.push(t),a[t]=i)};s("POSITION",j.b.PositionKind),s("NORMAL",j.b.NormalKind),s("TANGENT",j.b.TangentKind),s("TEXCOORD_0",j.b.UVKind),s("TEXCOORD_1",j.b.UV2Kind),s("JOINTS_0",j.b.MatricesIndicesKind),s("WEIGHTS_0",j.b.MatricesWeightsKind),s("COLOR_0",j.b.ColorKind);var l=Fe.Get(r,i._loader.gltf.bufferViews,o.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=i._loader.loadBufferViewAsync("#/bufferViews/"+l.index,l).then((function(t){return(i.dracoCompression||Be.a.Default).decodeMeshAsync(t,a).then((function(e){var t=new G.a(n.name,i._loader.babylonScene);return e.applyToGeometry(t),t})).catch((function(t){throw new Error(e+": "+t.message)}))}))),l._dracoBabylonGeometry}))},e}();Ne.RegisterExtension("KHR_draco_mesh_compression",(function(e){return new je(e)}));var Ge,ke=n(87);!function(e){e.DIRECTIONAL="directional",e.POINT="point",e.SPOT="spot"}(Ge||(Ge={}));var He=function(){function e(e){this.name="KHR_lights_punctual",this._loader=e,this.enabled=this._loader.isExtensionUsed("KHR_lights_punctual")}return e.prototype.dispose=function(){delete this._loader,delete this._lights},e.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._lights=t.lights}},e.prototype.loadNodeAsync=function(e,t,n){var i=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(r,o){return i._loader.loadNodeAsync(e,t,(function(e){var t,a=Fe.Get(r,i._lights,o.light),s=a.name||e.name;switch(i._loader.babylonScene._blockEntityCollection=i._loader._forAssetContainer,a.type){case Ge.DIRECTIONAL:t=new X.a(s,P.e.Backward(),i._loader.babylonScene);break;case Ge.POINT:t=new K.a(s,P.e.Zero(),i._loader.babylonScene);break;case Ge.SPOT:var l=new Z.a(s,P.e.Zero(),P.e.Backward(),0,1,i._loader.babylonScene);l.angle=2*(a.spot&&a.spot.outerConeAngle||Math.PI/4),l.innerAngle=2*(a.spot&&a.spot.innerConeAngle||0),t=l;break;default:throw i._loader.babylonScene._blockEntityCollection=!1,new Error(r+": Invalid light type ("+a.type+")")}i._loader.babylonScene._blockEntityCollection=!1,t.falloffType=ke.a.FALLOFF_GLTF,t.diffuse=a.color?O.a.FromArray(a.color):O.a.White(),t.intensity=null==a.intensity?1:a.intensity,t.range=null==a.range?Number.MAX_VALUE:a.range,t.parent=e,i._loader._babylonLights.push(t),Ne.AddPointerMetadata(t,r),n(e)}))}))},e}();Ne.RegisterExtension("KHR_lights_punctual",(function(e){return new He(e)}));var ze=function(){function e(e){this.name="KHR_materials_pbrSpecularGlossiness",this.order=200,this._loader=e,this.enabled=this._loader.isExtensionUsed("KHR_materials_pbrSpecularGlossiness")}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var i=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(r,o){var a=new Array;return a.push(i._loader.loadMaterialBasePropertiesAsync(e,t,n)),a.push(i._loadSpecularGlossinessPropertiesAsync(r,t,o,n)),i._loader.loadMaterialAlphaProperties(e,t,n),Promise.all(a).then((function(){}))}))},e.prototype._loadSpecularGlossinessPropertiesAsync=function(e,t,n,i){if(!(i instanceof Pe.a))throw new Error(e+": Material type not supported");var r=new Array;return i.metallic=null,i.roughness=null,n.diffuseFactor?(i.albedoColor=O.a.FromArray(n.diffuseFactor),i.alpha=n.diffuseFactor[3]):i.albedoColor=O.a.White(),i.reflectivityColor=n.specularFactor?O.a.FromArray(n.specularFactor):O.a.White(),i.microSurface=null==n.glossinessFactor?1:n.glossinessFactor,n.diffuseTexture&&r.push(this._loader.loadTextureInfoAsync(e+"/diffuseTexture",n.diffuseTexture,(function(e){e.name=i.name+" (Diffuse)",i.albedoTexture=e}))),n.specularGlossinessTexture&&(r.push(this._loader.loadTextureInfoAsync(e+"/specularGlossinessTexture",n.specularGlossinessTexture,(function(e){e.name=i.name+" (Specular Glossiness)",i.reflectivityTexture=e}))),i.reflectivityTexture.hasAlpha=!0,i.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(r).then((function(){}))},e}();Ne.RegisterExtension("KHR_materials_pbrSpecularGlossiness",(function(e){return new ze(e)}));var We=function(){function e(e){this.name="KHR_materials_unlit",this.order=210,this._loader=e,this.enabled=this._loader.isExtensionUsed("KHR_materials_unlit")}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var i=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(){return i._loadUnlitPropertiesAsync(e,t,n)}))},e.prototype._loadUnlitPropertiesAsync=function(e,t,n){if(!(n instanceof Pe.a))throw new Error(e+": Material type not supported");var i=new Array;n.unlit=!0;var r=t.pbrMetallicRoughness;return r&&(r.baseColorFactor?(n.albedoColor=O.a.FromArray(r.baseColorFactor),n.alpha=r.baseColorFactor[3]):n.albedoColor=O.a.White(),r.baseColorTexture&&i.push(this._loader.loadTextureInfoAsync(e+"/baseColorTexture",r.baseColorTexture,(function(e){e.name=n.name+" (Base Color)",n.albedoTexture=e})))),t.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,t,n),Promise.all(i).then((function(){}))},e}();Ne.RegisterExtension("KHR_materials_unlit",(function(e){return new We(e)}));var Xe=function(){function e(e){this.name="KHR_materials_clearcoat",this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed("KHR_materials_clearcoat")}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var i=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(r,o){var a=new Array;return a.push(i._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(i._loadClearCoatPropertiesAsync(r,o,n)),Promise.all(a).then((function(){}))}))},e.prototype._loadClearCoatPropertiesAsync=function(e,t,n){if(!(n instanceof Pe.a))throw new Error(e+": Material type not supported");var i=new Array;return n.clearCoat.isEnabled=!0,null!=t.clearcoatFactor?n.clearCoat.intensity=t.clearcoatFactor:n.clearCoat.intensity=0,t.clearcoatTexture&&i.push(this._loader.loadTextureInfoAsync(e+"/clearcoatTexture",t.clearcoatTexture,(function(e){e.name=n.name+" (ClearCoat Intensity)",n.clearCoat.texture=e}))),null!=t.clearcoatRoughnessFactor?n.clearCoat.roughness=t.clearcoatRoughnessFactor:n.clearCoat.roughness=0,t.clearcoatRoughnessTexture&&i.push(this._loader.loadTextureInfoAsync(e+"/clearcoatRoughnessTexture",t.clearcoatRoughnessTexture,(function(e){e.name=n.name+" (ClearCoat Roughness)",n.clearCoat.texture=e}))),t.clearcoatNormalTexture&&(i.push(this._loader.loadTextureInfoAsync(e+"/clearcoatNormalTexture",t.clearcoatNormalTexture,(function(e){e.name=n.name+" (ClearCoat Normal)",n.clearCoat.bumpTexture=e}))),n.invertNormalMapX=!n.getScene().useRightHandedSystem,n.invertNormalMapY=n.getScene().useRightHandedSystem,null!=t.clearcoatNormalTexture.scale&&(n.clearCoat.bumpTexture.level=t.clearcoatNormalTexture.scale)),Promise.all(i).then((function(){}))},e}();Ne.RegisterExtension("KHR_materials_clearcoat",(function(e){return new Xe(e)}));var Ke=function(){function e(e){this.name="KHR_materials_sheen",this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed("KHR_materials_sheen")}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var i=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(r,o){var a=new Array;return a.push(i._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(i._loadSheenPropertiesAsync(r,o,n)),Promise.all(a).then((function(){}))}))},e.prototype._loadSheenPropertiesAsync=function(e,t,n){if(!(n instanceof Pe.a))throw new Error(e+": Material type not supported");var i=new Array;return n.sheen.isEnabled=!0,null!=t.intensityFactor?n.sheen.intensity=t.intensityFactor:n.sheen.intensity=0,null!=t.colorFactor&&(n.sheen.color=O.a.FromArray(t.colorFactor)),t.colorIntensityTexture&&i.push(this._loader.loadTextureInfoAsync(e+"/sheenTexture",t.colorIntensityTexture,(function(e){e.name=n.name+" (Sheen Intensity)",n.sheen.texture=e}))),Promise.all(i).then((function(){}))},e}();Ne.RegisterExtension("KHR_materials_sheen",(function(e){return new Ke(e)}));var Ze=function(){function e(e){this.name="KHR_materials_specular",this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed("KHR_materials_specular")}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var i=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(r,o){var a=new Array;return a.push(i._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(i._loadSpecularPropertiesAsync(r,o,n)),Promise.all(a).then((function(){}))}))},e.prototype._loadSpecularPropertiesAsync=function(e,t,n){if(!(n instanceof Pe.a))throw new Error(e+": Material type not supported");return void 0!==t.specularFactor&&(n.metallicF0Factor=t.specularFactor),t.specularTexture&&(n.useMetallicF0FactorFromMetallicTexture=!0),Promise.resolve()},e}();Ne.RegisterExtension("KHR_materials_specular",(function(e){return new Ze(e)}));var Ye=function(){function e(e){this.name="KHR_mesh_quantization",this.enabled=e.isExtensionUsed("KHR_mesh_quantization")}return e.prototype.dispose=function(){},e}();Ne.RegisterExtension("KHR_mesh_quantization",(function(e){return new Ye(e)}));var qe=function(){function e(e){this.name="KHR_texture_basisu",this._loader=e,this.enabled=e.isExtensionUsed("KHR_texture_basisu")}return e.prototype.dispose=function(){delete this._loader},e.prototype._loadTextureAsync=function(e,t,n){var i=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(r,o){var a=null==t.sampler?Ne.DefaultSampler:Fe.Get(e+"/sampler",i._loader.gltf.samplers,t.sampler),s=Fe.Get(r+"/source",i._loader.gltf.images,o.source);return i._loader._createTextureAsync(e,a,s,(function(e){e.gammaSpace=!1,n(e)}))}))},e}();Ne.RegisterExtension("KHR_texture_basisu",(function(e){return new qe(e)}));var Je=function(){function e(e){this.name="KHR_texture_transform",this._loader=e,this.enabled=this._loader.isExtensionUsed("KHR_texture_transform")}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadTextureInfoAsync=function(e,t,n){var i=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(r,o){return i._loader.loadTextureInfoAsync(e,t,(function(e){if(!(e instanceof U.a))throw new Error(r+": Texture type not supported");o.offset&&(e.uOffset=o.offset[0],e.vOffset=o.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,o.rotation&&(e.wAng=-o.rotation),o.scale&&(e.uScale=o.scale[0],e.vScale=o.scale[1]),null!=o.texCoord&&(e.coordinatesIndex=o.texCoord),n(e)}))}))},e}();Ne.RegisterExtension("KHR_texture_transform",(function(e){return new Je(e)}));var Qe=n(166),$e=n(144),et=n(167),tt=function(){function e(e){this.name="MSFT_audio_emitter",this._loader=e,this.enabled=this._loader.isExtensionUsed("MSFT_audio_emitter")}return e.prototype.dispose=function(){delete this._loader,delete this._clips,delete this._emitters},e.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._clips=t.clips,this._emitters=t.emitters,Fe.Assign(this._clips),Fe.Assign(this._emitters)}},e.prototype.loadSceneAsync=function(e,t){var n=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(i,r){var o=new Array;o.push(n._loader.loadSceneAsync(e,t));for(var a=0,s=r.emitters;a<s.length;a++){var l=s[a],f=Fe.Get(i+"/emitters",n._emitters,l);if(null!=f.refDistance||null!=f.maxDistance||null!=f.rolloffFactor||null!=f.distanceModel||null!=f.innerAngle||null!=f.outerAngle)throw new Error(i+": Direction or Distance properties are not allowed on emitters attached to a scene");o.push(n._loadEmitterAsync(i+"/emitters/"+f.index,f))}return Promise.all(o).then((function(){}))}))},e.prototype.loadNodeAsync=function(e,t,n){var i=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(e,o){var a=new Array;return i._loader.loadNodeAsync(e,t,(function(t){for(var s=function(n){var o=Fe.Get(e+"/emitters",i._emitters,n);a.push(i._loadEmitterAsync(e+"/emitters/"+o.index,o).then((function(){for(var e=0,n=o._babylonSounds;e<n.length;e++){var i=n[e];i.attachToMesh(t),null==o.innerAngle&&null==o.outerAngle||(i.setLocalDirectionToMesh(P.e.Forward()),i.setDirectionalCone(2*r.b.ToDegrees(null==o.innerAngle?Math.PI:o.innerAngle),2*r.b.ToDegrees(null==o.outerAngle?Math.PI:o.outerAngle),0))}})))},l=0,f=o.emitters;l<f.length;l++){s(f[l])}n(t)})).then((function(e){return Promise.all(a).then((function(){return e}))}))}))},e.prototype.loadAnimationAsync=function(e,t){var n=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(i,r){return n._loader.loadAnimationAsync(e,t).then((function(o){var a=new Array;Fe.Assign(r.events);for(var s=0,l=r.events;s<l.length;s++){var f=l[s];a.push(n._loadAnimationEventAsync(i+"/events/"+f.index,e,t,f,o))}return Promise.all(a).then((function(){return o}))}))}))},e.prototype._loadClipAsync=function(e,t){if(t._objectURL)return t._objectURL;var n;if(t.uri)n=this._loader.loadUriAsync(e,t,t.uri);else{var i=Fe.Get(e+"/bufferView",this._loader.gltf.bufferViews,t.bufferView);n=this._loader.loadBufferViewAsync("#/bufferViews/"+i.index,i)}return t._objectURL=n.then((function(e){return URL.createObjectURL(new Blob([e],{type:t.mimeType}))})),t._objectURL},e.prototype._loadEmitterAsync=function(e,t){var n=this;if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){for(var i=new Array,o=t.name||"emitter"+t.index,a={loop:!1,autoplay:!1,volume:null==t.volume?1:t.volume},s=function(e){var r="#/extensions/"+l.name+"/clips",s=Fe.Get(r,l._clips,t.clips[e].clip);i.push(l._loadClipAsync(r+"/"+t.clips[e].clip,s).then((function(i){var r=t._babylonSounds[e]=new $e.a(o,i,n._loader.babylonScene,null,a);r.refDistance=t.refDistance||1,r.maxDistance=t.maxDistance||256,r.rolloffFactor=t.rolloffFactor||1,r.distanceModel=t.distanceModel||"exponential",r._positionInEmitterSpace=!0})))},l=this,f=0;f<t.clips.length;f++)s(f);var u=Promise.all(i).then((function(){var e=t.clips.map((function(e){return e.weight||1})),n=new et.a(t.loop||!1,t._babylonSounds,e);t.innerAngle&&(n.directionalConeInnerAngle=2*r.b.ToDegrees(t.innerAngle)),t.outerAngle&&(n.directionalConeOuterAngle=2*r.b.ToDegrees(t.outerAngle)),t.volume&&(n.volume=t.volume),t._babylonData.sound=n}));t._babylonData={loaded:u}}return t._babylonData.loaded},e.prototype._getEventAction=function(e,t,n,i,r){switch(n){case"play":return function(e){var n=(r||0)+(e-i);t.play(n)};case"stop":return function(e){t.stop()};case"pause":return function(e){t.pause()};default:throw new Error(e+": Unsupported action "+n)}},e.prototype._loadAnimationEventAsync=function(e,t,n,i,r){var o=this;if(0==r.targetedAnimations.length)return Promise.resolve();var a=r.targetedAnimations[0],s=i.emitter,l=Fe.Get("#/extensions/"+this.name+"/emitters",this._emitters,s);return this._loadEmitterAsync(e,l).then((function(){var t=l._babylonData.sound;if(t){var n=new Qe.a(i.time,o._getEventAction(e,t,i.action,i.time,i.startOffset));a.animation.addEvent(n),r.onAnimationGroupEndObservable.add((function(){t.stop()})),r.onAnimationGroupPauseObservable.add((function(){t.pause()}))}}))},e}();Ne.RegisterExtension("MSFT_audio_emitter",(function(e){return new tt(e)}));var nt=function(){function e(e){this.name="MSFT_lod",this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new i.a,this.onMaterialLODsLoadedObservable=new i.a,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._indexLOD=null,this._bufferLODs=new Array,this._loader=e,this.enabled=this._loader.isExtensionUsed("MSFT_lod")}return e.prototype.dispose=function(){delete this._loader,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._indexLOD=null,this._bufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},e.prototype.onReady=function(){for(var e=this,t=function(t){var i=Promise.all(n._nodePromiseLODs[t]).then((function(){0!==t&&e._loader.endPerformanceCounter("Node LOD "+t),e._loader.log("Loaded node LOD "+t),e.onNodeLODsLoadedObservable.notifyObservers(t),t!==e._nodePromiseLODs.length-1&&(e._loader.startPerformanceCounter("Node LOD "+(t+1)),e._nodeSignalLODs[t]&&e._nodeSignalLODs[t].resolve())}));n._loader._completePromises.push(i)},n=this,i=0;i<this._nodePromiseLODs.length;i++)t(i);var r=function(t){var n=Promise.all(o._materialPromiseLODs[t]).then((function(){0!==t&&e._loader.endPerformanceCounter("Material LOD "+t),e._loader.log("Loaded material LOD "+t),e.onMaterialLODsLoadedObservable.notifyObservers(t),t!==e._materialPromiseLODs.length-1&&(e._loader.startPerformanceCounter("Material LOD "+(t+1)),e._materialSignalLODs[t]&&e._materialSignalLODs[t].resolve())}));o._loader._completePromises.push(n)},o=this;for(i=0;i<this._materialPromiseLODs.length;i++)r(i);for(i=1;i<this._bufferLODs.length;i++)this._loadBufferLOD(i)},e.prototype.loadSceneAsync=function(e,t){var n=this._loader.loadSceneAsync(e,t);return 0!==this._bufferLODs.length&&this._loadBufferLOD(0),n},e.prototype.loadNodeAsync=function(e,t,n){var i=this;return Ne.LoadExtensionAsync(e,t,this.name,(function(e,n){var r,o=i._getLODs(e,t,i._loader.gltf.nodes,n.ids);i._loader.logOpen(""+e);for(var a=function(e){var t=o[e];i._indexLOD=e,0!==e&&(i._nodeIndexLOD=e,i._nodeSignalLODs[e]=i._nodeSignalLODs[e]||new Ae.a);var n=i._loader.loadNodeAsync("#/nodes/"+t.index,t,(function(e){e.setEnabled(!1)})).then((function(t){if(0!==e){var n=o[e-1];n._babylonTransformNode&&(i._disposeTransformNode(n._babylonTransformNode),delete n._babylonTransformNode)}return t.setEnabled(!0),t}));0===e?r=n:i._nodeIndexLOD=null,i._indexLOD=null,i._nodePromiseLODs[e]=i._nodePromiseLODs[e]||[],i._nodePromiseLODs[e].push(n)},s=0;s<o.length;s++)a(s);return i._loader.logClose(),r}))},e.prototype._loadMaterialAsync=function(e,t,n,i,r){var o=this;return this._indexLOD?null:Ne.LoadExtensionAsync(e,t,this.name,(function(e,a){var s,l=o._getLODs(e,t,o._loader.gltf.materials,a.ids);o._loader.logOpen(""+e);for(var f=function(e){var t=l[e];o._indexLOD=e,0!==e&&(o._materialIndexLOD=e);var a=o._loader._loadMaterialAsync("#/materials/"+t.index,t,n,i,(function(t){0===e&&r(t)})).then((function(t){if(0!==e){r(t);var n=l[e-1]._data;n[i]&&(o._disposeMaterials([n[i].babylonMaterial]),delete n[i])}return t}));0===e?s=a:o._materialIndexLOD=null,o._indexLOD=null,o._materialPromiseLODs[e]=o._materialPromiseLODs[e]||[],o._materialPromiseLODs[e].push(a)},u=0;u<l.length;u++)f(u);return o._loader.logClose(),s}))},e.prototype._loadUriAsync=function(e,t,n){var i=this;if(null!==this._materialIndexLOD){this._loader.log("deferred");var r=this._materialIndexLOD-1;return this._materialSignalLODs[r]=this._materialSignalLODs[r]||new Ae.a,this._materialSignalLODs[r].promise.then((function(){return i._loader.loadUriAsync(e,t,n)}))}if(null!==this._nodeIndexLOD){this._loader.log("deferred");r=this._nodeIndexLOD-1;return this._nodeSignalLODs[r]=this._nodeSignalLODs[r]||new Ae.a,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((function(){return i._loader.loadUriAsync(e,t,n)}))}return null},e.prototype.loadBufferAsync=function(e,t,n,i){if(this._loader.parent.useRangeRequests&&!t.uri){if(!this._loader.bin)throw new Error(e+": Uri is missing or the binary glTF is missing its binary chunk");var r=this._indexLOD||0,o=n,a=o+i-1,s=this._bufferLODs[r];return s?(s.start=Math.min(s.start,o),s.end=Math.max(s.end,a)):(s={start:o,end:a,loaded:new Ae.a},this._bufferLODs[r]=s),s.loaded.promise.then((function(e){return new Uint8Array(e.buffer,e.byteOffset+n-s.start,i)}))}return null},e.prototype._loadBufferLOD=function(e){var t=this._bufferLODs[e];this._loader.bin.readAsync(t.start,t.end-t.start+1).then((function(e){t.loaded.resolve(e)}),(function(e){t.loaded.reject(e)}))},e.prototype._getLODs=function(e,t,n,i){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var r=new Array,o=i.length-1;o>=0;o--)if(r.push(Fe.Get(e+"/ids/"+i[o],n,i[o])),r.length===this.maxLODsToLoad)return r;return r.push(t),r},e.prototype._disposeTransformNode=function(e){var t=this,n=new Array,i=e.material;i&&n.push(i);for(var r=0,o=e.getChildMeshes();r<o.length;r++){var a=o[r];a.material&&n.push(a.material)}e.dispose();var s=n.filter((function(e){return t._loader.babylonScene.meshes.every((function(t){return t.material!=e}))}));this._disposeMaterials(s)},e.prototype._disposeMaterials=function(e){for(var t={},n=0,i=e;n<i.length;n++){for(var r=0,o=(u=i[n]).getActiveTextures();r<o.length;r++){var a=o[r];t[a.uniqueId]=a}u.dispose()}for(var s in t)for(var l=0,f=this._loader.babylonScene.materials;l<f.length;l++){var u;(u=f[l]).hasTexture(t[s])&&delete t[s]}for(var s in t)t[s].dispose()},e}();Ne.RegisterExtension("MSFT_lod",(function(e){return new nt(e)}));var it=function(){function e(e){this.name="MSFT_minecraftMesh",this._loader=e,this.enabled=this._loader.isExtensionUsed("MSFT_minecraftMesh")}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var i=this;return Ne.LoadExtraAsync(e,t,this.name,(function(r,o){if(o){if(!(n instanceof Pe.a))throw new Error(r+": Material type not supported");var a=i._loader.loadMaterialPropertiesAsync(e,t,n);return n.needAlphaBlending()&&(n.forceDepthWrite=!0,n.separateCullingPass=!0),n.backFaceCulling=n.forceDepthWrite,n.twoSidedLighting=!0,a}return null}))},e}();Ne.RegisterExtension("MSFT_minecraftMesh",(function(e){return new it(e)}));var rt=function(){function e(e){this.name="MSFT_sRGBFactors",this._loader=e,this.enabled=this._loader.isExtensionUsed("MSFT_sRGBFactors")}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var i=this;return Ne.LoadExtraAsync(e,t,this.name,(function(r,o){if(o){if(!(n instanceof Pe.a))throw new Error(r+": Material type not supported");var a=i._loader.loadMaterialPropertiesAsync(e,t,n);return n.albedoTexture||n.albedoColor.toLinearSpaceToRef(n.albedoColor),n.reflectivityTexture||n.reflectivityColor.toLinearSpaceToRef(n.reflectivityColor),a}return null}))},e}();Ne.RegisterExtension("MSFT_sRGBFactors",(function(e){return new rt(e)}));var ot=function(){function e(e){this.name="ExtrasAsMetadata",this.enabled=!0,this._loader=e}return e.prototype._assignExtras=function(e,t){if(t.extras&&Object.keys(t.extras).length>0){var n=e.metadata=e.metadata||{};(n.gltf=n.gltf||{}).extras=t.extras}},e.prototype.dispose=function(){delete this._loader},e.prototype.loadNodeAsync=function(e,t,n){var i=this;return this._loader.loadNodeAsync(e,t,(function(e){i._assignExtras(e,t),n(e)}))},e.prototype.loadCameraAsync=function(e,t,n){var i=this;return this._loader.loadCameraAsync(e,t,(function(e){i._assignExtras(e,t),n(e)}))},e.prototype.createMaterial=function(e,t,n){var i=this._loader.createMaterial(e,t,n);return this._assignExtras(i,t),i},e}();Ne.RegisterExtension("ExtrasAsMetadata",(function(e){return new ot(e)}))},25:function(e,t,n){"use strict";n.r(t),n.d(t,"DefaultSceneWithTexture",(function(){return je}));var i=n(38),r=n(92),o=n(30),a=n(82),s=n(45),l=n(223),f=n(1),u=n(33),c=n(32),d=n(58),h=n(39),p=n(60),m=n(61),v=n(34),_=n(31),g=n(7),b=(n(44),n(46),n(47),n(83),n(77),n(65),n(66),n(62),n(90),n(78),n(71),"precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n\nvec3 computeCustomDiffuseLighting(lightingInfo info,vec3 diffuseBase,float shadow)\n{\ndiffuseBase=info.diffuse*shadow;\n#ifdef CELLBASIC\nfloat level=1.0;\nif (info.ndl<0.5)\nlevel=0.5;\ndiffuseBase.rgb*vec3(level,level,level);\n#else\nfloat ToonThresholds[4];\nToonThresholds[0]=0.95;\nToonThresholds[1]=0.5;\nToonThresholds[2]=0.2;\nToonThresholds[3]=0.03;\nfloat ToonBrightnessLevels[5];\nToonBrightnessLevels[0]=1.0;\nToonBrightnessLevels[1]=0.8;\nToonBrightnessLevels[2]=0.6;\nToonBrightnessLevels[3]=0.35;\nToonBrightnessLevels[4]=0.2;\nif (info.ndl>ToonThresholds[0])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[0];\n}\nelse if (info.ndl>ToonThresholds[1])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[1];\n}\nelse if (info.ndl>ToonThresholds[2])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[2];\n}\nelse if (info.ndl>ToonThresholds[3])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[3];\n}\nelse\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[4];\n}\n#endif\nreturn max(diffuseBase,vec3(0.2));\n}\nvoid main(void)\n{\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nlightingInfo info;\nvec3 diffuseBase=vec3(0.,0.,0.);\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}");g.a.ShadersStore.cellPixelShader=b;n(52),n(53),n(67),n(72),n(54),n(55),n(63),n(73),n(79);var y="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";g.a.ShadersStore.cellVertexShader=y;var x=n(57),T=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.NDOTL=!0,t.CUSTOMUSERLIGHTING=!0,t.CELLBASIC=!0,t.DEPTHPREPASS=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),E=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.diffuseColor=new c.a(1,1,1),i._computeHighLevel=!1,i._disableLighting=!1,i._maxSimultaneousLights=4,i}return Object(f.d)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new T);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;var o=r.getEngine();if(i._areTexturesDirty&&(i._needUVs=!1,r.texturesEnabled&&this._diffuseTexture&&m.a.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;i._needUVs=!0,i.DIFFUSE=!0}if(i.CELLBASIC=!this.computeHighLevel,h.a.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=h.a.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),h.a.PrepareDefinesForFrameBoundValues(r,o,i,!!n),h.a.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var a=new x.a;i.FOG&&a.addFallback(1,"FOG"),h.a.HandleFallbacksForShadows(i,a,this.maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e);var s=[v.b.PositionKind];i.NORMAL&&s.push(v.b.NormalKind),i.UV1&&s.push(v.b.UVKind),i.UV2&&s.push(v.b.UV2Kind),i.VERTEXCOLOR&&s.push(v.b.ColorKind),h.a.PrepareAttributesForBones(s,e,i,a),h.a.PrepareAttributesForInstances(s,i);var l=i.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix"],u=["diffuseSampler"],c=new Array;h.a.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("cell",{attributes:s,uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:l,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights-1}},o),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n._materialDefines;if(o){var a=n.effect;a&&(this._activeEffect=a,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),h.a.BindBonesParameters(t,this._activeEffect),this._mustRebind(r,a)&&(this._diffuseTexture&&m.a.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),h.a.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),h.a.BindEyePosition(a,r)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.lightsEnabled&&!this.disableLighting&&h.a.BindLights(r,t,this._activeEffect,o,this._maxSimultaneousLights),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._diffuseTexture===t},t.prototype.dispose=function(t){this._diffuseTexture&&this._diffuseTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.getClassName=function(){return"CellMaterial"},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);return e.customType="BABYLON.CellMaterial",e},t.Parse=function(e,n,i){return u.a.Parse((function(){return new t(e.name,n)}),e,n,i)},Object(f.c)([Object(u.m)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),Object(f.c)([Object(u.e)("diffuse")],t.prototype,"diffuseColor",void 0),Object(f.c)([Object(u.c)("computeHighLevel")],t.prototype,"_computeHighLevel",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"computeHighLevel",void 0),Object(f.c)([Object(u.c)("disableLighting")],t.prototype,"_disableLighting",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(f.c)([Object(u.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(p.a);_.a.RegisteredTypes["BABYLON.CellMaterial"]=E;var A=function(){},S=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.CustomParts=new A,i.customShaderNameResolve=i.Builder,i.FragmentShader=g.a.ShadersStore.defaultPixelShader,i.VertexShader=g.a.ShadersStore.defaultVertexShader,i}return Object(f.d)(t,e),t.prototype.AttachAfterBind=function(e,t){for(var n in this._newUniformInstances){"vec2"==(i=n.toString().split("-"))[0]?t.setVector2(i[1],this._newUniformInstances[n]):"vec3"==i[0]?t.setVector3(i[1],this._newUniformInstances[n]):"vec4"==i[0]?t.setVector4(i[1],this._newUniformInstances[n]):"mat4"==i[0]?t.setMatrix(i[1],this._newUniformInstances[n]):"float"==i[0]&&t.setFloat(i[1],this._newUniformInstances[n])}for(var n in this._newSamplerInstances){var i;"sampler2D"==(i=n.toString().split("-"))[0]&&this._newSamplerInstances[n].isReady&&this._newSamplerInstances[n].isReady()&&t.setTexture(i[1],this._newSamplerInstances[n])}},t.prototype.ReviewUniform=function(e,t){if("uniform"==e)for(var n in this._newUniforms)-1==this._customUniform[n].indexOf("sampler")&&t.push(this._newUniforms[n]);if("sampler"==e)for(var n in this._newUniforms)-1!=this._customUniform[n].indexOf("sampler")&&t.push(this._newUniforms[n]);return t},t.prototype.Builder=function(e,n,i,r,o){var a=this;if(this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1,t.ShaderIndexer++;var s="custom_"+t.ShaderIndexer;this.ReviewUniform("uniform",n),this.ReviewUniform("sampler",r);var l=this._afterBind.bind(this);return this._afterBind=function(e,t){if(t){a.AttachAfterBind(e,t);try{l(e,t)}catch(t){}}},g.a.ShadersStore[s+"VertexShader"]=this.VertexShader.replace("#define CUSTOM_VERTEX_BEGIN",this.CustomParts.Vertex_Begin?this.CustomParts.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Vertex_Definitions?this.CustomParts.Vertex_Definitions:"")).replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.CustomParts.Vertex_MainBegin?this.CustomParts.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.CustomParts.Vertex_Before_PositionUpdated?this.CustomParts.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.CustomParts.Vertex_Before_NormalUpdated?this.CustomParts.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.CustomParts.Vertex_MainEnd?this.CustomParts.Vertex_MainEnd:""),g.a.ShadersStore[s+"PixelShader"]=this.FragmentShader.replace("#define CUSTOM_FRAGMENT_BEGIN",this.CustomParts.Fragment_Begin?this.CustomParts.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.CustomParts.Fragment_MainBegin?this.CustomParts.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Fragment_Definitions?this.CustomParts.Fragment_Definitions:"")).replace("#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE",this.CustomParts.Fragment_Custom_Diffuse?this.CustomParts.Fragment_Custom_Diffuse:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.CustomParts.Fragment_Custom_Alpha?this.CustomParts.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.CustomParts.Fragment_Before_Lights?this.CustomParts.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.CustomParts.Fragment_Before_Fog?this.CustomParts.Fragment_Before_Fog:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.CustomParts.Fragment_Before_FragColor?this.CustomParts.Fragment_Before_FragColor:""),this._isCreatedShader=!0,this._createdShaderName=s,s},t.prototype.AddUniform=function(e,t,n){return this._customUniform||(this._customUniform=new Array,this._newUniforms=new Array,this._newSamplerInstances=new Array,this._newUniformInstances=new Array),n&&(t.indexOf("sampler"),this._newUniformInstances[t+"-"+e]=n),this._customUniform.push("uniform "+t+" "+e+";"),this._newUniforms.push(e),this},t.prototype.Fragment_Begin=function(e){return this.CustomParts.Fragment_Begin=e,this},t.prototype.Fragment_Definitions=function(e){return this.CustomParts.Fragment_Definitions=e,this},t.prototype.Fragment_MainBegin=function(e){return this.CustomParts.Fragment_MainBegin=e,this},t.prototype.Fragment_Custom_Diffuse=function(e){return this.CustomParts.Fragment_Custom_Diffuse=e.replace("result","diffuseColor"),this},t.prototype.Fragment_Custom_Alpha=function(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this},t.prototype.Fragment_Before_Lights=function(e){return this.CustomParts.Fragment_Before_Lights=e,this},t.prototype.Fragment_Before_Fog=function(e){return this.CustomParts.Fragment_Before_Fog=e,this},t.prototype.Fragment_Before_FragColor=function(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this},t.prototype.Vertex_Begin=function(e){return this.CustomParts.Vertex_Begin=e,this},t.prototype.Vertex_Definitions=function(e){return this.CustomParts.Vertex_Definitions=e,this},t.prototype.Vertex_MainBegin=function(e){return this.CustomParts.Vertex_MainBegin=e,this},t.prototype.Vertex_Before_PositionUpdated=function(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this},t.prototype.Vertex_Before_NormalUpdated=function(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this},t.prototype.Vertex_MainEnd=function(e){return this.CustomParts.Vertex_MainEnd=e,this},t.ShaderIndexer=1,t}(s.a);_.a.RegisteredTypes["BABYLON.CustomMaterial"]=S;var P=n(59),O=function(){},C=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.CustomParts=new O,i.customShaderNameResolve=i.Builder,i.FragmentShader=g.a.ShadersStore.pbrPixelShader,i.VertexShader=g.a.ShadersStore.pbrVertexShader,i}return Object(f.d)(t,e),t.prototype.AttachAfterBind=function(e,t){for(var n in this._newUniformInstances){"vec2"==(i=n.toString().split("-"))[0]?t.setVector2(i[1],this._newUniformInstances[n]):"vec3"==i[0]?t.setVector3(i[1],this._newUniformInstances[n]):"vec4"==i[0]?t.setVector4(i[1],this._newUniformInstances[n]):"mat4"==i[0]?t.setMatrix(i[1],this._newUniformInstances[n]):"float"==i[0]&&t.setFloat(i[1],this._newUniformInstances[n])}for(var n in this._newSamplerInstances){var i;"sampler2D"==(i=n.toString().split("-"))[0]&&this._newSamplerInstances[n].isReady&&this._newSamplerInstances[n].isReady()&&t.setTexture(i[1],this._newSamplerInstances[n])}},t.prototype.ReviewUniform=function(e,t){if("uniform"==e)for(var n in this._newUniforms)-1==this._customUniform[n].indexOf("sampler")&&t.push(this._newUniforms[n]);if("sampler"==e)for(var n in this._newUniforms)-1!=this._customUniform[n].indexOf("sampler")&&t.push(this._newUniforms[n]);return t},t.prototype.Builder=function(e,n,i,r,o){var a=this;if(this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1,t.ShaderIndexer++;var s="custom_"+t.ShaderIndexer;this.ReviewUniform("uniform",n),this.ReviewUniform("sampler",r);var l=this._afterBind.bind(this);return this._afterBind=function(e,t){if(t){a.AttachAfterBind(e,t);try{l(e,t)}catch(t){}}},g.a.ShadersStore[s+"VertexShader"]=this.VertexShader.replace("#define CUSTOM_VERTEX_BEGIN",this.CustomParts.Vertex_Begin?this.CustomParts.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Vertex_Definitions?this.CustomParts.Vertex_Definitions:"")).replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.CustomParts.Vertex_MainBegin?this.CustomParts.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.CustomParts.Vertex_Before_PositionUpdated?this.CustomParts.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.CustomParts.Vertex_Before_NormalUpdated?this.CustomParts.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.CustomParts.Vertex_MainEnd?this.CustomParts.Vertex_MainEnd:""),g.a.ShadersStore[s+"PixelShader"]=this.FragmentShader.replace("#define CUSTOM_FRAGMENT_BEGIN",this.CustomParts.Fragment_Begin?this.CustomParts.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.CustomParts.Fragment_MainBegin?this.CustomParts.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Fragment_Definitions?this.CustomParts.Fragment_Definitions:"")).replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO",this.CustomParts.Fragment_Custom_Albedo?this.CustomParts.Fragment_Custom_Albedo:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.CustomParts.Fragment_Custom_Alpha?this.CustomParts.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.CustomParts.Fragment_Before_Lights?this.CustomParts.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS",this.CustomParts.Fragment_Custom_MetallicRoughness?this.CustomParts.Fragment_Custom_MetallicRoughness:"").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE",this.CustomParts.Fragment_Custom_MicroSurface?this.CustomParts.Fragment_Custom_MicroSurface:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.CustomParts.Fragment_Before_Fog?this.CustomParts.Fragment_Before_Fog:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.CustomParts.Fragment_Before_FragColor?this.CustomParts.Fragment_Before_FragColor:""),this._isCreatedShader=!0,this._createdShaderName=s,s},t.prototype.AddUniform=function(e,t,n){return this._customUniform||(this._customUniform=new Array,this._newUniforms=new Array,this._newSamplerInstances=new Array,this._newUniformInstances=new Array),n&&(t.indexOf("sampler"),this._newUniformInstances[t+"-"+e]=n),this._customUniform.push("uniform "+t+" "+e+";"),this._newUniforms.push(e),this},t.prototype.Fragment_Begin=function(e){return this.CustomParts.Fragment_Begin=e,this},t.prototype.Fragment_Definitions=function(e){return this.CustomParts.Fragment_Definitions=e,this},t.prototype.Fragment_MainBegin=function(e){return this.CustomParts.Fragment_MainBegin=e,this},t.prototype.Fragment_Custom_Albedo=function(e){return this.CustomParts.Fragment_Custom_Albedo=e.replace("result","surfaceAlbedo"),this},t.prototype.Fragment_Custom_Alpha=function(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this},t.prototype.Fragment_Before_Lights=function(e){return this.CustomParts.Fragment_Before_Lights=e,this},t.prototype.Fragment_Custom_MetallicRoughness=function(e){return this.CustomParts.Fragment_Custom_MetallicRoughness=e,this},t.prototype.Fragment_Custom_MicroSurface=function(e){return this.CustomParts.Fragment_Custom_MicroSurface=e,this},t.prototype.Fragment_Before_Fog=function(e){return this.CustomParts.Fragment_Before_Fog=e,this},t.prototype.Fragment_Before_FragColor=function(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this},t.prototype.Vertex_Begin=function(e){return this.CustomParts.Vertex_Begin=e,this},t.prototype.Vertex_Definitions=function(e){return this.CustomParts.Vertex_Definitions=e,this},t.prototype.Vertex_MainBegin=function(e){return this.CustomParts.Vertex_MainBegin=e,this},t.prototype.Vertex_Before_PositionUpdated=function(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this},t.prototype.Vertex_Before_NormalUpdated=function(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this},t.prototype.Vertex_MainEnd=function(e){return this.CustomParts.Vertex_MainEnd=e,this},t.ShaderIndexer=1,t}(P.a);_.a.RegisteredTypes["BABYLON.PBRCustomMaterial"]=C;var L=n(98),M=n(35),R="precision highp float;\n\nuniform vec3 vEyePosition;\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n\nuniform sampler2D distortionSampler;\nuniform sampler2D opacitySampler;\n#ifdef DIFFUSE\nvarying vec2 vDistortionCoords1;\nvarying vec2 vDistortionCoords2;\nvarying vec2 vDistortionCoords3;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvec4 bx2(vec4 x)\n{\nreturn vec4(2.0)*x-vec4(1.0);\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\n\nfloat alpha=1.0;\n#ifdef DIFFUSE\n\nconst float distortionAmount0=0.092;\nconst float distortionAmount1=0.092;\nconst float distortionAmount2=0.092;\nvec2 heightAttenuation=vec2(0.3,0.39);\nvec4 noise0=texture2D(distortionSampler,vDistortionCoords1);\nvec4 noise1=texture2D(distortionSampler,vDistortionCoords2);\nvec4 noise2=texture2D(distortionSampler,vDistortionCoords3);\nvec4 noiseSum=bx2(noise0)*distortionAmount0+bx2(noise1)*distortionAmount1+bx2(noise2)*distortionAmount2;\nvec4 perturbedBaseCoords=vec4(vDiffuseUV,0.0,1.0)+noiseSum*(vDiffuseUV.y*heightAttenuation.x+heightAttenuation.y);\nvec4 opacityColor=texture2D(opacitySampler,perturbedBaseCoords.xy);\n#ifdef ALPHATEST\nif (opacityColor.r<0.1)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor=texture2D(diffuseSampler,perturbedBaseCoords.xy)*2.0;\nbaseColor*=opacityColor;\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(1.0,1.0,1.0);\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec4 color=vec4(baseColor.rgb,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}";g.a.ShadersStore.firePixelShader=R;var F="precision highp float;\n\nattribute vec3 position;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n\nuniform float time;\nuniform float speed;\n#ifdef DIFFUSE\nvarying vec2 vDistortionCoords1;\nvarying vec2 vDistortionCoords2;\nvarying vec2 vDistortionCoords3;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n\n#ifdef DIFFUSE\nvDiffuseUV=uv;\nvDiffuseUV.y-=0.2;\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n#ifdef DIFFUSE\n\nvec3 layerSpeed=vec3(-0.2,-0.52,-0.1)*speed;\nvDistortionCoords1.x=uv.x;\nvDistortionCoords1.y=uv.y+layerSpeed.x*time/1000.0;\nvDistortionCoords2.x=uv.x;\nvDistortionCoords2.y=uv.y+layerSpeed.y*time/1000.0;\nvDistortionCoords3.x=uv.x;\nvDistortionCoords3.y=uv.y+layerSpeed.z*time/1000.0;\n#endif\n}\n";g.a.ShadersStore.fireVertexShader=F;var N=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.UV1=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.BonesPerMesh=0,t.NUM_BONE_INFLUENCERS=0,t.INSTANCES=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),D=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.diffuseColor=new c.a(1,1,1),i.speed=1,i._scaledDiffuse=new c.a,i._lastTime=0,i}return Object(f.d)(t,e),t.prototype.needAlphaBlending=function(){return!1},t.prototype.needAlphaTesting=function(){return!0},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new N);var r=t._materialDefines,o=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===o.getRenderId())return!0;var a=o.getEngine();if(r._areTexturesDirty&&(r._needUVs=!1,this._diffuseTexture&&m.a.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;r._needUVs=!0,r.DIFFUSE=!0}if(r.ALPHATEST=!!this._opacityTexture,r._areMiscDirty&&(r.POINTSIZE=this.pointsCloud||o.forcePointsCloud,r.FOG=o.fogEnabled&&e.applyFog&&o.fogMode!==i.a.FOGMODE_NONE&&this.fogEnabled),h.a.PrepareDefinesForFrameBoundValues(o,a,r,!!n),h.a.PrepareDefinesForAttributes(e,r,!1,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();var s=new x.a;r.FOG&&s.addFallback(1,"FOG"),r.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e);var l=[v.b.PositionKind];r.UV1&&l.push(v.b.UVKind),r.VERTEXCOLOR&&l.push(v.b.ColorKind),h.a.PrepareAttributesForBones(l,e,r,s),h.a.PrepareAttributesForInstances(l,r);var f=r.toString();t.setEffect(o.getEngine().createEffect("fire",{attributes:l,uniformsNames:["world","view","viewProjection","vEyePosition","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","time","speed"],uniformBuffersNames:[],samplers:["diffuseSampler","distortionSampler","opacitySampler"],defines:f,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:null,maxSimultaneousLights:4,transformFeedbackVaryings:null},a),r)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=o.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene();if(n._materialDefines){var o=n.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),h.a.BindBonesParameters(t,this._activeEffect),this._mustRebind(r,o)&&(this._diffuseTexture&&m.a.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix()),this._activeEffect.setTexture("distortionSampler",this._distortionTexture),this._activeEffect.setTexture("opacitySampler",this._opacityTexture)),h.a.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),h.a.BindEyePosition(o,r)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*t.visibility),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect),this._lastTime+=r.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime),this._activeEffect.setFloat("speed",this.speed),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._distortionTexture&&this._distortionTexture.animations&&this._distortionTexture.animations.length>0&&e.push(this._distortionTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),this._distortionTexture&&t.push(this._distortionTexture),this._opacityTexture&&t.push(this._opacityTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this._diffuseTexture===t||(this._distortionTexture===t||this._opacityTexture===t))},t.prototype.getClassName=function(){return"FireMaterial"},t.prototype.dispose=function(t){this._diffuseTexture&&this._diffuseTexture.dispose(),this._distortionTexture&&this._distortionTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.FireMaterial",t.diffuseColor=this.diffuseColor.asArray(),t.speed=this.speed,this._diffuseTexture&&(t._diffuseTexture=this._diffuseTexture.serialize()),this._distortionTexture&&(t._distortionTexture=this._distortionTexture.serialize()),this._opacityTexture&&(t._opacityTexture=this._opacityTexture.serialize()),t},t.Parse=function(e,n,i){var r=new t(e.name,n);return r.diffuseColor=c.a.FromArray(e.diffuseColor),r.speed=e.speed,r.alpha=e.alpha,r.id=e.id,L.a.AddTagsTo(r,e.tags),r.backFaceCulling=e.backFaceCulling,r.wireframe=e.wireframe,e._diffuseTexture&&(r._diffuseTexture=M.a.Parse(e._diffuseTexture,n,i)),e._distortionTexture&&(r._distortionTexture=M.a.Parse(e._distortionTexture,n,i)),e._opacityTexture&&(r._opacityTexture=M.a.Parse(e._opacityTexture,n,i)),r},Object(f.c)([Object(u.m)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),Object(f.c)([Object(u.m)("distortionTexture")],t.prototype,"_distortionTexture",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"distortionTexture",void 0),Object(f.c)([Object(u.m)("opacityTexture")],t.prototype,"_opacityTexture",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityTexture",void 0),Object(f.c)([Object(u.e)("diffuse")],t.prototype,"diffuseColor",void 0),Object(f.c)([Object(u.c)()],t.prototype,"speed",void 0),t}(p.a);_.a.RegisteredTypes["BABYLON.FireMaterial"]=D;var I=n(96),w="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nuniform vec4 furColor;\nuniform float furLength;\nvarying vec3 vPositionW;\nvarying float vfur_length;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n\n#ifdef HIGHLEVEL\nuniform float furOffset;\nuniform float furOcclusion;\nuniform sampler2D furTexture;\nvarying vec2 vFurUV;\n#endif\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<fogFragmentDeclaration>\n#include<clipPlaneFragmentDeclaration>\nfloat Rand(vec3 rv) {\nfloat x=dot(rv,vec3(12.9898,78.233,24.65487));\nreturn fract(sin(x)*43758.5453);\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=furColor;\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor*=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef HIGHLEVEL\n\nvec4 furTextureColor=texture2D(furTexture,vec2(vFurUV.x,vFurUV.y));\nif (furTextureColor.a<=0.0 || furTextureColor.g<furOffset) {\ndiscard;\n}\nfloat occlusion=mix(0.0,furTextureColor.b*1.2,furOffset);\nbaseColor=vec4(baseColor.xyz*max(occlusion,furOcclusion),1.1-furOffset);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase.rgb*baseColor.rgb,0.0,1.0);\n\n#ifdef HIGHLEVEL\nvec4 color=vec4(finalDiffuse,alpha);\n#else\nfloat r=vfur_length/furLength*0.5;\nvec4 color=vec4(finalDiffuse*(0.5+r),alpha);\n#endif\n#include<fogFragment>\ngl_FragColor=color;\n}";g.a.ShadersStore.furPixelShader=w;var V="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform float furLength;\nuniform float furAngle;\n#ifdef HIGHLEVEL\nuniform float furOffset;\nuniform vec3 furGravity;\nuniform float furTime;\nuniform float furSpacing;\nuniform float furDensity;\n#endif\n#ifdef HEIGHTMAP\nuniform sampler2D heightTexture;\n#endif\n#ifdef HIGHLEVEL\nvarying vec2 vFurUV;\n#endif\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\nvarying float vfur_length;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nfloat Rand(vec3 rv) {\nfloat x=dot(rv,vec3(12.9898,78.233,24.65487));\nreturn fract(sin(x)*43758.5453);\n}\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\n\nfloat r=Rand(position);\n#ifdef HEIGHTMAP\n#if __VERSION__>100\nvfur_length=furLength*texture(heightTexture,uv).x;\n#else\nvfur_length=furLength*texture2D(heightTexture,uv).r;\n#endif\n#else\nvfur_length=(furLength*r);\n#endif\nvec3 tangent1=vec3(normal.y,-normal.x,0);\nvec3 tangent2=vec3(-normal.z,0,normal.x);\nr=Rand(tangent1*r);\nfloat J=(2.0+4.0*r);\nr=Rand(tangent2*r);\nfloat K=(2.0+2.0*r);\ntangent1=tangent1*J+tangent2*K;\ntangent1=normalize(tangent1);\nvec3 newPosition=position+normal*vfur_length*cos(furAngle)+tangent1*vfur_length*sin(furAngle);\n#ifdef HIGHLEVEL\n\nvec3 forceDirection=vec3(0.0,0.0,0.0);\nforceDirection.x=sin(furTime+position.x*0.05)*0.2;\nforceDirection.y=cos(furTime*0.7+position.y*0.04)*0.2;\nforceDirection.z=sin(furTime*0.7+position.z*0.04)*0.2;\nvec3 displacement=vec3(0.0,0.0,0.0);\ndisplacement=furGravity+forceDirection;\nfloat displacementFactor=pow(furOffset,3.0);\nvec3 aNormal=normal;\naNormal.xyz+=displacement*displacementFactor;\nnewPosition=vec3(newPosition.x,newPosition.y,newPosition.z)+(normalize(aNormal)*furOffset*furSpacing);\n#endif\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\ngl_Position=viewProjection*finalWorld*vec4(newPosition,1.0);\nvec4 worldPos=finalWorld*vec4(newPosition,1.0);\nvPositionW=vec3(worldPos);\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#ifdef HIGHLEVEL\nvFurUV=vDiffuseUV*furDensity;\n#endif\n#else\n#ifdef HIGHLEVEL\nvFurUV=uv*furDensity;\n#endif\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";g.a.ShadersStore.furVertexShader=V;var U=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.HEIGHTMAP=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.HIGHLEVEL=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),B=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.diffuseColor=new c.a(1,1,1),i.furLength=1,i.furAngle=0,i.furColor=new c.a(.44,.21,.02),i.furOffset=0,i.furSpacing=12,i.furGravity=new o.e(0,0,0),i.furSpeed=100,i.furDensity=20,i.furOcclusion=0,i._disableLighting=!1,i._maxSimultaneousLights=4,i.highLevelFur=!0,i._furTime=0,i}return Object(f.d)(t,e),Object.defineProperty(t.prototype,"furTime",{get:function(){return this._furTime},set:function(e){this._furTime=e},enumerable:!0,configurable:!0}),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.updateFur=function(){for(var e=1;e<this._meshes.length;e++){var t=this._meshes[e].material;t.furLength=this.furLength,t.furAngle=this.furAngle,t.furGravity=this.furGravity,t.furSpacing=this.furSpacing,t.furSpeed=this.furSpeed,t.furColor=this.furColor,t.diffuseTexture=this.diffuseTexture,t.furTexture=this.furTexture,t.highLevelFur=this.highLevelFur,t.furTime=this.furTime,t.furDensity=this.furDensity}},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new U);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;var o=r.getEngine();if(i._areTexturesDirty&&r.texturesEnabled){if(this.diffuseTexture&&m.a.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;i._needUVs=!0,i.DIFFUSE=!0}if(this.heightTexture&&o.getCaps().maxVertexTextureImageUnits){if(!this.heightTexture.isReady())return!1;i._needUVs=!0,i.HEIGHTMAP=!0}}if(this.highLevelFur!==i.HIGHLEVEL&&(i.HIGHLEVEL=!0,i.markAsUnprocessed()),h.a.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=h.a.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),h.a.PrepareDefinesForFrameBoundValues(r,o,i,!!n),h.a.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var a=new x.a;i.FOG&&a.addFallback(1,"FOG"),h.a.HandleFallbacksForShadows(i,a,this.maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e);var s=[v.b.PositionKind];i.NORMAL&&s.push(v.b.NormalKind),i.UV1&&s.push(v.b.UVKind),i.UV2&&s.push(v.b.UV2Kind),i.VERTEXCOLOR&&s.push(v.b.ColorKind),h.a.PrepareAttributesForBones(s,e,i,a),h.a.PrepareAttributesForInstances(s,i);var l=i.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","furLength","furAngle","furColor","furOffset","furGravity","furTime","furSpacing","furDensity","furOcclusion"],u=["diffuseSampler","heightTexture","furTexture"],c=new Array;h.a.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("fur",{attributes:s,uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:l,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n._materialDefines;if(o){var a=n.effect;a&&(this._activeEffect=a,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),h.a.BindBonesParameters(t,this._activeEffect),r.getCachedMaterial()!==this&&(this._diffuseTexture&&m.a.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),this._heightTexture&&this._activeEffect.setTexture("heightTexture",this._heightTexture),h.a.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),h.a.BindEyePosition(a,r)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.lightsEnabled&&!this.disableLighting&&h.a.BindLights(r,t,this._activeEffect,o,this.maxSimultaneousLights),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect),this._activeEffect.setFloat("furLength",this.furLength),this._activeEffect.setFloat("furAngle",this.furAngle),this._activeEffect.setColor4("furColor",this.furColor,1),this.highLevelFur&&(this._activeEffect.setVector3("furGravity",this.furGravity),this._activeEffect.setFloat("furOffset",this.furOffset),this._activeEffect.setFloat("furSpacing",this.furSpacing),this._activeEffect.setFloat("furDensity",this.furDensity),this._activeEffect.setFloat("furOcclusion",this.furOcclusion),this._furTime+=this.getScene().getEngine().getDeltaTime()/this.furSpeed,this._activeEffect.setFloat("furTime",this._furTime),this._activeEffect.setTexture("furTexture",this.furTexture)),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.heightTexture&&this.heightTexture.animations&&this.heightTexture.animations.length>0&&e.push(this.heightTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),this._heightTexture&&t.push(this._heightTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this.diffuseTexture===t||this._heightTexture===t)},t.prototype.dispose=function(t){if(this.diffuseTexture&&this.diffuseTexture.dispose(),this._meshes)for(var n=1;n<this._meshes.length;n++){var i=this._meshes[n].material;i&&i.dispose(t),this._meshes[n].dispose()}e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);return e.customType="BABYLON.FurMaterial",this._meshes&&(e.sourceMeshName=this._meshes[0].name,e.quality=this._meshes.length),e},t.prototype.getClassName=function(){return"FurMaterial"},t.Parse=function(e,n,i){var r=u.a.Parse((function(){return new t(e.name,n)}),e,n,i);return e.sourceMeshName&&r.highLevelFur&&n.executeWhenReady((function(){var i=n.getMeshByName(e.sourceMeshName);if(i){var o=t.GenerateTexture("Fur Texture",n);r.furTexture=o,t.FurifyMesh(i,e.quality)}})),r},t.GenerateTexture=function(e,t){for(var n=new I.a("FurTexture "+e,256,t,!0),i=n.getContext(),r=0;r<2e4;++r)i.fillStyle="rgba(255, "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", 1)",i.fillRect(Math.random()*n.getSize().width,Math.random()*n.getSize().height,2,2);return n.update(!1),n.wrapU=M.a.WRAP_ADDRESSMODE,n.wrapV=M.a.WRAP_ADDRESSMODE,n},t.FurifyMesh=function(e,n){var i,r=[e],a=e.material;if(!(a instanceof t))throw"The material of the source mesh must be a Fur Material";for(i=1;i<n;i++){var s=new t(a.name+i,e.getScene());e.getScene().materials.pop(),L.a.EnableFor(s),L.a.AddTagsTo(s,"furShellMaterial"),s.furLength=a.furLength,s.furAngle=a.furAngle,s.furGravity=a.furGravity,s.furSpacing=a.furSpacing,s.furSpeed=a.furSpeed,s.furColor=a.furColor,s.diffuseTexture=a.diffuseTexture,s.furOffset=i/n,s.furTexture=a.furTexture,s.highLevelFur=a.highLevelFur,s.furTime=a.furTime,s.furDensity=a.furDensity;var l=e.clone(e.name+i);l.material=s,l.skeleton=e.skeleton,l.position=o.e.Zero(),r.push(l)}for(i=1;i<r.length;i++)r[i].parent=e;return e.material._meshes=r,r},Object(f.c)([Object(u.m)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),Object(f.c)([Object(u.m)("heightTexture")],t.prototype,"_heightTexture",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"heightTexture",void 0),Object(f.c)([Object(u.e)()],t.prototype,"diffuseColor",void 0),Object(f.c)([Object(u.c)()],t.prototype,"furLength",void 0),Object(f.c)([Object(u.c)()],t.prototype,"furAngle",void 0),Object(f.c)([Object(u.e)()],t.prototype,"furColor",void 0),Object(f.c)([Object(u.c)()],t.prototype,"furOffset",void 0),Object(f.c)([Object(u.c)()],t.prototype,"furSpacing",void 0),Object(f.c)([Object(u.o)()],t.prototype,"furGravity",void 0),Object(f.c)([Object(u.c)()],t.prototype,"furSpeed",void 0),Object(f.c)([Object(u.c)()],t.prototype,"furDensity",void 0),Object(f.c)([Object(u.c)()],t.prototype,"furOcclusion",void 0),Object(f.c)([Object(u.c)("disableLighting")],t.prototype,"_disableLighting",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(f.c)([Object(u.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(f.c)([Object(u.c)()],t.prototype,"highLevelFur",void 0),Object(f.c)([Object(u.c)()],t.prototype,"furTime",null),t}(p.a);_.a.RegisteredTypes["BABYLON.FurMaterial"]=B;var j="precision highp float;\n\nuniform vec3 vEyePosition;\n\nuniform vec4 topColor;\nuniform vec4 bottomColor;\nuniform float offset;\nuniform float scale;\nuniform float smoothness;\n\nvarying vec3 vPositionW;\nvarying vec3 vPosition;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\nfloat h=vPosition.y*scale+offset;\nfloat mysmoothness=clamp(smoothness,0.01,max(smoothness,10.));\nvec4 baseColor=mix(bottomColor,topColor,max(pow(max(h,0.0),mysmoothness),0.0));\n\nvec3 diffuseColor=baseColor.rgb;\n\nfloat alpha=baseColor.a;\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\n#ifdef EMISSIVE\nvec3 diffuseBase=baseColor.rgb;\n#else\nvec3 diffuseBase=vec3(0.,0.,0.);\n#endif\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}\n";g.a.ShadersStore.gradientPixelShader=j;var G="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vPosition;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\nvPosition=position;\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";g.a.ShadersStore.gradientVertexShader=G;var k=function(e){function t(){var t=e.call(this)||this;return t.EMISSIVE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),H=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._maxSimultaneousLights=4,i.topColor=new c.a(1,0,0),i.topColorAlpha=1,i.bottomColor=new c.a(0,0,1),i.bottomColorAlpha=1,i.offset=0,i.scale=1,i.smoothness=1,i._disableLighting=!1,i}return Object(f.d)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1||this.topColorAlpha<1||this.bottomColorAlpha<1},t.prototype.needAlphaTesting=function(){return!0},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new k);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;var o=r.getEngine();if(h.a.PrepareDefinesForFrameBoundValues(r,o,i,!!n),h.a.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=h.a.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),i.EMISSIVE=this._disableLighting,h.a.PrepareDefinesForAttributes(e,i,!1,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var a=new x.a;i.FOG&&a.addFallback(1,"FOG"),h.a.HandleFallbacksForShadows(i,a),i.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e);var s=[v.b.PositionKind];i.NORMAL&&s.push(v.b.NormalKind),i.UV1&&s.push(v.b.UVKind),i.UV2&&s.push(v.b.UV2Kind),i.VERTEXCOLOR&&s.push(v.b.ColorKind),h.a.PrepareAttributesForBones(s,e,i,a),h.a.PrepareAttributesForInstances(s,i);var l=i.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","topColor","bottomColor","offset","smoothness","scale"],u=[],c=new Array;h.a.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:i,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("gradient",{attributes:s,uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:l,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n._materialDefines;if(o){var a=n.effect;a&&(this._activeEffect=a,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),h.a.BindBonesParameters(t,a),this._mustRebind(r,a)&&(h.a.BindClipPlane(a,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),h.a.BindEyePosition(a,r)),r.lightsEnabled&&!this.disableLighting&&h.a.BindLights(r,t,this._activeEffect,o,this.maxSimultaneousLights),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect),this._activeEffect.setColor4("topColor",this.topColor,this.topColorAlpha),this._activeEffect.setColor4("bottomColor",this.bottomColor,this.bottomColorAlpha),this._activeEffect.setFloat("offset",this.offset),this._activeEffect.setFloat("scale",this.scale),this._activeEffect.setFloat("smoothness",this.smoothness),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){return[]},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);return e.customType="BABYLON.GradientMaterial",e},t.prototype.getClassName=function(){return"GradientMaterial"},t.Parse=function(e,n,i){return u.a.Parse((function(){return new t(e.name,n)}),e,n,i)},Object(f.c)([Object(u.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(f.c)([Object(u.e)()],t.prototype,"topColor",void 0),Object(f.c)([Object(u.c)()],t.prototype,"topColorAlpha",void 0),Object(f.c)([Object(u.e)()],t.prototype,"bottomColor",void 0),Object(f.c)([Object(u.c)()],t.prototype,"bottomColorAlpha",void 0),Object(f.c)([Object(u.c)()],t.prototype,"offset",void 0),Object(f.c)([Object(u.c)()],t.prototype,"scale",void 0),Object(f.c)([Object(u.c)()],t.prototype,"smoothness",void 0),Object(f.c)([Object(u.c)("disableLighting")],t.prototype,"_disableLighting",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),t}(p.a);_.a.RegisteredTypes["BABYLON.GradientMaterial"]=H;var z="#extension GL_OES_standard_derivatives : enable\n#define SQRT2 1.41421356\n#define PI 3.14159\nprecision highp float;\nuniform vec3 mainColor;\nuniform vec3 lineColor;\nuniform vec4 gridControl;\nuniform vec3 gridOffset;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogFragmentDeclaration>\n\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\nfloat getVisibility(float position) {\n\nfloat majorGridFrequency=gridControl.y;\nif (floor(position+0.5) == floor(position/majorGridFrequency+0.5)*majorGridFrequency)\n{\nreturn 1.0;\n}\nreturn gridControl.z;\n}\nfloat getAnisotropicAttenuation(float differentialLength) {\nconst float maxNumberOfLines=10.0;\nreturn clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);\n}\nfloat isPointOnLine(float position,float differentialLength) {\nfloat fractionPartOfPosition=position-floor(position+0.5);\nfractionPartOfPosition/=differentialLength;\nfractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);\nfloat result=0.5+0.5*cos(fractionPartOfPosition*PI);\nreturn result;\n}\nfloat contributionOnAxis(float position) {\nfloat differentialLength=length(vec2(dFdx(position),dFdy(position)));\ndifferentialLength*=SQRT2;\n\nfloat result=isPointOnLine(position,differentialLength);\n\nfloat visibility=getVisibility(position);\nresult*=visibility;\n\nfloat anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);\nresult*=anisotropicAttenuation;\nreturn result;\n}\nfloat normalImpactOnAxis(float x) {\nfloat normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);\nreturn normalImpact;\n}\nvoid main(void) {\n\nfloat gridRatio=gridControl.x;\nvec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;\n\nfloat x=contributionOnAxis(gridPos.x);\nfloat y=contributionOnAxis(gridPos.y);\nfloat z=contributionOnAxis(gridPos.z);\n\nvec3 normal=normalize(vNormal);\nx*=normalImpactOnAxis(normal.x);\ny*=normalImpactOnAxis(normal.y);\nz*=normalImpactOnAxis(normal.z);\n\nfloat grid=clamp(x+y+z,0.,1.);\n\nvec3 color=mix(mainColor,lineColor,grid);\n#ifdef FOG\n#include<fogFragment>\n#endif\nfloat opacity=1.0;\n#ifdef TRANSPARENT\nopacity=clamp(grid,0.08,gridControl.w*grid);\n#endif\n#ifdef OPACITY\nopacity*=texture2D(opacitySampler,vOpacityUV).a;\n#endif\n\ngl_FragColor=vec4(color.rgb,opacity);\n#ifdef TRANSPARENT\n#ifdef PREMULTIPLYALPHA\ngl_FragColor.rgb*=opacity;\n#endif\n#else\n#endif\n}";g.a.ShadersStore.gridPixelShader=z;var W="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#include<instancesDeclaration>\n\nuniform mat4 projection;\nuniform mat4 view;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogVertexDeclaration>\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\nvoid main(void) {\n#include<instancesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#include<fogVertex>\nvec4 cameraSpacePosition=view*worldPos;\ngl_Position=projection*cameraSpacePosition;\n#ifdef OPACITY\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\nvPosition=position;\nvNormal=normal;\n}";g.a.ShadersStore.gridVertexShader=W;var X=function(e){function t(){var t=e.call(this)||this;return t.OPACITY=!1,t.TRANSPARENT=!1,t.FOG=!1,t.PREMULTIPLYALPHA=!1,t.UV1=!1,t.UV2=!1,t.INSTANCES=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),K=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.mainColor=c.a.Black(),i.lineColor=c.a.Teal(),i.gridRatio=1,i.gridOffset=o.e.Zero(),i.majorUnitFrequency=10,i.minorUnitVisibility=.33,i.opacity=1,i.preMultiplyAlpha=!1,i._gridControl=new o.f(i.gridRatio,i.majorUnitFrequency,i.minorUnitVisibility,i.opacity),i}return Object(f.d)(t,e),t.prototype.needAlphaBlending=function(){return this.opacity<1||this._opacityTexture&&this._opacityTexture.isReady()},t.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new X);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;if(i.TRANSPARENT!==this.opacity<1&&(i.TRANSPARENT=!i.TRANSPARENT,i.markAsUnprocessed()),i.PREMULTIPLYALPHA!=this.preMultiplyAlpha&&(i.PREMULTIPLYALPHA=!i.PREMULTIPLYALPHA,i.markAsUnprocessed()),i._areTexturesDirty&&(i._needUVs=!1,r.texturesEnabled&&this._opacityTexture&&m.a.OpacityTextureEnabled)){if(!this._opacityTexture.isReady())return!1;i._needUVs=!0,i.OPACITY=!0}if(h.a.PrepareDefinesForMisc(e,r,!1,!1,this.fogEnabled,!1,i),h.a.PrepareDefinesForFrameBoundValues(r,r.getEngine(),i,!!n),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial(),h.a.PrepareDefinesForAttributes(e,i,!1,!1);var o=[v.b.PositionKind,v.b.NormalKind];i.UV1&&o.push(v.b.UVKind),i.UV2&&o.push(v.b.UV2Kind),h.a.PrepareAttributesForInstances(o,i);var a=i.toString();t.setEffect(r.getEngine().createEffect("grid",o,["projection","mainColor","lineColor","gridControl","gridOffset","vFogInfos","vFogColor","world","view","opacityMatrix","vOpacityInfos"],["opacitySampler"],a,void 0,this.onCompiled,this.onError),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene(),r=n._materialDefines;if(r){var o=n.effect;o&&(this._activeEffect=o,r.INSTANCES||this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("view",i.getViewMatrix()),this._activeEffect.setMatrix("projection",i.getProjectionMatrix()),this._mustRebind(i,o)&&(this._activeEffect.setColor3("mainColor",this.mainColor),this._activeEffect.setColor3("lineColor",this.lineColor),this._activeEffect.setVector3("gridOffset",this.gridOffset),this._gridControl.x=this.gridRatio,this._gridControl.y=Math.round(this.majorUnitFrequency),this._gridControl.z=this.minorUnitVisibility,this._gridControl.w=this.opacity,this._activeEffect.setVector4("gridControl",this._gridControl),this._opacityTexture&&m.a.OpacityTextureEnabled&&(this._activeEffect.setTexture("opacitySampler",this._opacityTexture),this._activeEffect.setFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),this._activeEffect.setMatrix("opacityMatrix",this._opacityTexture.getTextureMatrix()))),h.a.BindFogParameters(i,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);return e.customType="BABYLON.GridMaterial",e},t.prototype.getClassName=function(){return"GridMaterial"},t.Parse=function(e,n,i){return u.a.Parse((function(){return new t(e.name,n)}),e,n,i)},Object(f.c)([Object(u.e)()],t.prototype,"mainColor",void 0),Object(f.c)([Object(u.e)()],t.prototype,"lineColor",void 0),Object(f.c)([Object(u.c)()],t.prototype,"gridRatio",void 0),Object(f.c)([Object(u.e)()],t.prototype,"gridOffset",void 0),Object(f.c)([Object(u.c)()],t.prototype,"majorUnitFrequency",void 0),Object(f.c)([Object(u.c)()],t.prototype,"minorUnitVisibility",void 0),Object(f.c)([Object(u.c)()],t.prototype,"opacity",void 0),Object(f.c)([Object(u.c)()],t.prototype,"preMultiplyAlpha",void 0),Object(f.c)([Object(u.m)("opacityTexture")],t.prototype,"_opacityTexture",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityTexture",void 0),t}(p.a);_.a.RegisteredTypes["BABYLON.GridMaterial"]=K;var Z="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n\nuniform float time;\nuniform float speed;\nuniform float movingSpeed;\nuniform vec3 fogColor;\nuniform sampler2D noiseTexture;\nuniform float fogDensity;\n\nvarying float noise;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nfloat random( vec3 scale,float seed ){\nreturn fract( sin( dot( gl_FragCoord.xyz+seed,scale ) )*43758.5453+seed ) ;\n}\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\n\nvec4 noiseTex=texture2D( noiseTexture,vDiffuseUV );\nvec2 T1=vDiffuseUV+vec2( 1.5,-1.5 )*time*0.02;\nvec2 T2=vDiffuseUV+vec2( -0.5,2.0 )*time*0.01*speed;\nT1.x+=noiseTex.x*2.0;\nT1.y+=noiseTex.y*2.0;\nT2.x-=noiseTex.y*0.2+time*0.001*movingSpeed;\nT2.y+=noiseTex.z*0.2+time*0.002*movingSpeed;\nfloat p=texture2D( noiseTexture,T1*3.0 ).a;\nvec4 lavaColor=texture2D( diffuseSampler,T2*4.0);\nvec4 temp=lavaColor*( vec4( p,p,p,p )*2. )+( lavaColor*lavaColor-0.1 );\nbaseColor=temp;\nfloat depth=gl_FragCoord.z*4.0;\nconst float LOG2=1.442695;\nfloat fogFactor=exp2(-fogDensity*fogDensity*depth*depth*LOG2 );\nfogFactor=1.0-clamp( fogFactor,0.0,1.0 );\nbaseColor=mix( baseColor,vec4( fogColor,baseColor.w ),fogFactor );\ndiffuseColor=baseColor.rgb;\n\n\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0]\n#include<lightFragment>[1]\n#include<lightFragment>[2]\n#include<lightFragment>[3]\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}";g.a.ShadersStore.lavaPixelShader=Z;var Y="precision highp float;\n\nuniform float time;\nuniform float lowFrequencySpeed;\n\nvarying float noise;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n\n\nvec3 mod289(vec3 x)\n{\nreturn x-floor(x*(1.0/289.0))*289.0;\n}\nvec4 mod289(vec4 x)\n{\nreturn x-floor(x*(1.0/289.0))*289.0;\n}\nvec4 permute(vec4 x)\n{\nreturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 taylorInvSqrt(vec4 r)\n{\nreturn 1.79284291400159-0.85373472095314*r;\n}\nvec3 fade(vec3 t) {\nreturn t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\nfloat pnoise(vec3 P,vec3 rep)\n{\nvec3 Pi0=mod(floor(P),rep);\nvec3 Pi1=mod(Pi0+vec3(1.0),rep);\nPi0=mod289(Pi0);\nPi1=mod289(Pi1);\nvec3 Pf0=fract(P);\nvec3 Pf1=Pf0-vec3(1.0);\nvec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);\nvec4 iy=vec4(Pi0.yy,Pi1.yy);\nvec4 iz0=Pi0.zzzz;\nvec4 iz1=Pi1.zzzz;\nvec4 ixy=permute(permute(ix)+iy);\nvec4 ixy0=permute(ixy+iz0);\nvec4 ixy1=permute(ixy+iz1);\nvec4 gx0=ixy0*(1.0/7.0);\nvec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;\ngx0=fract(gx0);\nvec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);\nvec4 sz0=step(gz0,vec4(0.0));\ngx0-=sz0*(step(0.0,gx0)-0.5);\ngy0-=sz0*(step(0.0,gy0)-0.5);\nvec4 gx1=ixy1*(1.0/7.0);\nvec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;\ngx1=fract(gx1);\nvec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);\nvec4 sz1=step(gz1,vec4(0.0));\ngx1-=sz1*(step(0.0,gx1)-0.5);\ngy1-=sz1*(step(0.0,gy1)-0.5);\nvec3 g000=vec3(gx0.x,gy0.x,gz0.x);\nvec3 g100=vec3(gx0.y,gy0.y,gz0.y);\nvec3 g010=vec3(gx0.z,gy0.z,gz0.z);\nvec3 g110=vec3(gx0.w,gy0.w,gz0.w);\nvec3 g001=vec3(gx1.x,gy1.x,gz1.x);\nvec3 g101=vec3(gx1.y,gy1.y,gz1.y);\nvec3 g011=vec3(gx1.z,gy1.z,gz1.z);\nvec3 g111=vec3(gx1.w,gy1.w,gz1.w);\nvec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));\ng000*=norm0.x;\ng010*=norm0.y;\ng100*=norm0.z;\ng110*=norm0.w;\nvec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));\ng001*=norm1.x;\ng011*=norm1.y;\ng101*=norm1.z;\ng111*=norm1.w;\nfloat n000=dot(g000,Pf0);\nfloat n100=dot(g100,vec3(Pf1.x,Pf0.yz));\nfloat n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));\nfloat n110=dot(g110,vec3(Pf1.xy,Pf0.z));\nfloat n001=dot(g001,vec3(Pf0.xy,Pf1.z));\nfloat n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));\nfloat n011=dot(g011,vec3(Pf0.x,Pf1.yz));\nfloat n111=dot(g111,Pf1);\nvec3 fade_xyz=fade(Pf0);\nvec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);\nvec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);\nfloat n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);\nreturn 2.2*n_xyz;\n}\n\nfloat turbulence( vec3 p ) {\nfloat w=100.0;\nfloat t=-.5;\nfor (float f=1.0 ; f<=10.0 ; f++ ){\nfloat power=pow( 2.0,f );\nt+=abs( pnoise( vec3( power*p ),vec3( 10.0,10.0,10.0 ) )/power );\n}\nreturn t;\n}\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef NORMAL\n\nnoise=10.0*-.10*turbulence( .5*normal+time*1.15 );\n\nfloat b=lowFrequencySpeed*5.0*pnoise( 0.05*position +vec3(time*1.025),vec3( 100.0 ) );\n\nfloat displacement =-1.5*noise+b;\n\nvec3 newPosition=position+normal*displacement;\ngl_Position=viewProjection*finalWorld*vec4( newPosition,1.0 );\nvec4 worldPos=finalWorld*vec4(newPosition,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}";g.a.ShadersStore.lavaVertexShader=Y;var q=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.LIGHT0=!1,t.LIGHT1=!1,t.LIGHT2=!1,t.LIGHT3=!1,t.SPOTLIGHT0=!1,t.SPOTLIGHT1=!1,t.SPOTLIGHT2=!1,t.SPOTLIGHT3=!1,t.HEMILIGHT0=!1,t.HEMILIGHT1=!1,t.HEMILIGHT2=!1,t.HEMILIGHT3=!1,t.DIRLIGHT0=!1,t.DIRLIGHT1=!1,t.DIRLIGHT2=!1,t.DIRLIGHT3=!1,t.POINTLIGHT0=!1,t.POINTLIGHT1=!1,t.POINTLIGHT2=!1,t.POINTLIGHT3=!1,t.SHADOW0=!1,t.SHADOW1=!1,t.SHADOW2=!1,t.SHADOW3=!1,t.SHADOWS=!1,t.SHADOWESM0=!1,t.SHADOWESM1=!1,t.SHADOWESM2=!1,t.SHADOWESM3=!1,t.SHADOWPOISSON0=!1,t.SHADOWPOISSON1=!1,t.SHADOWPOISSON2=!1,t.SHADOWPOISSON3=!1,t.SHADOWPCF0=!1,t.SHADOWPCF1=!1,t.SHADOWPCF2=!1,t.SHADOWPCF3=!1,t.SHADOWPCSS0=!1,t.SHADOWPCSS1=!1,t.SHADOWPCSS2=!1,t.SHADOWPCSS3=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.UNLIT=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),J=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.speed=1,i.movingSpeed=1,i.lowFrequencySpeed=1,i.fogDensity=.15,i._lastTime=0,i.diffuseColor=new c.a(1,1,1),i._disableLighting=!1,i._unlit=!1,i._maxSimultaneousLights=4,i._scaledDiffuse=new c.a,i}return Object(f.d)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new q);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;var o=r.getEngine();if(i._areTexturesDirty&&(i._needUVs=!1,r.texturesEnabled&&this._diffuseTexture&&m.a.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;i._needUVs=!0,i.DIFFUSE=!0}if(h.a.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=!0,h.a.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),h.a.PrepareDefinesForFrameBoundValues(r,o,i,!!n),h.a.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var a=new x.a;i.FOG&&a.addFallback(1,"FOG"),h.a.HandleFallbacksForShadows(i,a),i.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e);var s=[v.b.PositionKind];i.NORMAL&&s.push(v.b.NormalKind),i.UV1&&s.push(v.b.UVKind),i.UV2&&s.push(v.b.UV2Kind),i.VERTEXCOLOR&&s.push(v.b.ColorKind),h.a.PrepareAttributesForBones(s,e,i,a),h.a.PrepareAttributesForInstances(s,i);var l=i.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","time","speed","movingSpeed","fogColor","fogDensity","lowFrequencySpeed"],u=["diffuseSampler","noiseTexture"],c=new Array;h.a.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("lava",{attributes:s,uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:l,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n._materialDefines;if(o){var a=n.effect;a&&(this._activeEffect=a,o.UNLIT=this._unlit,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),h.a.BindBonesParameters(t,this._activeEffect),this._mustRebind(r,a)&&(this.diffuseTexture&&m.a.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.noiseTexture&&this._activeEffect.setTexture("noiseTexture",this.noiseTexture),h.a.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),h.a.BindEyePosition(a,r)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*t.visibility),r.lightsEnabled&&!this.disableLighting&&h.a.BindLights(r,t,this._activeEffect,o),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect),this._lastTime+=r.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime*this.speed/1e3),this.fogColor||(this.fogColor=c.a.Black()),this._activeEffect.setColor3("fogColor",this.fogColor),this._activeEffect.setFloat("fogDensity",this.fogDensity),this._activeEffect.setFloat("lowFrequencySpeed",this.lowFrequencySpeed),this._activeEffect.setFloat("movingSpeed",this.movingSpeed),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.noiseTexture&&this.noiseTexture.animations&&this.noiseTexture.animations.length>0&&e.push(this.noiseTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this.diffuseTexture===t},t.prototype.dispose=function(t){this.diffuseTexture&&this.diffuseTexture.dispose(),this.noiseTexture&&this.noiseTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);return e.customType="BABYLON.LavaMaterial",e},t.prototype.getClassName=function(){return"LavaMaterial"},t.Parse=function(e,n,i){return u.a.Parse((function(){return new t(e.name,n)}),e,n,i)},Object(f.c)([Object(u.m)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),Object(f.c)([Object(u.m)()],t.prototype,"noiseTexture",void 0),Object(f.c)([Object(u.e)()],t.prototype,"fogColor",void 0),Object(f.c)([Object(u.c)()],t.prototype,"speed",void 0),Object(f.c)([Object(u.c)()],t.prototype,"movingSpeed",void 0),Object(f.c)([Object(u.c)()],t.prototype,"lowFrequencySpeed",void 0),Object(f.c)([Object(u.c)()],t.prototype,"fogDensity",void 0),Object(f.c)([Object(u.e)()],t.prototype,"diffuseColor",void 0),Object(f.c)([Object(u.c)("disableLighting")],t.prototype,"_disableLighting",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(f.c)([Object(u.c)("unlit")],t.prototype,"_unlit",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"unlit",void 0),Object(f.c)([Object(u.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(p.a);_.a.RegisteredTypes["BABYLON.LavaMaterial"]=J;var Q="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform sampler2D mixMap1Sampler;\nuniform vec2 vTextureInfos;\n#ifdef MIXMAP2\nuniform sampler2D mixMap2Sampler;\n#endif\nuniform sampler2D diffuse1Sampler;\nuniform sampler2D diffuse2Sampler;\nuniform sampler2D diffuse3Sampler;\nuniform sampler2D diffuse4Sampler;\nuniform vec2 diffuse1Infos;\nuniform vec2 diffuse2Infos;\nuniform vec2 diffuse3Infos;\nuniform vec2 diffuse4Infos;\n#ifdef MIXMAP2\nuniform sampler2D diffuse5Sampler;\nuniform sampler2D diffuse6Sampler;\nuniform sampler2D diffuse7Sampler;\nuniform sampler2D diffuse8Sampler;\nuniform vec2 diffuse5Infos;\nuniform vec2 diffuse6Infos;\nuniform vec2 diffuse7Infos;\nuniform vec2 diffuse8Infos;\n#endif\n#endif\n\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 finalMixColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef MIXMAP2\nvec4 mixColor2=vec4(1.,1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nvec4 mixColor=texture2D(mixMap1Sampler,vTextureUV);\n#include<depthPrePass>\nmixColor.rgb*=vTextureInfos.y;\nvec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);\nvec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);\nvec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);\nvec4 diffuse4Color=texture2D(diffuse4Sampler,vTextureUV*diffuse4Infos);\ndiffuse1Color.rgb*=mixColor.r;\ndiffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,mixColor.g);\ndiffuse3Color.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,mixColor.b);\nfinalMixColor.rgb=mix(diffuse3Color.rgb,diffuse4Color.rgb,1.0-mixColor.a);\n#ifdef MIXMAP2\nmixColor=texture2D(mixMap2Sampler,vTextureUV);\nmixColor.rgb*=vTextureInfos.y;\nvec4 diffuse5Color=texture2D(diffuse5Sampler,vTextureUV*diffuse5Infos);\nvec4 diffuse6Color=texture2D(diffuse6Sampler,vTextureUV*diffuse6Infos);\nvec4 diffuse7Color=texture2D(diffuse7Sampler,vTextureUV*diffuse7Infos);\nvec4 diffuse8Color=texture2D(diffuse8Sampler,vTextureUV*diffuse8Infos);\ndiffuse5Color.rgb=mix(finalMixColor.rgb,diffuse5Color.rgb,mixColor.r);\ndiffuse6Color.rgb=mix(diffuse5Color.rgb,diffuse6Color.rgb,mixColor.g);\ndiffuse7Color.rgb=mix(diffuse6Color.rgb,diffuse7Color.rgb,mixColor.b);\nfinalMixColor.rgb=mix(diffuse7Color.rgb,diffuse8Color.rgb,1.0-mixColor.a);\n#endif\n#endif\n#ifdef VERTEXCOLOR\nfinalMixColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor*finalMixColor.rgb,0.0,1.0);\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}\n";g.a.ShadersStore.mixPixelShader=Q;var $="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform mat4 textureMatrix;\nuniform vec2 vTextureInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vTextureInfos.x == 0.)\n{\nvTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";g.a.ShadersStore.mixVertexShader=$;var ee=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.MIXMAP2=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),te=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.diffuseColor=new c.a(1,1,1),i.specularColor=new c.a(0,0,0),i.specularPower=64,i._disableLighting=!1,i._maxSimultaneousLights=4,i}return Object(f.d)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new ee);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;var o=r.getEngine();if(r.texturesEnabled){if(!this._mixTexture1||!this._mixTexture1.isReady())return!1;if(i._needUVs=!0,m.a.DiffuseTextureEnabled){if(!this._diffuseTexture1||!this._diffuseTexture1.isReady())return!1;if(i.DIFFUSE=!0,!this._diffuseTexture2||!this._diffuseTexture2.isReady())return!1;if(!this._diffuseTexture3||!this._diffuseTexture3.isReady())return!1;if(!this._diffuseTexture4||!this._diffuseTexture4.isReady())return!1;if(this._mixTexture2){if(!this._mixTexture2.isReady())return!1;if(i.MIXMAP2=!0,!this._diffuseTexture5||!this._diffuseTexture5.isReady())return!1;if(!this._diffuseTexture6||!this._diffuseTexture6.isReady())return!1;if(!this._diffuseTexture7||!this._diffuseTexture7.isReady())return!1;if(!this._diffuseTexture8||!this._diffuseTexture8.isReady())return!1}}}if(h.a.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=h.a.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),h.a.PrepareDefinesForFrameBoundValues(r,o,i,!!n),h.a.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var a=new x.a;i.FOG&&a.addFallback(1,"FOG"),h.a.HandleFallbacksForShadows(i,a,this.maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e);var s=[v.b.PositionKind];i.NORMAL&&s.push(v.b.NormalKind),i.UV1&&s.push(v.b.UVKind),i.UV2&&s.push(v.b.UV2Kind),i.VERTEXCOLOR&&s.push(v.b.ColorKind),h.a.PrepareAttributesForBones(s,e,i,a),h.a.PrepareAttributesForInstances(s,i);var l=i.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMatrix","diffuse1Infos","diffuse2Infos","diffuse3Infos","diffuse4Infos","diffuse5Infos","diffuse6Infos","diffuse7Infos","diffuse8Infos"],u=["mixMap1Sampler","mixMap2Sampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","diffuse4Sampler","diffuse5Sampler","diffuse6Sampler","diffuse7Sampler","diffuse8Sampler"],c=new Array;h.a.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("mix",{attributes:s,uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:l,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n._materialDefines;if(o){var a=n.effect;a&&(this._activeEffect=a,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),h.a.BindBonesParameters(t,this._activeEffect),this._mustRebind(r,a)&&(this._mixTexture1&&(this._activeEffect.setTexture("mixMap1Sampler",this._mixTexture1),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture1.coordinatesIndex,this._mixTexture1.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture1.getTextureMatrix()),m.a.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale)),this._diffuseTexture4&&(this._activeEffect.setTexture("diffuse4Sampler",this._diffuseTexture4),this._activeEffect.setFloat2("diffuse4Infos",this._diffuseTexture4.uScale,this._diffuseTexture4.vScale)))),this._mixTexture2&&(this._activeEffect.setTexture("mixMap2Sampler",this._mixTexture2),m.a.DiffuseTextureEnabled&&(this._diffuseTexture5&&(this._activeEffect.setTexture("diffuse5Sampler",this._diffuseTexture5),this._activeEffect.setFloat2("diffuse5Infos",this._diffuseTexture5.uScale,this._diffuseTexture5.vScale)),this._diffuseTexture6&&(this._activeEffect.setTexture("diffuse6Sampler",this._diffuseTexture6),this._activeEffect.setFloat2("diffuse6Infos",this._diffuseTexture6.uScale,this._diffuseTexture6.vScale)),this._diffuseTexture7&&(this._activeEffect.setTexture("diffuse7Sampler",this._diffuseTexture7),this._activeEffect.setFloat2("diffuse7Infos",this._diffuseTexture7.uScale,this._diffuseTexture7.vScale)),this._diffuseTexture8&&(this._activeEffect.setTexture("diffuse8Sampler",this._diffuseTexture8),this._activeEffect.setFloat2("diffuse8Infos",this._diffuseTexture8.uScale,this._diffuseTexture8.vScale)))),h.a.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),h.a.BindEyePosition(a,r)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),o.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),r.lightsEnabled&&!this.disableLighting&&h.a.BindLights(r,t,this._activeEffect,o,this.maxSimultaneousLights),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this._mixTexture1&&this._mixTexture1.animations&&this._mixTexture1.animations.length>0&&e.push(this._mixTexture1),this._mixTexture2&&this._mixTexture2.animations&&this._mixTexture2.animations.length>0&&e.push(this._mixTexture2),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._mixTexture1&&t.push(this._mixTexture1),this._diffuseTexture1&&t.push(this._diffuseTexture1),this._diffuseTexture2&&t.push(this._diffuseTexture2),this._diffuseTexture3&&t.push(this._diffuseTexture3),this._diffuseTexture4&&t.push(this._diffuseTexture4),this._mixTexture2&&t.push(this._mixTexture2),this._diffuseTexture5&&t.push(this._diffuseTexture5),this._diffuseTexture6&&t.push(this._diffuseTexture6),this._diffuseTexture7&&t.push(this._diffuseTexture7),this._diffuseTexture8&&t.push(this._diffuseTexture8),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this._mixTexture1===t||(this._diffuseTexture1===t||(this._diffuseTexture2===t||(this._diffuseTexture3===t||(this._diffuseTexture4===t||(this._mixTexture2===t||(this._diffuseTexture5===t||(this._diffuseTexture6===t||(this._diffuseTexture7===t||this._diffuseTexture8===t)))))))))},t.prototype.dispose=function(t){this._mixTexture1&&this._mixTexture1.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);return e.customType="BABYLON.MixMaterial",e},t.prototype.getClassName=function(){return"MixMaterial"},t.Parse=function(e,n,i){return u.a.Parse((function(){return new t(e.name,n)}),e,n,i)},Object(f.c)([Object(u.m)("mixTexture1")],t.prototype,"_mixTexture1",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"mixTexture1",void 0),Object(f.c)([Object(u.m)("mixTexture2")],t.prototype,"_mixTexture2",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"mixTexture2",void 0),Object(f.c)([Object(u.m)("diffuseTexture1")],t.prototype,"_diffuseTexture1",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture1",void 0),Object(f.c)([Object(u.m)("diffuseTexture2")],t.prototype,"_diffuseTexture2",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture2",void 0),Object(f.c)([Object(u.m)("diffuseTexture3")],t.prototype,"_diffuseTexture3",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture3",void 0),Object(f.c)([Object(u.m)("diffuseTexture4")],t.prototype,"_diffuseTexture4",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture4",void 0),Object(f.c)([Object(u.m)("diffuseTexture1")],t.prototype,"_diffuseTexture5",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture5",void 0),Object(f.c)([Object(u.m)("diffuseTexture2")],t.prototype,"_diffuseTexture6",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture6",void 0),Object(f.c)([Object(u.m)("diffuseTexture3")],t.prototype,"_diffuseTexture7",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture7",void 0),Object(f.c)([Object(u.m)("diffuseTexture4")],t.prototype,"_diffuseTexture8",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture8",void 0),Object(f.c)([Object(u.e)()],t.prototype,"diffuseColor",void 0),Object(f.c)([Object(u.e)()],t.prototype,"specularColor",void 0),Object(f.c)([Object(u.c)()],t.prototype,"specularPower",void 0),Object(f.c)([Object(u.c)("disableLighting")],t.prototype,"_disableLighting",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(f.c)([Object(u.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(p.a);_.a.RegisteredTypes["BABYLON.MixMaterial"]=te;var ne="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef LIGHTING\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#endif\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef NORMAL\nbaseColor=mix(baseColor,vec4(vNormalW,1.0),0.5);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\n#ifdef LIGHTING\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0]\n#include<lightFragment>[1]\n#include<lightFragment>[2]\n#include<lightFragment>[3]\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=baseColor.rgb;\n#endif\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}";g.a.ShadersStore.normalPixelShader=ne;var ie="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";g.a.ShadersStore.normalVertexShader=ie;var re=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.LIGHT0=!1,t.LIGHT1=!1,t.LIGHT2=!1,t.LIGHT3=!1,t.SPOTLIGHT0=!1,t.SPOTLIGHT1=!1,t.SPOTLIGHT2=!1,t.SPOTLIGHT3=!1,t.HEMILIGHT0=!1,t.HEMILIGHT1=!1,t.HEMILIGHT2=!1,t.HEMILIGHT3=!1,t.DIRLIGHT0=!1,t.DIRLIGHT1=!1,t.DIRLIGHT2=!1,t.DIRLIGHT3=!1,t.POINTLIGHT0=!1,t.POINTLIGHT1=!1,t.POINTLIGHT2=!1,t.POINTLIGHT3=!1,t.SHADOW0=!1,t.SHADOW1=!1,t.SHADOW2=!1,t.SHADOW3=!1,t.SHADOWS=!1,t.SHADOWESM0=!1,t.SHADOWESM1=!1,t.SHADOWESM2=!1,t.SHADOWESM3=!1,t.SHADOWPOISSON0=!1,t.SHADOWPOISSON1=!1,t.SHADOWPOISSON2=!1,t.SHADOWPOISSON3=!1,t.SHADOWPCF0=!1,t.SHADOWPCF1=!1,t.SHADOWPCF2=!1,t.SHADOWPCF3=!1,t.SHADOWPCSS0=!1,t.SHADOWPCSS1=!1,t.SHADOWPCSS2=!1,t.SHADOWPCSS3=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.LIGHTING=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),oe=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.diffuseColor=new c.a(1,1,1),i._disableLighting=!1,i._maxSimultaneousLights=4,i}return Object(f.d)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()||e.visibility<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new re);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;var o=r.getEngine();if(i._areTexturesDirty&&(i._needUVs=!1,r.texturesEnabled&&this._diffuseTexture&&m.a.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;i._needUVs=!0,i.DIFFUSE=!0}if(h.a.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=!0,h.a.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),h.a.PrepareDefinesForFrameBoundValues(r,o,i,!!n),i.LIGHTING=!this._disableLighting,h.a.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var a=new x.a;i.FOG&&a.addFallback(1,"FOG"),h.a.HandleFallbacksForShadows(i,a),i.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e);var s=[v.b.PositionKind];i.NORMAL&&s.push(v.b.NormalKind),i.UV1&&s.push(v.b.UVKind),i.UV2&&s.push(v.b.UV2Kind),h.a.PrepareAttributesForBones(s,e,i,a),h.a.PrepareAttributesForInstances(s,i);var l=i.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix"],u=["diffuseSampler"],c=new Array;h.a.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:i,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("normal",{attributes:s,uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:l,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n._materialDefines;if(o){var a=n.effect;a&&(this._activeEffect=a,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),h.a.BindBonesParameters(t,this._activeEffect),this._mustRebind(r,a)&&(this.diffuseTexture&&m.a.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),h.a.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),h.a.BindEyePosition(a,r)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.lightsEnabled&&!this.disableLighting&&h.a.BindLights(r,t,this._activeEffect,o),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this.diffuseTexture===t},t.prototype.dispose=function(t){this.diffuseTexture&&this.diffuseTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);return e.customType="BABYLON.NormalMaterial",e},t.prototype.getClassName=function(){return"NormalMaterial"},t.Parse=function(e,n,i){return u.a.Parse((function(){return new t(e.name,n)}),e,n,i)},Object(f.c)([Object(u.m)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),Object(f.c)([Object(u.e)()],t.prototype,"diffuseColor",void 0),Object(f.c)([Object(u.c)("disableLighting")],t.prototype,"_disableLighting",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(f.c)([Object(u.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(p.a);_.a.RegisteredTypes["BABYLON.NormalMaterial"]=oe;var ae="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform float alpha;\nuniform vec3 shadowColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0..1]\n\nvec4 color=vec4(shadowColor,(1.0-clamp(shadow,0.,1.))*alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}";g.a.ShadersStore.shadowOnlyPixelShader=ae;var se="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";g.a.ShadersStore.shadowOnlyVertexShader=se;var le=function(e){function t(){var t=e.call(this)||this;return t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),fe=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.shadowColor=c.a.Black(),i}return Object(f.d)(t,e),t.prototype.needAlphaBlending=function(){return!0},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},Object.defineProperty(t.prototype,"activeLight",{get:function(){return this._activeLight},set:function(e){this._activeLight=e},enumerable:!0,configurable:!0}),t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new le);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;var o=r.getEngine();if(this._activeLight)for(var a=0,s=e.lightSources;a<s.length;a++){var l=s[a];if(l.shadowEnabled){if(this._activeLight===l)break;var f=e.lightSources.indexOf(this._activeLight);-1!==f&&(e.lightSources.splice(f,1),e.lightSources.splice(0,0,this._activeLight));break}}if(h.a.PrepareDefinesForFrameBoundValues(r,o,i,!!n),h.a.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=h.a.PrepareDefinesForLights(r,e,i,!1,1),h.a.PrepareDefinesForAttributes(e,i,!1,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var u=new x.a;i.FOG&&u.addFallback(1,"FOG"),h.a.HandleFallbacksForShadows(i,u,1),i.NUM_BONE_INFLUENCERS>0&&u.addCPUSkinningFallback(0,e);var c=[v.b.PositionKind];i.NORMAL&&c.push(v.b.NormalKind),h.a.PrepareAttributesForBones(c,e,i,u),h.a.PrepareAttributesForInstances(c,i);var d=i.toString(),p=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","alpha","shadowColor","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6"],m=new Array,_=new Array;h.a.PrepareUniformsAndSamplersList({uniformsNames:p,uniformBuffersNames:_,samplers:m,defines:i,maxSimultaneousLights:1}),t.setEffect(r.getEngine().createEffect("shadowOnly",{attributes:c,uniformsNames:p,uniformBuffersNames:_,samplers:m,defines:d,fallbacks:u,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:1}},o),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n._materialDefines;if(o){var a=n.effect;a&&(this._activeEffect=a,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),h.a.BindBonesParameters(t,this._activeEffect),this._mustRebind(r,a)&&(h.a.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._activeEffect.setFloat("alpha",this.alpha),this._activeEffect.setColor3("shadowColor",this.shadowColor),h.a.BindEyePosition(a,r)),r.lightsEnabled&&h.a.BindLights(r,t,this._activeEffect,o,1),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);return e.customType="BABYLON.ShadowOnlyMaterial",e},t.prototype.getClassName=function(){return"ShadowOnlyMaterial"},t.Parse=function(e,n,i){return u.a.Parse((function(){return new t(e.name,n)}),e,n,i)},t}(p.a);_.a.RegisteredTypes["BABYLON.ShadowOnlyMaterial"]=fe;var ue="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}";g.a.ShadersStore.simplePixelShader=ue;var ce="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";g.a.ShadersStore.simpleVertexShader=ce;var de=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),he=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.diffuseColor=new c.a(1,1,1),i._disableLighting=!1,i._maxSimultaneousLights=4,i}return Object(f.d)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new de);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;var o=r.getEngine();if(i._areTexturesDirty&&(i._needUVs=!1,r.texturesEnabled&&this._diffuseTexture&&m.a.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;i._needUVs=!0,i.DIFFUSE=!0}if(h.a.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=h.a.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),h.a.PrepareDefinesForFrameBoundValues(r,o,i,!!n),h.a.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var a=new x.a;i.FOG&&a.addFallback(1,"FOG"),h.a.HandleFallbacksForShadows(i,a,this.maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e);var s=[v.b.PositionKind];i.NORMAL&&s.push(v.b.NormalKind),i.UV1&&s.push(v.b.UVKind),i.UV2&&s.push(v.b.UV2Kind),i.VERTEXCOLOR&&s.push(v.b.ColorKind),h.a.PrepareAttributesForBones(s,e,i,a),h.a.PrepareAttributesForInstances(s,i);var l=i.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix"],u=["diffuseSampler"],c=new Array;h.a.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("simple",{attributes:s,uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:l,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights-1}},o),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n._materialDefines;if(o){var a=n.effect;a&&(this._activeEffect=a,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),h.a.BindBonesParameters(t,this._activeEffect),this._mustRebind(r,a)&&(this._diffuseTexture&&m.a.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),h.a.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),h.a.BindEyePosition(a,r)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.lightsEnabled&&!this.disableLighting&&h.a.BindLights(r,t,this._activeEffect,o,this.maxSimultaneousLights),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this.diffuseTexture===t},t.prototype.dispose=function(t){this._diffuseTexture&&this._diffuseTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);return e.customType="BABYLON.SimpleMaterial",e},t.prototype.getClassName=function(){return"SimpleMaterial"},t.Parse=function(e,n,i){return u.a.Parse((function(){return new t(e.name,n)}),e,n,i)},Object(f.c)([Object(u.m)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),Object(f.c)([Object(u.e)("diffuse")],t.prototype,"diffuseColor",void 0),Object(f.c)([Object(u.c)("disableLighting")],t.prototype,"_disableLighting",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(f.c)([Object(u.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(p.a);_.a.RegisteredTypes["BABYLON.SimpleMaterial"]=he;var pe="precision highp float;\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\nuniform vec3 cameraPosition;\nuniform vec3 cameraOffset;\nuniform float luminance;\nuniform float turbidity;\nuniform float rayleigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\nuniform vec3 sunPosition;\n\n#include<fogFragmentDeclaration>\n\nconst float e=2.71828182845904523536028747135266249775724709369995957;\nconst float pi=3.141592653589793238462643383279502884197169;\nconst float n=1.0003;\nconst float N=2.545E25;\nconst float pn=0.035;\nconst vec3 lambda=vec3(680E-9,550E-9,450E-9);\nconst vec3 K=vec3(0.686,0.678,0.666);\nconst float v=4.0;\nconst float rayleighZenithLength=8.4E3;\nconst float mieZenithLength=1.25E3;\nconst vec3 up=vec3(0.0,1.0,0.0);\nconst float EE=1000.0;\nconst float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;\nconst float cutoffAngle=pi/1.95;\nconst float steepness=1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));\n}\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005/vec3(94,40,18);\n}\nfloat rayleighPhase(float cosTheta)\n{\nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));\n}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{\nfloat c=(0.2*T )*10E-18;\nreturn 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;\n}\nfloat hgPhase(float cosTheta,float g)\n{\nreturn (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));\n}\nfloat A=0.15;\nfloat B=0.50;\nfloat C=0.10;\nfloat D=0.20;\nfloat EEE=0.02;\nfloat F=0.30;\nfloat W=1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\n\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\nfloat rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));\nvec3 sunDirection=normalize(sunPosition);\nfloat sunE=sunIntensity(dot(sunDirection,up));\nvec3 betaR=simplifiedRayleigh()*rayleighCoefficient;\nvec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;\nfloat zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));\nfloat sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nfloat sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nvec3 Fex=exp(-(betaR*sR+betaM*sM));\nfloat cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);\nfloat rPhase=rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta=betaR*rPhase;\nfloat mPhase=hgPhase(cosTheta,mieDirectionalG);\nvec3 betaMTheta=betaM*mPhase;\nvec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));\nLin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));\nvec3 direction=normalize(vPositionW-cameraPosition);\nfloat theta=acos(direction.y);\nfloat phi=atan(direction.z,direction.x);\nvec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);\nvec3 L0=vec3(0.1)*Fex;\nfloat sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\nL0+=(sunE*19000.0*Fex)*sundisk;\nvec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor=(Lin+L0);\ntexColor*=0.04 ;\ntexColor+=vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance=1.0;\nfloat fLumScaled=0.1/luminance;\nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled);\nfloat ExposureBias=fLumCompressed;\nvec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\n\n\n\nvec3 retColor=curr*whiteScale;\n\n\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n\n#include<fogFragment>\ngl_FragColor=color;\n}\n";g.a.ShadersStore.skyPixelShader=pe;var me="precision highp float;\n\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\nvoid main(void) {\ngl_Position=viewProjection*world*vec4(position,1.0);\nvec4 worldPos=world*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";g.a.ShadersStore.skyVertexShader=me;var ve=function(e){function t(){var t=e.call(this)||this;return t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.POINTSIZE=!1,t.FOG=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),_e=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.luminance=1,i.turbidity=10,i.rayleigh=2,i.mieCoefficient=.005,i.mieDirectionalG=.8,i.distance=500,i.inclination=.49,i.azimuth=.25,i.sunPosition=new o.e(0,100,0),i.useSunPosition=!1,i.cameraOffset=o.e.Zero(),i._cameraPosition=o.e.Zero(),i}return Object(f.d)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new ve);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;if(h.a.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,!1,i),h.a.PrepareDefinesForAttributes(e,i,!0,!1),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var o=new x.a;i.FOG&&o.addFallback(1,"FOG");var a=[v.b.PositionKind];i.VERTEXCOLOR&&a.push(v.b.ColorKind);var s=i.toString();t.setEffect(r.getEngine().createEffect("sky",a,["world","viewProjection","view","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset"],[],s,o,this.onCompiled,this.onError),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene();if(n._materialDefines){var o=n.effect;if(o){this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),this._mustRebind(r,o)&&(h.a.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize)),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect);var a=r.activeCamera;if(a){var s=a.getWorldMatrix();this._cameraPosition.x=s.m[12],this._cameraPosition.y=s.m[13],this._cameraPosition.z=s.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){var l=Math.PI*(this.inclination-.5),f=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(f),this.sunPosition.y=this.distance*Math.sin(f)*Math.sin(l),this.sunPosition.z=this.distance*Math.sin(f)*Math.cos(l)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(t,this._activeEffect)}}},t.prototype.getAnimatables=function(){return[]},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);return e.customType="BABYLON.SkyMaterial",e},t.prototype.getClassName=function(){return"SkyMaterial"},t.Parse=function(e,n,i){return u.a.Parse((function(){return new t(e.name,n)}),e,n,i)},Object(f.c)([Object(u.c)()],t.prototype,"luminance",void 0),Object(f.c)([Object(u.c)()],t.prototype,"turbidity",void 0),Object(f.c)([Object(u.c)()],t.prototype,"rayleigh",void 0),Object(f.c)([Object(u.c)()],t.prototype,"mieCoefficient",void 0),Object(f.c)([Object(u.c)()],t.prototype,"mieDirectionalG",void 0),Object(f.c)([Object(u.c)()],t.prototype,"distance",void 0),Object(f.c)([Object(u.c)()],t.prototype,"inclination",void 0),Object(f.c)([Object(u.c)()],t.prototype,"azimuth",void 0),Object(f.c)([Object(u.o)()],t.prototype,"sunPosition",void 0),Object(f.c)([Object(u.c)()],t.prototype,"useSunPosition",void 0),Object(f.c)([Object(u.c)()],t.prototype,"cameraOffset",void 0),t}(p.a);_.a.RegisteredTypes["BABYLON.SkyMaterial"]=_e;var ge="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform sampler2D textureSampler;\nuniform vec2 vTextureInfos;\nuniform sampler2D diffuse1Sampler;\nuniform sampler2D diffuse2Sampler;\nuniform sampler2D diffuse3Sampler;\nuniform vec2 diffuse1Infos;\nuniform vec2 diffuse2Infos;\nuniform vec2 diffuse3Infos;\n#endif\n#ifdef BUMP\nuniform sampler2D bump1Sampler;\nuniform sampler2D bump2Sampler;\nuniform sampler2D bump3Sampler;\n#endif\n\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n\n#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\nreturn mat3(tangent*invmax,binormal*invmax,normal);\n}\nvec3 perturbNormal(vec3 viewDir,vec3 mixColor)\n{\nvec3 bump1Color=texture2D(bump1Sampler,vTextureUV*diffuse1Infos).xyz;\nvec3 bump2Color=texture2D(bump2Sampler,vTextureUV*diffuse2Infos).xyz;\nvec3 bump3Color=texture2D(bump3Sampler,vTextureUV*diffuse3Infos).xyz;\nbump1Color.rgb*=mixColor.r;\nbump2Color.rgb=mix(bump1Color.rgb,bump2Color.rgb,mixColor.g);\nvec3 map=mix(bump2Color.rgb,bump3Color.rgb,mixColor.b);\nmap=map*255./127.-128./127.;\nmat3 TBN=cotangent_frame(vNormalW*vTextureInfos.y,-viewDir,vTextureUV);\nreturn normalize(TBN*map);\n}\n#endif\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(textureSampler,vTextureUV);\n#if defined(BUMP) && defined(DIFFUSE)\nnormalW=perturbNormal(viewDirectionW,baseColor.rgb);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vTextureInfos.y;\nvec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);\nvec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);\nvec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);\ndiffuse1Color.rgb*=baseColor.r;\ndiffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,baseColor.g);\nbaseColor.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,baseColor.b);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor*baseColor.rgb,0.0,1.0);\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}\n";g.a.ShadersStore.terrainPixelShader=ge;var be="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform mat4 textureMatrix;\nuniform vec2 vTextureInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vTextureInfos.x == 0.)\n{\nvTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";g.a.ShadersStore.terrainVertexShader=be;var ye=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.BUMP=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),xe=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.diffuseColor=new c.a(1,1,1),i.specularColor=new c.a(0,0,0),i.specularPower=64,i._disableLighting=!1,i._maxSimultaneousLights=4,i}return Object(f.d)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new ye);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;var o=r.getEngine();if(r.texturesEnabled){if(!this.mixTexture||!this.mixTexture.isReady())return!1;if(i._needUVs=!0,m.a.DiffuseTextureEnabled){if(!this.diffuseTexture1||!this.diffuseTexture1.isReady())return!1;if(!this.diffuseTexture2||!this.diffuseTexture2.isReady())return!1;if(!this.diffuseTexture3||!this.diffuseTexture3.isReady())return!1;i.DIFFUSE=!0}if(this.bumpTexture1&&this.bumpTexture2&&this.bumpTexture3&&m.a.BumpTextureEnabled){if(!this.bumpTexture1.isReady())return!1;if(!this.bumpTexture2.isReady())return!1;if(!this.bumpTexture3.isReady())return!1;i._needNormals=!0,i.BUMP=!0}}if(h.a.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=h.a.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),h.a.PrepareDefinesForFrameBoundValues(r,o,i,!!n),h.a.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var a=new x.a;i.FOG&&a.addFallback(1,"FOG"),h.a.HandleFallbacksForShadows(i,a,this.maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e);var s=[v.b.PositionKind];i.NORMAL&&s.push(v.b.NormalKind),i.UV1&&s.push(v.b.UVKind),i.UV2&&s.push(v.b.UV2Kind),i.VERTEXCOLOR&&s.push(v.b.ColorKind),h.a.PrepareAttributesForBones(s,e,i,a),h.a.PrepareAttributesForInstances(s,i);var l=i.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMatrix","diffuse1Infos","diffuse2Infos","diffuse3Infos"],u=["textureSampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","bump1Sampler","bump2Sampler","bump3Sampler"],c=new Array;h.a.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("terrain",{attributes:s,uniformsNames:f,uniformBuffersNames:c,samplers:u,defines:l,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n._materialDefines;if(o){var a=n.effect;a&&(this._activeEffect=a,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),h.a.BindBonesParameters(t,this._activeEffect),this._mustRebind(r,a)&&(this.mixTexture&&(this._activeEffect.setTexture("textureSampler",this._mixTexture),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture.coordinatesIndex,this._mixTexture.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture.getTextureMatrix()),m.a.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale))),m.a.BumpTextureEnabled&&r.getEngine().getCaps().standardDerivatives&&(this._bumpTexture1&&this._activeEffect.setTexture("bump1Sampler",this._bumpTexture1),this._bumpTexture2&&this._activeEffect.setTexture("bump2Sampler",this._bumpTexture2),this._bumpTexture3&&this._activeEffect.setTexture("bump3Sampler",this._bumpTexture3))),h.a.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),h.a.BindEyePosition(a,r)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),o.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),r.lightsEnabled&&!this.disableLighting&&h.a.BindLights(r,t,this._activeEffect,o,this.maxSimultaneousLights),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&e.push(this.mixTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._mixTexture&&t.push(this._mixTexture),this._diffuseTexture1&&t.push(this._diffuseTexture1),this._diffuseTexture2&&t.push(this._diffuseTexture2),this._diffuseTexture3&&t.push(this._diffuseTexture3),this._bumpTexture1&&t.push(this._bumpTexture1),this._bumpTexture2&&t.push(this._bumpTexture2),this._bumpTexture3&&t.push(this._bumpTexture3),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this._mixTexture===t||(this._diffuseTexture1===t||(this._diffuseTexture2===t||(this._diffuseTexture3===t||(this._bumpTexture1===t||(this._bumpTexture2===t||this._bumpTexture3===t))))))},t.prototype.dispose=function(t){this.mixTexture&&this.mixTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);return e.customType="BABYLON.TerrainMaterial",e},t.prototype.getClassName=function(){return"TerrainMaterial"},t.Parse=function(e,n,i){return u.a.Parse((function(){return new t(e.name,n)}),e,n,i)},Object(f.c)([Object(u.m)("mixTexture")],t.prototype,"_mixTexture",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"mixTexture",void 0),Object(f.c)([Object(u.m)("diffuseTexture1")],t.prototype,"_diffuseTexture1",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture1",void 0),Object(f.c)([Object(u.m)("diffuseTexture2")],t.prototype,"_diffuseTexture2",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture2",void 0),Object(f.c)([Object(u.m)("diffuseTexture3")],t.prototype,"_diffuseTexture3",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture3",void 0),Object(f.c)([Object(u.m)("bumpTexture1")],t.prototype,"_bumpTexture1",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture1",void 0),Object(f.c)([Object(u.m)("bumpTexture2")],t.prototype,"_bumpTexture2",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture2",void 0),Object(f.c)([Object(u.m)("bumpTexture3")],t.prototype,"_bumpTexture3",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture3",void 0),Object(f.c)([Object(u.e)()],t.prototype,"diffuseColor",void 0),Object(f.c)([Object(u.e)()],t.prototype,"specularColor",void 0),Object(f.c)([Object(u.c)()],t.prototype,"specularPower",void 0),Object(f.c)([Object(u.c)("disableLighting")],t.prototype,"_disableLighting",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(f.c)([Object(u.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(p.a);_.a.RegisteredTypes["BABYLON.TerrainMaterial"]=xe;var Te="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSEX\nvarying vec2 vTextureUVX;\nuniform sampler2D diffuseSamplerX;\n#ifdef BUMPX\nuniform sampler2D normalSamplerX;\n#endif\n#endif\n#ifdef DIFFUSEY\nvarying vec2 vTextureUVY;\nuniform sampler2D diffuseSamplerY;\n#ifdef BUMPY\nuniform sampler2D normalSamplerY;\n#endif\n#endif\n#ifdef DIFFUSEZ\nvarying vec2 vTextureUVZ;\nuniform sampler2D diffuseSamplerZ;\n#ifdef BUMPZ\nuniform sampler2D normalSamplerZ;\n#endif\n#endif\n#ifdef NORMAL\nvarying mat3 tangentSpace;\n#endif\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(0.,0.,0.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=tangentSpace[2];\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\nvec4 baseNormal=vec4(0.0,0.0,0.0,1.0);\nnormalW*=normalW;\n#ifdef DIFFUSEX\nbaseColor+=texture2D(diffuseSamplerX,vTextureUVX)*normalW.x;\n#ifdef BUMPX\nbaseNormal+=texture2D(normalSamplerX,vTextureUVX)*normalW.x;\n#endif\n#endif\n#ifdef DIFFUSEY\nbaseColor+=texture2D(diffuseSamplerY,vTextureUVY)*normalW.y;\n#ifdef BUMPY\nbaseNormal+=texture2D(normalSamplerY,vTextureUVY)*normalW.y;\n#endif\n#endif\n#ifdef DIFFUSEZ\nbaseColor+=texture2D(diffuseSamplerZ,vTextureUVZ)*normalW.z;\n#ifdef BUMPZ\nbaseNormal+=texture2D(normalSamplerZ,vTextureUVZ)*normalW.z;\n#endif\n#endif\n#ifdef NORMAL\nnormalW=normalize((2.0*baseNormal.xyz-1.0)*tangentSpace);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}\n";g.a.ShadersStore.triplanarPixelShader=Te;var Ee="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSEX\nvarying vec2 vTextureUVX;\n#endif\n#ifdef DIFFUSEY\nvarying vec2 vTextureUVY;\n#endif\n#ifdef DIFFUSEZ\nvarying vec2 vTextureUVZ;\n#endif\nuniform float tileSize;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying mat3 tangentSpace;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef DIFFUSEX\nvTextureUVX=worldPos.zy/tileSize;\n#endif\n#ifdef DIFFUSEY\nvTextureUVY=worldPos.xz/tileSize;\n#endif\n#ifdef DIFFUSEZ\nvTextureUVZ=worldPos.xy/tileSize;\n#endif\n#ifdef NORMAL\n\nvec3 xtan=vec3(0,0,1);\nvec3 xbin=vec3(0,1,0);\nvec3 ytan=vec3(1,0,0);\nvec3 ybin=vec3(0,0,1);\nvec3 ztan=vec3(1,0,0);\nvec3 zbin=vec3(0,1,0);\nvec3 normalizedNormal=normalize(normal);\nnormalizedNormal*=normalizedNormal;\nvec3 worldBinormal=normalize(xbin*normalizedNormal.x+ybin*normalizedNormal.y+zbin*normalizedNormal.z);\nvec3 worldTangent=normalize(xtan*normalizedNormal.x+ytan*normalizedNormal.y+ztan*normalizedNormal.z);\nworldTangent=(world*vec4(worldTangent,1.0)).xyz;\nworldBinormal=(world*vec4(worldBinormal,1.0)).xyz;\nvec3 worldNormal=normalize(cross(worldTangent,worldBinormal));\ntangentSpace[0]=worldTangent;\ntangentSpace[1]=worldBinormal;\ntangentSpace[2]=worldNormal;\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";g.a.ShadersStore.triplanarVertexShader=Ee;var Ae=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSEX=!1,t.DIFFUSEY=!1,t.DIFFUSEZ=!1,t.BUMPX=!1,t.BUMPY=!1,t.BUMPZ=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.NORMAL=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),Se=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.tileSize=1,i.diffuseColor=new c.a(1,1,1),i.specularColor=new c.a(.2,.2,.2),i.specularPower=64,i._disableLighting=!1,i._maxSimultaneousLights=4,i}return Object(f.d)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new Ae);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;var o=r.getEngine();if(i._areTexturesDirty&&r.texturesEnabled){if(m.a.DiffuseTextureEnabled)for(var a=[this.diffuseTextureX,this.diffuseTextureY,this.diffuseTextureZ],s=["DIFFUSEX","DIFFUSEY","DIFFUSEZ"],l=0;l<a.length;l++)if(a[l]){if(!a[l].isReady())return!1;i[s[l]]=!0}if(m.a.BumpTextureEnabled)for(a=[this.normalTextureX,this.normalTextureY,this.normalTextureZ],s=["BUMPX","BUMPY","BUMPZ"],l=0;l<a.length;l++)if(a[l]){if(!a[l].isReady())return!1;i[s[l]]=!0}}if(h.a.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=h.a.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),h.a.PrepareDefinesForFrameBoundValues(r,o,i,!!n),h.a.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var f=new x.a;i.FOG&&f.addFallback(1,"FOG"),h.a.HandleFallbacksForShadows(i,f,this.maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&f.addCPUSkinningFallback(0,e);var u=[v.b.PositionKind];i.NORMAL&&u.push(v.b.NormalKind),i.VERTEXCOLOR&&u.push(v.b.ColorKind),h.a.PrepareAttributesForBones(u,e,i,f),h.a.PrepareAttributesForInstances(u,i);var c=i.toString(),d=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","tileSize"],p=["diffuseSamplerX","diffuseSamplerY","diffuseSamplerZ","normalSamplerX","normalSamplerY","normalSamplerZ"],_=new Array;h.a.PrepareUniformsAndSamplersList({uniformsNames:d,uniformBuffersNames:_,samplers:p,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("triplanar",{attributes:u,uniformsNames:d,uniformBuffersNames:_,samplers:p,defines:c,fallbacks:f,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n._materialDefines;if(o){var a=n.effect;a&&(this._activeEffect=a,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),h.a.BindBonesParameters(t,this._activeEffect),this._activeEffect.setFloat("tileSize",this.tileSize),r.getCachedMaterial()!==this&&(this.diffuseTextureX&&this._activeEffect.setTexture("diffuseSamplerX",this.diffuseTextureX),this.diffuseTextureY&&this._activeEffect.setTexture("diffuseSamplerY",this.diffuseTextureY),this.diffuseTextureZ&&this._activeEffect.setTexture("diffuseSamplerZ",this.diffuseTextureZ),this.normalTextureX&&this._activeEffect.setTexture("normalSamplerX",this.normalTextureX),this.normalTextureY&&this._activeEffect.setTexture("normalSamplerY",this.normalTextureY),this.normalTextureZ&&this._activeEffect.setTexture("normalSamplerZ",this.normalTextureZ),h.a.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),h.a.BindEyePosition(a,r)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),o.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),r.lightsEnabled&&!this.disableLighting&&h.a.BindLights(r,t,this._activeEffect,o,this.maxSimultaneousLights),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&e.push(this.mixTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTextureX&&t.push(this._diffuseTextureX),this._diffuseTextureY&&t.push(this._diffuseTextureY),this._diffuseTextureZ&&t.push(this._diffuseTextureZ),this._normalTextureX&&t.push(this._normalTextureX),this._normalTextureY&&t.push(this._normalTextureY),this._normalTextureZ&&t.push(this._normalTextureZ),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this._diffuseTextureX===t||(this._diffuseTextureY===t||(this._diffuseTextureZ===t||(this._normalTextureX===t||(this._normalTextureY===t||this._normalTextureZ===t)))))},t.prototype.dispose=function(t){this.mixTexture&&this.mixTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);return e.customType="BABYLON.TriPlanarMaterial",e},t.prototype.getClassName=function(){return"TriPlanarMaterial"},t.Parse=function(e,n,i){return u.a.Parse((function(){return new t(e.name,n)}),e,n,i)},Object(f.c)([Object(u.m)()],t.prototype,"mixTexture",void 0),Object(f.c)([Object(u.m)("diffuseTextureX")],t.prototype,"_diffuseTextureX",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTextureX",void 0),Object(f.c)([Object(u.m)("diffuseTexturY")],t.prototype,"_diffuseTextureY",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTextureY",void 0),Object(f.c)([Object(u.m)("diffuseTextureZ")],t.prototype,"_diffuseTextureZ",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTextureZ",void 0),Object(f.c)([Object(u.m)("normalTextureX")],t.prototype,"_normalTextureX",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"normalTextureX",void 0),Object(f.c)([Object(u.m)("normalTextureY")],t.prototype,"_normalTextureY",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"normalTextureY",void 0),Object(f.c)([Object(u.m)("normalTextureZ")],t.prototype,"_normalTextureZ",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"normalTextureZ",void 0),Object(f.c)([Object(u.c)()],t.prototype,"tileSize",void 0),Object(f.c)([Object(u.e)()],t.prototype,"diffuseColor",void 0),Object(f.c)([Object(u.e)()],t.prototype,"specularColor",void 0),Object(f.c)([Object(u.c)()],t.prototype,"specularPower",void 0),Object(f.c)([Object(u.c)("disableLighting")],t.prototype,"_disableLighting",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(f.c)([Object(u.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(p.a);_.a.RegisteredTypes["BABYLON.TriPlanarMaterial"]=Se;var Pe=n(93),Oe=n(146),Ce=n(84),Le=n(68),Me=n(89),Re=n(36),Fe=(n(110),n(111),n(112),n(164),"#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef BUMP\nvarying vec2 vNormalUV;\nvarying vec2 vNormalUV2;\nuniform sampler2D normalSampler;\nuniform vec2 vNormalInfos;\n#endif\nuniform sampler2D refractionSampler;\nuniform sampler2D reflectionSampler;\n\nconst float LOG2=1.442695;\nuniform vec3 cameraPosition;\nuniform vec4 waterColor;\nuniform float colorBlendFactor;\nuniform vec4 waterColor2;\nuniform float colorBlendFactor2;\nuniform float bumpHeight;\nuniform float time;\n\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\nvarying vec3 vPosition;\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef BUMP\n#ifdef BUMPSUPERIMPOSE\nbaseColor=0.6*texture2D(normalSampler,vNormalUV)+0.4*texture2D(normalSampler,vec2(vNormalUV2.x,vNormalUV2.y));\n#else\nbaseColor=texture2D(normalSampler,vNormalUV);\n#endif\nvec3 bumpColor=baseColor.rgb;\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\nbaseColor.rgb*=vNormalInfos.y;\n#else\nvec3 bumpColor=vec3(1.0);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec2 perturbation=bumpHeight*(baseColor.rg-0.5);\n#ifdef BUMPAFFECTSREFLECTION\nvec3 normalW=normalize(vNormalW+vec3(perturbation.x*8.0,0.0,perturbation.y*8.0));\nif (normalW.y<0.0) {\nnormalW.y=-normalW.y;\n}\n#else\nvec3 normalW=normalize(vNormalW);\n#endif\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\nvec2 perturbation=bumpHeight*(vec2(1.0,1.0)-0.5);\n#endif\n#ifdef FRESNELSEPARATE\n#ifdef REFLECTION\n\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation*0.5,0.0,1.0);\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\n#ifdef IS_REFRACTION_LINEAR\nrefractiveColor.rgb=toGammaSpace(refractiveColor.rgb);\n#endif\nvec2 projectedReflectionTexCoords=clamp(vec2(\nvReflectionMapTexCoord.x/vReflectionMapTexCoord.z+perturbation.x*0.3,\nvReflectionMapTexCoord.y/vReflectionMapTexCoord.z+perturbation.y\n),0.0,1.0);\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\n#ifdef IS_REFLECTION_LINEAR\nreflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);\n#endif\nvec3 upVector=vec3(0.0,1.0,0.0);\nfloat fresnelTerm=clamp(abs(pow(dot(viewDirectionW,upVector),3.0)),0.05,0.65);\nfloat IfresnelTerm=1.0-fresnelTerm;\nrefractiveColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*refractiveColor;\nreflectiveColor=IfresnelTerm*colorBlendFactor2*waterColor+(1.0-colorBlendFactor2*IfresnelTerm)*reflectiveColor;\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*IfresnelTerm;\nbaseColor=combinedColor;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#else\n#ifdef REFLECTION\n\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation,0.0,1.0);\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\n#ifdef IS_REFRACTION_LINEAR\nrefractiveColor.rgb=toGammaSpace(refractiveColor.rgb);\n#endif\nvec2 projectedReflectionTexCoords=clamp(vReflectionMapTexCoord.xy/vReflectionMapTexCoord.z+perturbation,0.0,1.0);\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\n#ifdef IS_REFLECTION_LINEAR\nreflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);\n#endif\nvec3 upVector=vec3(0.0,1.0,0.0);\nfloat fresnelTerm=max(dot(viewDirectionW,upVector),0.0);\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*(1.0-fresnelTerm);\nbaseColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*combinedColor;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#endif\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#elif defined(IMAGEPROCESSING)\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\ngl_FragColor=color;\n}\n");g.a.ShadersStore.waterPixelShader=Fe;n(165);var Ne="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef BUMP\nvarying vec2 vNormalUV;\n#ifdef BUMPSUPERIMPOSE\nvarying vec2 vNormalUV2;\n#endif\nuniform mat4 normalMatrix;\nuniform vec2 vNormalInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<logDepthDeclaration>\n\nuniform mat4 worldReflectionViewProjection;\nuniform vec2 windDirection;\nuniform float waveLength;\nuniform float time;\nuniform float windForce;\nuniform float waveHeight;\nuniform float waveSpeed;\n\nvarying vec3 vPosition;\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef BUMP\nif (vNormalInfos.x == 0.)\n{\nvNormalUV=vec2(normalMatrix*vec4((uv*1.0)/waveLength+time*windForce*windDirection,1.0,0.0));\n#ifdef BUMPSUPERIMPOSE\nvNormalUV2=vec2(normalMatrix*vec4((uv*0.721)/waveLength+time*1.2*windForce*windDirection,1.0,0.0));\n#endif\n}\nelse\n{\nvNormalUV=vec2(normalMatrix*vec4((uv2*1.0)/waveLength+time*windForce*windDirection ,1.0,0.0));\n#ifdef BUMPSUPERIMPOSE\nvNormalUV2=vec2(normalMatrix*vec4((uv2*0.721)/waveLength+time*1.2*windForce*windDirection ,1.0,0.0));\n#endif\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\nvec3 p=position;\nfloat newY=(sin(((p.x/0.05)+time*waveSpeed))*waveHeight*windDirection.x*5.0)\n+(cos(((p.z/0.05)+time*waveSpeed))*waveHeight*windDirection.y*5.0);\np.y+=abs(newY);\ngl_Position=viewProjection*finalWorld*vec4(p,1.0);\n#ifdef REFLECTION\nworldPos=viewProjection*finalWorld*vec4(p,1.0);\n\nvPosition=position;\nvRefractionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\nvRefractionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\nvRefractionMapTexCoord.z=worldPos.w;\nworldPos=worldReflectionViewProjection*vec4(position,1.0);\nvReflectionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\nvReflectionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\nvReflectionMapTexCoord.z=worldPos.w;\n#endif\n#include<logDepthVertex>\n}\n";g.a.ShadersStore.waterVertexShader=Ne;var De=function(e){function t(){var t=e.call(this)||this;return t.BUMP=!1,t.REFLECTION=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.SPECULARTERM=!1,t.LOGARITHMICDEPTH=!1,t.FRESNELSEPARATE=!1,t.BUMPSUPERIMPOSE=!1,t.BUMPAFFECTSREFLECTION=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return Object(f.d)(t,e),t}(d.a),Ie=function(e){function t(t,n,i){void 0===i&&(i=new o.d(512,512));var r=e.call(this,t,n)||this;return r.renderTargetSize=i,r.diffuseColor=new c.a(1,1,1),r.specularColor=new c.a(0,0,0),r.specularPower=64,r._disableLighting=!1,r._maxSimultaneousLights=4,r.windForce=6,r.windDirection=new o.d(0,1),r.waveHeight=.4,r.bumpHeight=.4,r._bumpSuperimpose=!1,r._fresnelSeparate=!1,r._bumpAffectsReflection=!1,r.waterColor=new c.a(.1,.1,.6),r.colorBlendFactor=.2,r.waterColor2=new c.a(.1,.1,.6),r.colorBlendFactor2=.2,r.waveLength=.1,r.waveSpeed=1,r.disableClipPlane=!1,r._renderTargets=new Ce.a(16),r._mesh=null,r._reflectionTransform=o.a.Zero(),r._lastTime=0,r._lastDeltaTime=0,r._createRenderTargets(n,i),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),r._renderTargets.push(r._reflectionRTT),r._renderTargets.push(r._refractionRTT),r._renderTargets},r._imageProcessingConfiguration=r.getScene().imageProcessingConfiguration,r._imageProcessingConfiguration&&(r._imageProcessingObserver=r._imageProcessingConfiguration.onUpdateParameters.add((function(){r._markAllSubMeshesAsImageProcessingDirty()}))),r}return Object(f.d)(t,e),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this._refractionRTT},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reflectionTexture",{get:function(){return this._reflectionRTT},enumerable:!0,configurable:!0}),t.prototype.addToRenderList=function(e){this._refractionRTT&&this._refractionRTT.renderList&&this._refractionRTT.renderList.push(e),this._reflectionRTT&&this._reflectionRTT.renderList&&this._reflectionRTT.renderList.push(e)},t.prototype.enableRenderTargets=function(e){var t=e?1:0;this._refractionRTT&&(this._refractionRTT.refreshRate=t),this._reflectionRTT&&(this._reflectionRTT.refreshRate=t)},t.prototype.getRenderList=function(){return this._refractionRTT?this._refractionRTT.renderList:[]},Object.defineProperty(t.prototype,"renderTargetsEnabled",{get:function(){return!(this._refractionRTT&&0===this._refractionRTT.refreshRate)},enumerable:!0,configurable:!0}),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new De);var i=t._materialDefines,r=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===r.getRenderId())return!0;var o=r.getEngine();if(i._areTexturesDirty&&(i._needUVs=!1,r.texturesEnabled)){if(this.bumpTexture&&m.a.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;i._needUVs=!0,i.BUMP=!0}m.a.ReflectionTextureEnabled&&(i.REFLECTION=!0)}if(h.a.PrepareDefinesForFrameBoundValues(r,o,i,!!n),h.a.PrepareDefinesForMisc(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._areMiscDirty&&(this._fresnelSeparate&&(i.FRESNELSEPARATE=!0),this._bumpSuperimpose&&(i.BUMPSUPERIMPOSE=!0),this._bumpAffectsReflection&&(i.BUMPAFFECTSREFLECTION=!0)),i._needNormals=h.a.PrepareDefinesForLights(r,e,i,!0,this._maxSimultaneousLights,this._disableLighting),i._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(i),i.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,i.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(h.a.PrepareDefinesForAttributes(e,i,!0,!0),this._mesh=e,this._waitingRenderList){for(var a=0;a<this._waitingRenderList.length;a++)this.addToRenderList(r.getNodeByID(this._waitingRenderList[a]));this._waitingRenderList=null}if(i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var s=new x.a;i.FOG&&s.addFallback(1,"FOG"),i.LOGARITHMICDEPTH&&s.addFallback(0,"LOGARITHMICDEPTH"),h.a.HandleFallbacksForShadows(i,s,this.maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e);var l=[v.b.PositionKind];i.NORMAL&&l.push(v.b.NormalKind),i.UV1&&l.push(v.b.UVKind),i.UV2&&l.push(v.b.UV2Kind),i.VERTEXCOLOR&&l.push(v.b.ColorKind),h.a.PrepareAttributesForBones(l,e,i,s),h.a.PrepareAttributesForInstances(l,i);var f=i.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vNormalInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","normalMatrix","logarithmicDepthConstant","worldReflectionViewProjection","windDirection","waveLength","time","windForce","cameraPosition","bumpHeight","waveHeight","waterColor","waterColor2","colorBlendFactor","colorBlendFactor2","waveSpeed"],c=["normalSampler","refractionSampler","reflectionSampler"],d=new Array;Me.a&&(Me.a.PrepareUniforms(u,i),Me.a.PrepareSamplers(c,i)),h.a.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:d,samplers:c,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("water",{attributes:l,uniformsNames:u,uniformBuffersNames:d,samplers:c,defines:f,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},o),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n._materialDefines;if(o){var a=n.effect;if(a&&this._mesh){this._activeEffect=a,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),h.a.BindBonesParameters(t,this._activeEffect),this._mustRebind(r,a)&&(this.bumpTexture&&m.a.BumpTextureEnabled&&(this._activeEffect.setTexture("normalSampler",this.bumpTexture),this._activeEffect.setFloat2("vNormalInfos",this.bumpTexture.coordinatesIndex,this.bumpTexture.level),this._activeEffect.setMatrix("normalMatrix",this.bumpTexture.getTextureMatrix())),h.a.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),h.a.BindEyePosition(a,r)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),o.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),r.lightsEnabled&&!this.disableLighting&&h.a.BindLights(r,t,this._activeEffect,o,this.maxSimultaneousLights),r.fogEnabled&&t.applyFog&&r.fogMode!==i.a.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),h.a.BindFogParameters(r,t,this._activeEffect),h.a.BindLogDepth(o,this._activeEffect,r),m.a.ReflectionTextureEnabled&&(this._activeEffect.setTexture("refractionSampler",this._refractionRTT),this._activeEffect.setTexture("reflectionSampler",this._reflectionRTT));var s=this._mesh.getWorldMatrix().multiply(this._reflectionTransform).multiply(r.getProjectionMatrix()),l=r.getEngine().getDeltaTime();l!==this._lastDeltaTime&&(this._lastDeltaTime=l,this._lastTime+=this._lastDeltaTime),this._activeEffect.setMatrix("worldReflectionViewProjection",s),this._activeEffect.setVector2("windDirection",this.windDirection),this._activeEffect.setFloat("waveLength",this.waveLength),this._activeEffect.setFloat("time",this._lastTime/1e5),this._activeEffect.setFloat("windForce",this.windForce),this._activeEffect.setFloat("waveHeight",this.waveHeight),this._activeEffect.setFloat("bumpHeight",this.bumpHeight),this._activeEffect.setColor4("waterColor",this.waterColor,1),this._activeEffect.setFloat("colorBlendFactor",this.colorBlendFactor),this._activeEffect.setColor4("waterColor2",this.waterColor2,1),this._activeEffect.setFloat("colorBlendFactor2",this.colorBlendFactor2),this._activeEffect.setFloat("waveSpeed",this.waveSpeed),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect),this._afterBind(t,this._activeEffect)}}},t.prototype._createRenderTargets=function(e,t){var n,i=this;this._refractionRTT=new Le.a(name+"_refraction",{width:t.x,height:t.y},e,!1,!0),this._refractionRTT.wrapU=Oe.a.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.wrapV=Oe.a.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.ignoreCameraViewport=!0,this._reflectionRTT=new Le.a(name+"_reflection",{width:t.x,height:t.y},e,!1,!0),this._reflectionRTT.wrapU=Oe.a.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.wrapV=Oe.a.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.ignoreCameraViewport=!0;var r,a=null,s=o.a.Zero();this._refractionRTT.onBeforeRender=function(){if(i._mesh&&(n=i._mesh.isVisible,i._mesh.isVisible=!1),!i.disableClipPlane){a=e.clipPlane;var t=i._mesh?i._mesh.position.y:0;e.clipPlane=Pe.a.FromPositionAndNormal(new o.e(0,t+.05,0),new o.e(0,1,0))}},this._refractionRTT.onAfterRender=function(){i._mesh&&(i._mesh.isVisible=n),i.disableClipPlane||(e.clipPlane=a)},this._reflectionRTT.onBeforeRender=function(){if(i._mesh&&(n=i._mesh.isVisible,i._mesh.isVisible=!1),!i.disableClipPlane){a=e.clipPlane;var t=i._mesh?i._mesh.position.y:0;e.clipPlane=Pe.a.FromPositionAndNormal(new o.e(0,t-.05,0),new o.e(0,-1,0)),o.a.ReflectionToRef(e.clipPlane,s)}r=e.getViewMatrix(),s.multiplyToRef(r,i._reflectionTransform),e.setTransformMatrix(i._reflectionTransform,e.getProjectionMatrix()),e.getEngine().cullBackFaces=!1,e._mirroredCameraPosition=o.e.TransformCoordinates(e.activeCamera.position,s)},this._reflectionRTT.onAfterRender=function(){i._mesh&&(i._mesh.isVisible=n),e.clipPlane=a,e.setTransformMatrix(r,e.getProjectionMatrix()),e.getEngine().cullBackFaces=!0,e._mirroredCameraPosition=null}},t.prototype.getAnimatables=function(){var e=[];return this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&e.push(this.bumpTexture),this._reflectionRTT&&this._reflectionRTT.animations&&this._reflectionRTT.animations.length>0&&e.push(this._reflectionRTT),this._refractionRTT&&this._refractionRTT.animations&&this._refractionRTT.animations.length>0&&e.push(this._refractionRTT),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._bumpTexture&&t.push(this._bumpTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._bumpTexture===t},t.prototype.dispose=function(t){this.bumpTexture&&this.bumpTexture.dispose();var n=this.getScene().customRenderTargets.indexOf(this._refractionRTT);-1!=n&&this.getScene().customRenderTargets.splice(n,1),n=-1,-1!=(n=this.getScene().customRenderTargets.indexOf(this._reflectionRTT))&&this.getScene().customRenderTargets.splice(n,1),this._reflectionRTT&&this._reflectionRTT.dispose(),this._refractionRTT&&this._refractionRTT.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return u.a.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var e=u.a.Serialize(this);if(e.customType="BABYLON.WaterMaterial",e.renderList=[],this._refractionRTT&&this._refractionRTT.renderList)for(var t=0;t<this._refractionRTT.renderList.length;t++)e.renderList.push(this._refractionRTT.renderList[t].id);return e},t.prototype.getClassName=function(){return"WaterMaterial"},t.Parse=function(e,n,i){var r=u.a.Parse((function(){return new t(e.name,n)}),e,n,i);return r._waitingRenderList=e.renderList,r},t.CreateDefaultMesh=function(e,t){return Re.a.CreateGround(e,512,512,32,t,!1)},Object(f.c)([Object(u.m)("bumpTexture")],t.prototype,"_bumpTexture",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),Object(f.c)([Object(u.e)()],t.prototype,"diffuseColor",void 0),Object(f.c)([Object(u.e)()],t.prototype,"specularColor",void 0),Object(f.c)([Object(u.c)()],t.prototype,"specularPower",void 0),Object(f.c)([Object(u.c)("disableLighting")],t.prototype,"_disableLighting",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(f.c)([Object(u.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(f.c)([Object(u.c)()],t.prototype,"windForce",void 0),Object(f.c)([Object(u.n)()],t.prototype,"windDirection",void 0),Object(f.c)([Object(u.c)()],t.prototype,"waveHeight",void 0),Object(f.c)([Object(u.c)()],t.prototype,"bumpHeight",void 0),Object(f.c)([Object(u.c)("bumpSuperimpose")],t.prototype,"_bumpSuperimpose",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"bumpSuperimpose",void 0),Object(f.c)([Object(u.c)("fresnelSeparate")],t.prototype,"_fresnelSeparate",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"fresnelSeparate",void 0),Object(f.c)([Object(u.c)("bumpAffectsReflection")],t.prototype,"_bumpAffectsReflection",void 0),Object(f.c)([Object(u.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"bumpAffectsReflection",void 0),Object(f.c)([Object(u.e)()],t.prototype,"waterColor",void 0),Object(f.c)([Object(u.c)()],t.prototype,"colorBlendFactor",void 0),Object(f.c)([Object(u.e)()],t.prototype,"waterColor2",void 0),Object(f.c)([Object(u.c)()],t.prototype,"colorBlendFactor2",void 0),Object(f.c)([Object(u.c)()],t.prototype,"waveLength",void 0),Object(f.c)([Object(u.c)()],t.prototype,"waveSpeed",void 0),Object(f.c)([Object(u.c)()],t.prototype,"disableClipPlane",void 0),Object(f.c)([Object(u.c)()],t.prototype,"useLogarithmicDepth",null),t}(p.a);_.a.RegisteredTypes["BABYLON.WaterMaterial"]=Ie;n(171),n(208),n(149);var we=n(206),Ve=n(153),Ue=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},Be=function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},je=function(){var e=this;this.createScene=function(t,n){return Ue(e,void 0,void 0,(function(){var e,f,u,c;return Be(this,(function(d){switch(d.label){case 0:return e=new i.a(t),f=new r.a("my first camera",Math.PI/1.9,Math.PI/2.5,90,new o.e(0,0,0),e),(u=new _e("skyMaterial",e)).backFaceCulling=!1,l.a.CreateBox("skyBox",1e3,e).material=u,f.setTarget(o.e.Zero()),f.attachControl(n,!0),f.useFramingBehavior=!0,f.upperBetaLimit=Math.PI/2*.99,new a.a("light",new o.e(1,1,0),e).intensity=.8,[4,l.c.ImportMeshAsync("","",Ve.a,e,void 0,".glb")];case 1:return d.sent().meshes[0].scaling.scaleInPlace(100),(c=new s.a("ground",e)).diffuseTexture=new M.a(we.a,e),l.a.CreateGroundFromHeightMap("ground",we.a,400,400,250,0,5,e,!1).material=c,[2,e]}}))}))}};t.default=new je}}]);
//# sourceMappingURL=5.babylonBundle.js.map